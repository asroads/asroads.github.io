<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="/icons/favicon.ico">
    

    
    
        
<link rel="stylesheet" href="/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/iconfont.css">


    
    












          


    
    
    <title>
        
            Universal Link通用链接使用总结 | Asroads&#39;Blog
        
    </title>
    
    
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Asroads'Blog" type="application/atom+xml">
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/" class="mdui-typo-headline">Asroads&#39;Blog</a>
    <a href="/" class="header-subtitle mdui-typo-headline">君子不器</a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">站点概览</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">关于</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">首页</div>
                </a>
            
                
                <a href="/categories/game" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-folder"></i>
                    </div>
                    <div class="mdui-list-item-content">手游</div>
                </a>
            
                
                <a href="/categories/tool/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-tools"></i>
                    </div>
                    <div class="mdui-list-item-content">技术</div>
                </a>
            
                
                <a href="/categories/other" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-gallery"></i>
                    </div>
                    <div class="mdui-list-item-content">杂项</div>
                </a>
            
                
                <a href="/categories/life" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-blog"></i>
                    </div>
                    <div class="mdui-list-item-content">感悟</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">标签</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">归档</div>
                </a>
            
                
                <a href="/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">关于</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">夜间模式</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="/icons/avatar.png"/>
                
            </div>
            <div class="sidebar-author-name">asroads</div>
            <div class="sidebar-description">自信是成功第一法宝</div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="/jsroads@163.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/jsroads" class="mdui-chip-title">jsroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/asroads" class="mdui-chip-title">asroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-qq"></i></span>
                    <a target="_blank" rel="noopener" href="https://jq.qq.com/?_wv=1027&k=fTVxmSSA" class="mdui-chip-title">QQ群</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">友情链接</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://seazhang.github.io/" class="mdui-list-item mdui-ripple">
                            麦田守望者
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://zhaoyabo.github.io/" class="mdui-list-item mdui-ripple">
                            YABO的博客
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://dreamheavenyang.github.io/" class="mdui-list-item mdui-ripple">
                            DreamHeaven
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/post/7486189e.html">Universal Link通用链接使用总结</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      发布于:&nbsp;2024-10-15
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      更新于:&nbsp;2025-04-22
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      分类于:&nbsp;
    </span>
    
      <span>
        <span class="iconfont icon-eye"></span>
        阅读次数:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=Universal Link通用链接使用总结&url=http://blog.asroads.com/post/7486189e.html&pic=http://blog.asroads.com/icons/favicon.ico&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=Universal Link通用链接使用总结&url=http://blog.asroads.com/post/7486189e.html&via=asroads" target="_blank" class="mdui-ripple">分享到 Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.asroads.com/post/7486189e.html" target="_blank" class="mdui-ripple">分享到 Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=http://blog.asroads.com/post/7486189e.html" target="_blank" class="mdui-ripple">分享到 Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://blog.asroads.com/post/7486189e.html&title=Universal Link通用链接使用总结" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=Asroads&#39;Blog&title=Universal Link通用链接使用总结&summary=自信是成功第一法宝&pics=http://blog.asroads.com/icons/favicon.ico&url=http://blog.asroads.com/post/7486189e.html" target="_blank" class="mdui-ripple">分享到 QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=http://blog.asroads.com/post/7486189e.html&text=Universal Link通用链接使用总结" target="_blank" class="mdui-ripple">分享到 Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  <div class="post-tags">
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/iOS/ >iOS</a>
      </i>
    
  </div>

  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <p>Universal links 是苹果在WWDC上提出的iOS9的新特性之一。当你支持Universal links时，iOS用户可以点击网站链接，无缝重定向到已安装的APP，而无需通过Safari。如果APP没有安装的话，点击链接会在Safari中打开。</p>
<span id="more"></span>

<h3 id="iOS中的通用链接"><a href="#iOS中的通用链接" class="headerlink" title="iOS中的通用链接"></a><strong>iOS中的通用链接</strong></h3><p><code>Universal Link</code>是<code>Apple</code>在<code>WWDC</code>上提出的<code>iOS9</code>的新特性之一；能够方便的通过打开一个<code>HTTPS</code>链接来直接启动您的客户端应用，当然前提条件是您必须在手机上安装了此<code>App</code>；</p>
<p>在<code>Universal Link</code>之前，我们通常使用<code>URL Scheme</code>的方法实现<code>web-App</code>的方式进行跳转；相比于<code>URL Scheme</code>方式,<code>Universal Link</code>提供了极佳的用户体验；</p>
<p>关于更多的介绍，可以查阅<strong>Universal Link官方介绍</strong></p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>使用<code>Universal Link</code>可以让用户在<code>Safari</code>浏览器或者其他<code>App</code>的<code>WebView</code>中拉起相应的<code>App</code>，也可以在<code>App</code>中使用相应的功能，从而把用户引流到<code>App</code>中；比如我们购物时，在<code>Safari</code>浏览器中进入淘宝网页点击<code>打开手机淘宝</code>则会直接使用<code>Universal Link</code>来拉起淘宝<code>App</code>;</p>
<h3 id="Universal-Link优点"><a href="#Universal-Link优点" class="headerlink" title="Universal Link优点"></a>Universal Link优点</h3><ul>
<li> <strong>唯一性</strong>：与自定义的<code>URL Scheme</code>相比，<code>Universal Link</code>使用的是标准的<code>HTTPS</code>协议链接到您的站点，所以一般不会被其他的<code>App</code>所声明；自定义的<code>URL Scheme</code>在没有安装应用的情况下是无法直接打开的，在<code>Safari</code>中还会出现一个不可打开的弹窗；而使用了标准<code>HTTPS</code>协议的<code>Universal Link</code>链接则具备更好的兼容性；</li>
<li><strong>安全</strong>：如果用户的手机上安装了您的应用，那么系统回去您配置的网站上下载您上传的文件<code>apple-app-site-association</code>，在这个文件中标明了当前的<code>Universal Link</code>的链接能够打开哪些<code>App</code>；因为只有开发着自己才有权限在网站的<code>根目录</code>上传此文件，所以网站与<code>App</code>之间的关联是安全的；</li>
<li> <strong>可变</strong>：如果用户的手机上没有安装您的应用，那么不必担心，<code>Universal Link</code>依然能够工作；如果你愿意，在没有安装你的<code>App</code>的时候，用户点击链接，将会在<code>Safari</code>浏览器中展示你网站的内容；</li>
<li> <strong>简单</strong>：作为<code>Universal Link</code>使用的<code>HTTPS</code>链接，可以同时作用于<code>网站</code>和<code>App</code>;</li>
<li> <strong>私有</strong>：其他<code>App</code>可以在不需要知道你的<code>App</code>是否安装了的情况下与你的<code>App</code>相互通信；</li>
</ul>
<h1 id="Universal-Links-配置"><a href="#Universal-Links-配置" class="headerlink" title="Universal Links 配置"></a>Universal Links 配置</h1><h2 id="微信登陆相关文档"><a href="#微信登陆相关文档" class="headerlink" title="微信登陆相关文档"></a>微信登陆相关文档</h2><p>iOS接入指南 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Access_Guide/iOS.html">点击访问</a></p>
<h2 id="apple-app-site-association-的配置"><a href="#apple-app-site-association-的配置" class="headerlink" title="apple-app-site-association 的配置"></a>apple-app-site-association 的配置</h2><p>地址：<a target="_blank" rel="noopener" href="https://cdnminigame.lightlygame.com/.well-known/apple-app-site-association">https://cdnminigame.lightlygame.com/.well-known/apple-app-site-association</a></p>
<p>我这里 根目录也放了一份：<a target="_blank" rel="noopener" href="https://cdnminigame.lightlygame.com/apple-app-site-association">https://cdnminigame.lightlygame.com/apple-app-site-association</a><br>两边内容如下 ：</p>
<p><img src="/post/7486189e/image-20241010145015689.png" alt="image-20241010145015689"></p>
<p>上传指定文件：创建一个文件，名为<code>apple-app-site-association</code>，<strong>注意，文件名必须固定为<code>apple-app-site-association</code>，没有后缀，没有后缀，没有后缀</strong>；其内容为<code>json</code>格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;applinks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;apps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;appID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NKF6VH268U.com.lark.snake.official&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;/appsnake/*&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>appID的组成方式为:</p>
<ul>
<li><p>Team ID.your app’s bundle identifier;</p>
</li>
<li><p>NKF6VH268U为Team ID</p>
</li>
<li><p>com.lark.snake.official 为bundle identifier</p>
</li>
</ul>
<p>地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://cdnminigame.lightlygame.com/apple-app-site-association</span><br><span class="line">https://cdnminigame.lightlygame.com/.well-known/apple-app-site-association</span><br></pre></td></tr></table></figure>

<h2 id="微信公众平台设置"><a href="#微信公众平台设置" class="headerlink" title="微信公众平台设置"></a>微信公众平台设置</h2><p><img src="/post/7486189e/image-20241015160824285.png" alt="image-20241015160824285"></p>
<p>注意事项：<strong>Universal Links 地址后必须有/字符 后面微信要拼接其他参数使用</strong></p>
<h2 id="Xcode配置"><a href="#Xcode配置" class="headerlink" title="Xcode配置"></a>Xcode配置</h2><h3 id="Associated-Domains设置"><a href="#Associated-Domains设置" class="headerlink" title="Associated Domains设置"></a>Associated Domains设置</h3><ol>
<li>如果没有 Associated Domains 需要新添加一个</li>
</ol>
<p><img src="/post/7486189e/image-20241008161325658.png" alt="image-20241008161325658"></p>
<p><img src="/post/7486189e/image-20241008161402968.png" alt="image-20241008161402968"></p>
<p><img src="/post/7486189e/image-20241008161429719.png" alt="image-20241008161429719"></p>
<p><img src="/post/7486189e/image-20241010145250267.png" alt="image-20241010145250267"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">applinks:cdnminigame.lightlygame.com</span><br></pre></td></tr></table></figure>

<h3 id="URL-Types-设置"><a href="#URL-Types-设置" class="headerlink" title="URL Types 设置"></a>URL Types 设置</h3><p><img src="/post/7486189e/image-20241008161115256.png" alt="image-20241008161115256"></p>
<h3 id="LSApplicationQueriesSchemes-添加"><a href="#LSApplicationQueriesSchemes-添加" class="headerlink" title="LSApplicationQueriesSchemes 添加"></a>LSApplicationQueriesSchemes 添加</h3><p><img src="/post/7486189e/image-20241010145325704.png" alt="image-20241010145325704"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleDevelopmentRegion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>English<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleDisplayName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>贪吃蛇无尽大作战<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleExecutable<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>$&#123;EXECUTABLE_NAME&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>com.lark.snake.official<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleInfoDictionaryVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>6.0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>$&#123;PRODUCT_NAME&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundlePackageType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>APPL<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleShortVersionString<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>3.9.7<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleSignature<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>????<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleURLTypes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeRole<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>Editor<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleURLName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>weixin<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleURLSchemes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">string</span>&gt;</span>wx6942656f257f4644<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>20241010122134<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>ITSAppUsesNonExemptEncryption<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>LSApplicationCategoryType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>LSApplicationQueriesSchemes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>weixin<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>weixinULAPI<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>weixinURLParamsAPI<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>LSRequiresIPhoneOS<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>NSAppTransportSecurity<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>NSAllowsArbitraryLoads<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>NSLocationWhenInUseUsageDescription<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>是否允许使用定位权限<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>NSUserTrackingUsageDescription<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>此标识符将用于向您推荐个性化广告。<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UILaunchStoryboardName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>LaunchScreen<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UIPrerenderedIcon<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UIRequiredDeviceCapabilities<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>accelerometer<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>opengles-1<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UIRequiresFullScreen<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UIStatusBarHidden<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UISupportedInterfaceOrientations<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>UIInterfaceOrientationPortrait<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="手机验证-（必须ios手机）Safari浏览器"><a href="#手机验证-（必须ios手机）Safari浏览器" class="headerlink" title="手机验证 （必须ios手机）Safari浏览器"></a>手机验证 （必须ios手机）Safari浏览器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cdnminigame.lightlygame.com/appsnake/</span><br></pre></td></tr></table></figure>

<p><img src="/post/7486189e/image-20241008162734908.png" alt="image-20241008162734908"></p>
<h2 id="登陆相关"><a href="#登陆相关" class="headerlink" title="登陆相关"></a>登陆相关</h2><p><img src="/post/7486189e/image-20241010145526879.png" alt="image-20241010145526879"></p>
<p>JSHelper.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  JSHelper.h</span><br><span class="line">//  snake-mobile</span><br><span class="line">//</span><br><span class="line">//  Created by jsroads on 2024/10/09.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface JSHelper : NSObject</span><br><span class="line"></span><br><span class="line">// 初始化应用信息</span><br><span class="line">+ (void)initApp:(NSString *)appName appId:(NSString *)appId;</span><br><span class="line"></span><br><span class="line">// 初始化用户信息，参数为 JSON 字符串</span><br><span class="line">+ (void)initUserInfo:(NSString *)jsonString;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 声明 callJsEngineCallBack 方法</span><br><span class="line">+ (void)callJsEngineCallBack:(NSString *)funcNameStr content:(NSString *)contentStr;</span><br><span class="line"></span><br><span class="line">// 声明 bridgeCallJsEngineCallBack 方法，用于在其他类中调用</span><br><span class="line">+ (void)bridgeCallJsEngineCallBack:(NSString *)funcNameStr content:(NSString *)contentStr;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>JSHelper.mm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  WeChatHelper.m</span><br><span class="line">//  snake-mobile</span><br><span class="line">//</span><br><span class="line">//  Created by jsroads on 2024/10/09.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;JSHelper.h&quot;</span><br><span class="line">// 确保包含 C++ 标准库头文件</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &quot;cocos/scripting/js-bindings/jswrapper/SeApi.h&quot;</span><br><span class="line">#import &quot;cocos2d.h&quot;</span><br><span class="line">@implementation JSHelper</span><br><span class="line"></span><br><span class="line">// 初始化应用信息</span><br><span class="line">+ (void)initApp:(NSString *)appName appId:(NSString *)appId &#123;</span><br><span class="line">    NSLog(@&quot;Initializing app with name: %@ and ID: %@&quot;, appName, appId);</span><br><span class="line">    // 在这里实现你想要的初始化逻辑，比如保存 appName 和 appId</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 初始化用户信息，参数为 JSON 字符串</span><br><span class="line">+ (void)initUserInfo:(NSString *)jsonString &#123;</span><br><span class="line">    NSError *error;</span><br><span class="line">    NSData *data = [jsonString dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    </span><br><span class="line">    // 使用 NSJSONSerialization 解析 JSON 字符串</span><br><span class="line">    NSDictionary *userInfo = [NSJSONSerialization JSONObjectWithData:data options:0 error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (error) &#123;</span><br><span class="line">        NSLog(@&quot;Failed to parse JSON: %@&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        NSLog(@&quot;User Info: %@&quot;, userInfo);</span><br><span class="line">        // 在这里实现你需要的处理逻辑，比如将用户信息存储或进一步操作</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 定义 callJsEngineCallBack 方法</span><br><span class="line">+ (void)callJsEngineCallBack:(NSString *)funcNameStr content:(NSString *)contentStr &#123;</span><br><span class="line">    NSLog(@&quot;callJsEngineCallBack...&quot;);</span><br><span class="line"></span><br><span class="line">    // 将 NSString 转为 std::string</span><br><span class="line">    std::string funcName = [funcNameStr UTF8String];</span><br><span class="line">    std::string param = [contentStr UTF8String];</span><br><span class="line">    </span><br><span class="line">    // 拼接 JavaScript 调用字符串，确保是标准的函数调用格式</span><br><span class="line">    std::string jsCallStr = cocos2d::StringUtils::format(&quot;%s(%s);&quot;, funcName.c_str(), param.c_str());</span><br><span class="line">    NSLog(@&quot;jsCallStr = %s&quot;, jsCallStr.c_str());</span><br><span class="line">    </span><br><span class="line">    // 调用 JavaScript 引擎</span><br><span class="line">    se::ScriptEngine::getInstance()-&gt;evalString(jsCallStr.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 桥接方法实现</span><br><span class="line">+ (void)bridgeCallJsEngineCallBack:(NSString *)funcNameStr content:(NSString *)contentStr &#123;</span><br><span class="line">    // 间接调用 C++ 方法</span><br><span class="line">    [JSHelper callJsEngineCallBack:funcNameStr content:contentStr];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>WeChatHelper.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  WeChatHelper.h</span><br><span class="line">//  snake-mobile</span><br><span class="line">//</span><br><span class="line">//  Created by jsroads on 2024/10/09.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface WeChatHelper: NSObject;</span><br><span class="line"></span><br><span class="line">//检查是否安装微信</span><br><span class="line">+(BOOL) isInstallWx;</span><br><span class="line"></span><br><span class="line">//初始化微信appid，appsecret</span><br><span class="line">+(BOOL)initWx:(NSString *)appName andId:(NSString *)appId andSecret:(NSString *)appSecret;</span><br><span class="line"></span><br><span class="line">//微信登录</span><br><span class="line">+ (void)loginWx:(NSString *)param;</span><br><span class="line"></span><br><span class="line">//微信登录回调</span><br><span class="line">+(void) wxLoginResultCallback: (BOOL)result andCode: (NSString *)codeMsg;</span><br><span class="line"></span><br><span class="line">//微信分享回调</span><br><span class="line">//+(void) wxPayResultCallback: (BOOL)result andMsg: (NSString *)msg;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>WeChatHelper.m</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  WeChatHelper.m</span><br><span class="line">//  snake-mobile</span><br><span class="line">//</span><br><span class="line">//  Created by jsroads on 2024/10/09.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &quot;WXApi.h&quot;</span><br><span class="line">#import &quot;WeChatHelper.h&quot;</span><br><span class="line">#import &quot;JSHelper.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation WeChatHelper</span><br><span class="line"></span><br><span class="line">//检查是否安装微信</span><br><span class="line">+(BOOL) isInstallWx &#123;</span><br><span class="line">    return [WXApi isWXAppInstalled];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//初始化微信appid，appsecret</span><br><span class="line">+(BOOL)initWx:(NSString *)appName andId:(NSString *)appId andSecret:(NSString *)appSecret &#123;</span><br><span class="line">    [WXApi startLogByLevel:WXLogLevelNormal logBlock:^(NSString *log) &#123;</span><br><span class="line">        NSLog(@&quot;WeChatSDK : %@&quot;, log);</span><br><span class="line">    &#125;];</span><br><span class="line">    NSLog(@&quot;WeChatSDK : %@   %@   %@&quot;, appName,appId,appSecret);</span><br><span class="line">    [WXApi registerApp:@&quot;wx6942656f257f4644&quot; universalLink:@&quot;https://cdnminigame.lightlygame.com/appsnake/&quot;]; //填写自己对应的url</span><br><span class="line">    </span><br><span class="line">//    //调用自检函数</span><br><span class="line">//    [WXApi checkUniversalLinkReady:^(WXULCheckStep step, WXCheckULStepResult* result) &#123;</span><br><span class="line">//        NSLog(@&quot;checkUniversalLinkReady:%@, %u, %@, %@&quot;, @(step), result.success, result.errorInfo, result.suggestion);</span><br><span class="line">//    &#125;];</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//微信登录</span><br><span class="line">// loginWx 方法定义，接受一个字符串参数</span><br><span class="line">+ (void)loginWx:(NSString *)param &#123;</span><br><span class="line">    // param 是传递的字符串参数</span><br><span class="line">    NSLog(@&quot;Received param: %@&quot;, param);</span><br><span class="line">    //构造SendAuthReq结构体</span><br><span class="line">    SendAuthReq* req =[[SendAuthReq alloc ] init ];</span><br><span class="line">    req.scope = @&quot;snsapi_userinfo&quot;;// 只能填 snsapi_userinfo</span><br><span class="line">    req.state = @&quot;snake&quot;;  //此处需要填写自己的key</span><br><span class="line">    req.nonautomatic = YES;//nonautomatic 属性来控制授权行为 可以这样设置为关闭自动授权</span><br><span class="line">    //第三方向微信终端发送一个SendAuthReq消息结构</span><br><span class="line">    [WXApi sendReq:req completion:nil];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// wxLoginResultCallback 方法实现，回调 TypeScript</span><br><span class="line">+ (void)wxLoginResultCallback:(BOOL)result andCode:(NSString *)codeMsg &#123;</span><br><span class="line">    NSLog(@&quot;wxLoginResultCallback result %d code : %@&quot;, result, codeMsg);</span><br><span class="line">    </span><br><span class="line">    // 构建 JavaScript 回调字符串，格式为 JavaScript 参数</span><br><span class="line">    NSString *code = @&quot;&quot;;</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        code = [NSString stringWithFormat:@&quot;true, &#x27;%@&#x27;&quot;, codeMsg];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        code = [NSString stringWithFormat:@&quot;false, &#x27;%@&#x27;&quot;, codeMsg];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 调用 bridgeCallJsEngineCallBack 方法，将 JavaScript 函数名和参数传递过去</span><br><span class="line">    [JSHelper bridgeCallJsEngineCallBack:@&quot;cc.onWeChatLoginResultCallback&quot; content:code];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">////微信支付回调</span><br><span class="line">//+(void) wxPayResultCallback: (BOOL)result andMsg: (NSString *)msg &#123;</span><br><span class="line">//    </span><br><span class="line">//&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>AppController.mm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">/****************************************************************************</span><br><span class="line"> Copyright (c) 2010-2013 cocos2d-x.org</span><br><span class="line"> Copyright (c) 2013-2016 Chukong Technologies Inc.</span><br><span class="line"> Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.</span><br><span class="line"> </span><br><span class="line"> http://www.cocos2d-x.org</span><br><span class="line"> </span><br><span class="line"> Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line"> of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line"> in the Software without restriction, including without limitation the rights</span><br><span class="line"> to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line"> copies of the Software, and to permit persons to whom the Software is</span><br><span class="line"> furnished to do so, subject to the following conditions:</span><br><span class="line"> </span><br><span class="line"> The above copyright notice and this permission notice shall be included in</span><br><span class="line"> all copies or substantial portions of the Software.</span><br><span class="line"> </span><br><span class="line"> THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line"> IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line"> FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line"> AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line"> LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line"> OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span><br><span class="line"> THE SOFTWARE.</span><br><span class="line"> ****************************************************************************/</span><br><span class="line"></span><br><span class="line">#import &quot;AppController.h&quot;</span><br><span class="line">#import &quot;cocos2d.h&quot;</span><br><span class="line">#import &quot;AppDelegate.h&quot;</span><br><span class="line">#import &quot;RootViewController.h&quot;</span><br><span class="line">#import &quot;SDKWrapper.h&quot;</span><br><span class="line">#import &quot;platform/ios/CCEAGLView-ios.h&quot;</span><br><span class="line">#import &quot;GravityEngineManager.h&quot;</span><br><span class="line">#import &quot;PhoneManager.h&quot;</span><br><span class="line">#import &lt;AppTrackingTransparency/AppTrackingTransparency.h&gt;</span><br><span class="line">#import &quot;ADHelper.h&quot;</span><br><span class="line">#import &quot;WXApiManager.h&quot;</span><br><span class="line">#import &quot;WXApi.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">using namespace cocos2d;</span><br><span class="line"></span><br><span class="line">@implementation AppController</span><br><span class="line"></span><br><span class="line">Application* app = nullptr;</span><br><span class="line">@synthesize window;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line">#pragma mark Application lifecycle</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    [[SDKWrapper getInstance] application:application didFinishLaunchingWithOptions:launchOptions];</span><br><span class="line">    // Add the view controller&#x27;s view to the window and display.</span><br><span class="line">    float scale = [[UIScreen mainScreen] scale];</span><br><span class="line">    CGRect bounds = [[UIScreen mainScreen] bounds];</span><br><span class="line">    window = [[UIWindow alloc] initWithFrame: bounds];</span><br><span class="line">    </span><br><span class="line">    // cocos2d application instance</span><br><span class="line">    app = new AppDelegate(bounds.size.width * scale, bounds.size.height * scale);</span><br><span class="line">    app-&gt;setMultitouch(true);</span><br><span class="line">    </span><br><span class="line">    // Use RootViewController to manage CCEAGLView</span><br><span class="line">    _viewController = [[RootViewController alloc]init];</span><br><span class="line">#ifdef NSFoundationVersionNumber_iOS_7_0</span><br><span class="line">    _viewController.automaticallyAdjustsScrollViewInsets = NO;</span><br><span class="line">    _viewController.extendedLayoutIncludesOpaqueBars = NO;</span><br><span class="line">    _viewController.edgesForExtendedLayout = UIRectEdgeAll;</span><br><span class="line">#else</span><br><span class="line">    _viewController.wantsFullScreenLayout = YES;</span><br><span class="line">#endif</span><br><span class="line">    // Set RootViewController to window</span><br><span class="line">    if ( [[UIDevice currentDevice].systemVersion floatValue] &lt; 6.0)</span><br><span class="line">    &#123;</span><br><span class="line">        // warning: addSubView doesn&#x27;t work on iOS6</span><br><span class="line">        [window addSubview: _viewController.view];</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        // use this method on ios6</span><br><span class="line">        [window setRootViewController:_viewController];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [window makeKeyAndVisible];</span><br><span class="line">    </span><br><span class="line">    [[UIApplication sharedApplication] setStatusBarHidden:YES];</span><br><span class="line"></span><br><span class="line">    // 调用 PhoneManager 的 initPhoneSDK 方法</span><br><span class="line">       [[PhoneManager sharedInstance] initPhoneSDKWithParentViewController:_viewController networkAvailableCallback:^&#123;</span><br><span class="line">           // 用户有网络时的回调</span><br><span class="line">           NSLog(@&quot;网络可用，开始初始化游戏场景&quot;);</span><br><span class="line">           [[PhoneManager sharedInstance] phoneLoginWithAppId];</span><br><span class="line">           //run the cocos2d-x game scene</span><br><span class="line">           app-&gt;start();</span><br><span class="line">           [GravityEngineManager initGravity];</span><br><span class="line">           //初始化SDK</span><br><span class="line">           [ADHelper setDebugEnable:YES];</span><br><span class="line">           [ADHelper setupSDKWithAppId:@&quot;46210&quot;];</span><br><span class="line">           [ADHelper setViewController:_viewController];</span><br><span class="line">       &#125;];</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity restorationHandler:(void (^)(NSArray&lt;id&lt;UIUserActivityRestoring&gt;&gt; *restorableObjects))restorationHandler &#123;</span><br><span class="line">    if ([userActivity.activityType isEqual:NSUserActivityTypeBrowsingWeb]) &#123;</span><br><span class="line">        auto incomingURL = userActivity.webpageURL;</span><br><span class="line">        [[SDKWrapper getInstance] application:application continueUserActivity:incomingURL.absoluteString];</span><br><span class="line">        // 处理微信的 Universal Link 回调</span><br><span class="line">        if ([WXApi handleOpenUniversalLink:userActivity delegate:[WXApiManager sharedManager]]) &#123;</span><br><span class="line">            return YES;  // 微信的 Universal Link 处理成功</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)applicationWillResignActive:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</span><br><span class="line">     Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</span><br><span class="line">     */</span><br><span class="line">    app-&gt;onPause();</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillResignActive:application];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidBecomeActive:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</span><br><span class="line">     */</span><br><span class="line">    app-&gt;onResume();</span><br><span class="line">    if (@available(iOS 14.5, *))&#123;</span><br><span class="line">        if([ATTrackingManager trackingAuthorizationStatus] == ATTrackingManagerAuthorizationStatusNotDetermined)&#123;</span><br><span class="line">            [ATTrackingManager requestTrackingAuthorizationWithCompletionHandler:^(ATTrackingManagerAuthorizationStatus status) &#123;</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [[SDKWrapper getInstance] applicationDidBecomeActive:application];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</span><br><span class="line">     If your application supports background execution, called instead of applicationWillTerminate: when the user quits.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationDidEnterBackground:application];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillEnterForeground:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Called as part of  transition from the background to the inactive state: here you can undo many of the changes made on entering the background.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillEnterForeground:application];    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillTerminate:(UIApplication *)application</span><br><span class="line">&#123;</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillTerminate:application];</span><br><span class="line">    delete app;</span><br><span class="line">    app = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line">#pragma mark Memory management</span><br><span class="line"></span><br><span class="line">- (void)applicationDidReceiveMemoryWarning:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Free up as much memory as possible by purging cached data objects that can be recreated (or reloaded from disk) later.</span><br><span class="line">     */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    if ([WXApi handleOpenURL:url delegate:[WXApiManager sharedManager]]) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//iOS9以下</span><br><span class="line">- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    if ([WXApi handleOpenURL:url delegate:[WXApiManager sharedManager]]) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//iOS9+</span><br><span class="line">- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(nonnull NSDictionary *)options</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    if ([WXApi handleOpenURL:url delegate:[WXApiManager sharedManager]]) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>AppWeChatHelper.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppConstant</span>, <span class="title class_">AppEventType</span>, <span class="title class_">AppLoginCallBackType</span>, <span class="title class_">AppLoginType</span>, <span class="title class_">AppPayTrackType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AppConstant&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Browser</span> &#125; <span class="keyword">from</span> <span class="string">&quot;Browser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; proto &#125; <span class="keyword">from</span> <span class="string">&quot;Proto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GFunc</span> &#125; <span class="keyword">from</span> <span class="string">&quot;GameFunc&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">WxAppOrderCreateResponse</span> = proto.<span class="property">server</span>.<span class="property">WxAppOrderCreateResponse</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">WeChatHelperProps</span> &#123;</span><br><span class="line">    <span class="comment">/*微信小游戏 名字*/</span></span><br><span class="line">    appName?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="comment">/*微信小游戏 APPID*/</span></span><br><span class="line">    appId?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="comment">/*微信小游戏密钥*/</span></span><br><span class="line">    appSecret?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jsroads on 2024/7/19 11:33</span></span><br><span class="line"><span class="comment"> * Note:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppWeChatHelper</span> &#123;</span><br><span class="line">    <span class="comment">/*原生对应调用文件路径*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">wxClassPath</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">/*小游戏 名字*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">appName</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">/*小游戏 APPID*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">appId</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">/*小游戏密钥 刷新才需要*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">appSecret</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props: WeChatHelperProps</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[AppWeChatHelper][ctor]---构造函数`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appName</span> = props.<span class="property">appName</span> || <span class="title class_">AppConstant</span>.<span class="property">WECHAT_APP_NAME</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appId</span> = props.<span class="property">appId</span> || <span class="title class_">AppConstant</span>.<span class="property">WECHAT_APP_ID</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appSecret</span> = props.<span class="property">appSecret</span> || <span class="title class_">AppConstant</span>.<span class="property">WECHAT_APP_SECRET</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wxClassPath</span> = <span class="title class_">AppConstant</span>.<span class="property">WECHAT_CLASS_PATH</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册全局事件 给原生调用</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">onAppNative</span>) &#123;</span><br><span class="line">            cc[<span class="string">&quot;onWeChatLoginResultCallback&quot;</span>] = <span class="variable language_">this</span>.<span class="property">onWeChatLoginResultCallback</span>;</span><br><span class="line">            cc[<span class="string">&quot;onWeChatPayResultCallback&quot;</span>] = <span class="variable language_">this</span>.<span class="property">onWeChatPayResultCallback</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initWx</span>(<span class="variable language_">this</span>.<span class="property">appName</span>, <span class="variable language_">this</span>.<span class="property">appId</span>, <span class="variable language_">this</span>.<span class="property">appSecret</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信登陆</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">login</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">jsbEmpty</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//检查是否安装微信</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isInstallWx</span>() === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&quot;用户未安装微信APP&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;微信登录失败，请检查是否安装微信&quot;</span>);</span><br><span class="line">            <span class="title class_">GFunc</span>.<span class="title function_">showFloatTip</span>(&#123;<span class="attr">txt</span>: message&#125;);</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">msg</span>: <span class="title class_">AppLoginCallBackType</span> = &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="title class_">AppLoginType</span>.<span class="property">Wechat</span>,</span><br><span class="line">                <span class="attr">status</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">                <span class="attr">code</span>: <span class="string">&quot;wechat_not_install&quot;</span>,</span><br><span class="line">                <span class="attr">message</span>: message</span><br><span class="line">            &#125;;</span><br><span class="line">            cc.<span class="property">director</span>.<span class="title function_">emit</span>(<span class="title class_">AppEventType</span>.<span class="property">WECHAT_LOGIN_CALLBACK</span>, msg);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">platform</span> === cc.<span class="property">sys</span>.<span class="property">WIN32</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WechatLoginView&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loginWx</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否安装微信</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">isInstallWx</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">jsbEmpty</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_ANDROID</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">wxClassPath</span>,</span><br><span class="line">                <span class="string">&quot;isInstallWx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;()Z&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;WeChatHelper&quot;</span>,</span><br><span class="line">                <span class="string">&quot;isInstallWx&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信 初始化接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">appName</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">appId</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">appSecret</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">initWx</span>(<span class="attr">appName</span>: <span class="built_in">string</span>, <span class="attr">appId</span>: <span class="built_in">string</span>, <span class="attr">appSecret</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">jsbEmpty</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appName</span> = appName;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appId</span> = appId;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">appSecret</span> = appSecret;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_ANDROID</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="variable language_">this</span>.<span class="property">wxClassPath</span>,</span><br><span class="line">                <span class="string">&quot;initWx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V&quot;</span>,</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appName</span>,</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appId</span>,</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appSecret</span></span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(</span><br><span class="line">                <span class="string">&quot;WeChatHelper&quot;</span>, <span class="comment">// 类名</span></span><br><span class="line">                <span class="string">&quot;initWx:andId:andSecret:&quot;</span>, <span class="comment">// 方法名和参数签名</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appName</span>, <span class="comment">// 第一个参数 appName</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appId</span>,   <span class="comment">// 第二个参数 appId</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">appSecret</span> <span class="comment">// 第三个参数 appSecret</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类内部微信登录调用接口，直接调用sdk</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">loginWx</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">jsbEmpty</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_ANDROID</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">wxClassPath</span>,</span><br><span class="line">                <span class="string">&quot;loginWx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;()V&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;WeChatHelper&quot;</span>, <span class="string">&quot;loginWx:&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信支付</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">extra</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">trackData</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">payOrderForWeChat</span>(<span class="attr">extra</span>: <span class="title class_">WxAppOrderCreateResponse</span>, <span class="attr">trackData</span>: <span class="title class_">AppPayTrackType</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="property">jsbEmpty</span>) <span class="keyword">return</span>;</span><br><span class="line">        cc.<span class="title function_">log</span>(<span class="string">&quot;[WeChatHelper][payWx]--prepayId&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_ANDROID</span>) &#123;</span><br><span class="line">            jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">wxClassPath</span>,</span><br><span class="line">                <span class="string">&quot;payWx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;</span>,</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(extra),</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(trackData),</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span>) &#123;</span><br><span class="line">            jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;WeChatHelper&quot;</span>, <span class="string">&quot;payWx:&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(extra));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;win版本不支持支付&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Android 回调JS</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">result</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">codeMsg</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 微信登录结果回调函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">onWeChatLoginResultCallback</span>(<span class="params">result: <span class="built_in">boolean</span>, codeMsg: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 如果不是在原生应用中，则返回</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">Browser</span>.<span class="property">onAppNative</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 监听游戏进入前台事件</span></span><br><span class="line">        cc.<span class="property">game</span>.<span class="title function_">once</span>(cc.<span class="property">game</span>.<span class="property">EVENT_SHOW</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            cc.<span class="property">director</span>.<span class="title function_">once</span>(cc.<span class="property">Director</span>.<span class="property">EVENT_AFTER_DRAW</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`onWeChatLoginResultCallback Native send nativeCmd:<span class="subst">$&#123;result&#125;</span> codeMsg:<span class="subst">$&#123;codeMsg&#125;</span>`</span>);</span><br><span class="line">                <span class="comment">// 定义回调消息</span></span><br><span class="line">                <span class="keyword">let</span> <span class="attr">msg</span>: <span class="title class_">AppLoginCallBackType</span>;</span><br><span class="line">                <span class="comment">// 如果登录失败</span></span><br><span class="line">                <span class="keyword">if</span> (result === <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="comment">// 设置回调消息为失败</span></span><br><span class="line">                    msg = &#123;<span class="attr">type</span>: <span class="title class_">AppLoginType</span>.<span class="property">Wechat</span>, <span class="attr">status</span>: <span class="string">&quot;fail&quot;</span>, <span class="attr">code</span>: codeMsg, <span class="attr">message</span>: <span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 设置回调消息为成功</span></span><br><span class="line">                    msg = &#123;<span class="attr">type</span>: <span class="title class_">AppLoginType</span>.<span class="property">Wechat</span>, <span class="attr">status</span>: <span class="string">&quot;success&quot;</span>, <span class="attr">message</span>: <span class="variable language_">this</span>.<span class="property">appId</span>, <span class="attr">code</span>: codeMsg&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 发送回调消息</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WECHAT_LOGIN_CALLBACK------&quot;</span>)</span><br><span class="line">                cc.<span class="property">director</span>.<span class="title function_">emit</span>(<span class="title class_">AppEventType</span>.<span class="property">WECHAT_LOGIN_CALLBACK</span>, msg);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WECHAT_LOGIN_CALLBACK&quot;</span>)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 微信支付结果回调函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">onWeChatPayResultCallback</span>(<span class="attr">result</span>: <span class="built_in">boolean</span>, <span class="attr">code</span>: <span class="built_in">string</span>, <span class="attr">orderId</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="comment">// 如果不是在原生应用中，则返回</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">Browser</span>.<span class="property">onAppNative</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 打印日志</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onWeChatPayResultCallback&quot;</span>, result, code, orderId);</span><br><span class="line">        <span class="comment">// 发送回调消息</span></span><br><span class="line">        cc.<span class="property">director</span>.<span class="title function_">emit</span>(<span class="title class_">AppEventType</span>.<span class="property">WECHAT_PAYRESULT_CALLBACK</span>, &#123;result, code, orderId&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AppConstant.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; proto &#125; <span class="keyword">from</span> <span class="string">&quot;Proto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">WxAppOrderCreateResponse</span> = proto.<span class="property">server</span>.<span class="property">WxAppOrderCreateResponse</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jsroads on 2024/7/19 14:16</span></span><br><span class="line"><span class="comment"> * Note:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">AppConstant</span> = &#123;</span><br><span class="line">    <span class="attr">PACKAGE_NAME</span>: <span class="string">&quot;com/lark/snake/official&quot;</span>,</span><br><span class="line">    <span class="attr">PACKAGE_COCOS_NAME</span>: <span class="string">&quot;org/cocos2dx/javascript&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_APP_NAME</span>: <span class="string">&quot;贪吃蛇无尽大作战&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_APP_ID</span>: <span class="string">&quot;wx6942656f257f4644&quot;</span>,<span class="comment">//国内原生APP安卓</span></span><br><span class="line">    <span class="attr">WECHAT_APP_SECRET</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_CLASS_PATH</span>: <span class="string">&quot;com/lark/snake/official/WeChatHelper&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_KEY_REFRESH_TOKEN</span>: <span class="string">&quot;snake_app_refresh_token&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_ACCESS_URL</span>: <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token&quot;</span>,</span><br><span class="line">    <span class="attr">WECHAT_REFRESH_URL</span>: <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/refresh_token&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">REWARD_AD_APP_ID</span>: <span class="string">&quot;46211&quot;</span>,<span class="comment">//激励视频appId</span></span><br><span class="line">    <span class="attr">PLACEMENT_ID</span>: <span class="string">&quot;8133957415611695&quot;</span>,<span class="comment">//激励视频广告位置id</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">NativeCmd</span> &#123;</span><br><span class="line">    <span class="variable constant_">INIT_ADS</span> = <span class="string">&quot;initAds&quot;</span>, <span class="comment">// 初始化广告</span></span><br><span class="line">    <span class="variable constant_">SHOW_ADS</span> = <span class="string">&quot;showAds&quot;</span>, <span class="comment">// 播放广告</span></span><br><span class="line">    <span class="variable constant_">INIT_APP_INFO</span> = <span class="string">&quot;initApp&quot;</span>, <span class="comment">//初始化APP信息</span></span><br><span class="line">    <span class="variable constant_">INIT_USER_INFO</span> = <span class="string">&quot;initUserInfo&quot;</span>, <span class="comment">//初始化用户登陆信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">AppLoginType</span> &#123;</span><br><span class="line">    <span class="title class_">Wechat</span> = <span class="number">1</span>, <span class="comment">//微信登录</span></span><br><span class="line">    <span class="title class_">PhoneNumber</span> = <span class="number">2</span>, <span class="comment">//手机号登录</span></span><br><span class="line">    <span class="title class_">TapTap</span> = <span class="number">3</span>, <span class="comment">//taptap登录</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">AppServerType</span> &#123;</span><br><span class="line">    <span class="variable constant_">WECHAT_LINK</span> = <span class="number">0</span>, <span class="comment">//互通服用一些微信元素，“微链之桥”</span></span><br><span class="line">    <span class="variable constant_">APP_NEW</span> = <span class="number">1</span>, <span class="comment">//app就用游戏章节名字，“静谧森林”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">AppPayType</span> &#123;</span><br><span class="line">    <span class="title class_">Wechat</span> = <span class="number">1</span>, <span class="comment">//微信支付</span></span><br><span class="line">    <span class="title class_">AliPay</span> = <span class="number">2</span>, <span class="comment">//支付宝支付</span></span><br><span class="line">    <span class="title class_">OtherUnknownPay</span> = <span class="number">2</span>, <span class="comment">//其他支付</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">AppEventType</span> &#123;</span><br><span class="line">    <span class="variable constant_">WECHAT_LOGIN_CALLBACK</span> = <span class="string">&quot;WECHAT_LOGIN_CALLBACK&quot;</span>, <span class="comment">//微信登陆</span></span><br><span class="line">    <span class="variable constant_">PHONE_LOGIN_CALLBACK</span> = <span class="string">&quot;PHONE_LOGIN_CALLBACK&quot;</span>, <span class="comment">//手机号登陆</span></span><br><span class="line">    <span class="variable constant_">TAPTAP_LOGIN_CALLBACK</span> = <span class="string">&quot;TAPTAP_LOGIN_CALLBACK&quot;</span>, <span class="comment">//taptap登陆</span></span><br><span class="line">    <span class="variable constant_">CLEAR_APP_LOGIN_CALLBACK</span> = <span class="string">&quot;CLEAR_APP_LOGIN_CALLBACK&quot;</span>, <span class="comment">//清空登录回调</span></span><br><span class="line">    <span class="variable constant_">WECHAT_PAYRESULT_CALLBACK</span> = <span class="string">&quot;WECHAT_PAYRESULT_CALLBACK&quot;</span>, <span class="comment">//微信支付</span></span><br><span class="line">    <span class="variable constant_">ALIPAY_PAYRESULT_CALLBACK</span> = <span class="string">&quot;ALIPAY_PAYRESULT_CALLBACK&quot;</span>, <span class="comment">//支付宝支付</span></span><br><span class="line">    <span class="variable constant_">TAPTAP_CHECK_PAY_CALLBACK</span> = <span class="string">&quot;TAPTAP_CHECK_PAY_CALLBACK&quot;</span>, <span class="comment">//taptap消费上限检查</span></span><br><span class="line">    <span class="variable constant_">CLEAR_CHECK_PAY_CALLBACK</span> = <span class="string">&quot;CLEAR_CHECK_PAY_CALLBACK&quot;</span>, <span class="comment">//清空检查消费上限回调</span></span><br><span class="line">    <span class="title class_">OtherUnknownPay</span> = <span class="number">2</span>, <span class="comment">//其他支付</span></span><br><span class="line"></span><br><span class="line">    <span class="variable constant_">STAGE_OVER_CHECK_NATIVE_AD_INIT</span> = <span class="string">&quot;STAGE_OVER_CHECK_NATIVE_AD_INIT&quot;</span>, <span class="comment">//检查是否可以初始化原生广告，广告初始化需要权限申请</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppLoginCallBackType</span> = &#123; <span class="attr">type</span>: <span class="title class_">AppLoginType</span>, <span class="attr">status</span>: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;fail&quot;</span>, <span class="attr">code</span>: <span class="built_in">string</span>, message?: <span class="built_in">string</span> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppCheckPayCallBackType</span> = &#123; <span class="attr">type</span>: <span class="title class_">AppLoginType</span>, <span class="attr">status</span>: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;fail&quot;</span>&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppPayRequestType</span> = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">AppPayType</span>, orderId?: <span class="built_in">string</span>, info?: <span class="built_in">string</span>, extra?: <span class="title class_">WxAppOrderCreateResponse</span>, trackData?: <span class="title class_">AppPayTrackType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppPayTrackType</span> = &#123; <span class="attr">price</span>: <span class="built_in">number</span>, <span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">storeId</span>: <span class="built_in">string</span> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppPayBackType</span> = &#123; <span class="attr">result</span>: <span class="built_in">boolean</span>, <span class="attr">code</span>: <span class="built_in">string</span>, <span class="attr">orderId</span>: <span class="built_in">string</span> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AppPayStatusType</span> = &#123; <span class="attr">type</span>: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;fail&quot;</span>, <span class="attr">code</span>: <span class="built_in">string</span> &#125;</span><br></pre></td></tr></table></figure>

<p>以上就是相关的代码文件修改。</p>
<h2 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h2><h3 id="调用自检函数"><a href="#调用自检函数" class="headerlink" title="调用自检函数"></a>调用自检函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//初始化微信appid，appsecret</span><br><span class="line">+(BOOL)initWx:(NSString *)appName andId:(NSString *)appId andSecret:(NSString *)appSecret &#123;</span><br><span class="line">    [WXApi startLogByLevel:WXLogLevelNormal logBlock:^(NSString *log) &#123;</span><br><span class="line">        NSLog(@&quot;WeChatSDK : %@&quot;, log);</span><br><span class="line">    &#125;];</span><br><span class="line">    NSLog(@&quot;WeChatSDK : %@   %@   %@&quot;, appName,appId,appSecret);</span><br><span class="line">    [WXApi registerApp:@&quot;wx6942656f257f4644&quot; universalLink:@&quot;https://cdnminigame.lightlygame.com/appsnake/&quot;]; //填写自己对应的url</span><br><span class="line">    </span><br><span class="line">//    //调用自检函数</span><br><span class="line">//    [WXApi checkUniversalLinkReady:^(WXULCheckStep step, WXCheckULStepResult* result) &#123;</span><br><span class="line">//        NSLog(@&quot;checkUniversalLinkReady:%@, %u, %@, %@&quot;, @(step), result.success, result.errorInfo, result.suggestion);</span><br><span class="line">//    &#125;];</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2024-10-09 16:20:29.176579+0800 asnake-mobile[2694:508576] WeChatSDK : 贪吃蛇无尽大作战   wx6942656f257f4644</span><br><span class="line">2024-10-09 16:20:29.176841+0800 asnake-mobile[2694:508576] WeChatSDK : wxlog:using sdk:pod--</span><br><span class="line">2024-10-09 16:20:29.176944+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:0, 1, check passed,</span><br><span class="line">2024-10-09 16:20:29.177199+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:1, 1, check passed,</span><br><span class="line">2024-10-09 16:20:29.178127+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:2, 1, check passed,</span><br><span class="line">2024-10-09 16:20:29.180123+0800 asnake-mobile[2694:508576] WeChatSDK : wxlog:set property list</span><br><span class="line">2024-10-09 16:20:29.181809+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:3, 1, check passed,</span><br><span class="line">2024-10-09 16:20:29.380122+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:4, 1, check passed,</span><br><span class="line">2024-10-09 16:20:31.272317+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:5, 1, Universal Link check passed. The application is launched by WeChat via Universal Link,</span><br><span class="line">2024-10-09 16:20:31.272368+0800 asnake-mobile[2694:508576] WeChatSDK : wxlog:WXCheckULStepResult[success: 1, errorInfo: Universal Link check passed. The application is launched by WeChat via Universal Link, suggestion: ]</span><br><span class="line">2024-10-09 16:20:31.272396+0800 asnake-mobile[2694:508576] checkUniversalLinkReady:6, 1, All Check Passed!,</span><br><span class="line">2024-10-09 16:20:31.272430+0800 asnake-mobile[2694:508576] WeChatSDK : wxlog:WXCheckULStepResult[success: 1, errorInfo: All Check Passed!, suggestion: ]</span><br></pre></td></tr></table></figure>

<h3 id="关闭自检函数"><a href="#关闭自检函数" class="headerlink" title="关闭自检函数"></a>关闭自检函数</h3><p>报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这是一个重要的提示信息，通常意味着微信已经成功启动你的应用，但有一些可能存在的问题需要注意：</p>
<h4 id="1-确保-Apple-Developer-网站上的配置正确"><a href="#1-确保-Apple-Developer-网站上的配置正确" class="headerlink" title="1. 确保 Apple Developer 网站上的配置正确"></a>1. 确保 Apple Developer 网站上的配置正确</h4><ul>
<li><p>确保在 <a target="_blank" rel="noopener" href="https://developer.apple.com/account/resources/identifiers/list">Apple Developer</a> 上的 App ID 中启用了 “Associated Domains” 功能。</p>
</li>
<li><p>在 Associated Domains 中，添加 Universal Link 配置，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">applinks:cdnminigame.lightlygame.com</span><br></pre></td></tr></table></figure>

<p>这里的 <code>cdnminigame.lightlygame.com</code> 应该替换为你自己的服务器域名。</p>
</li>
</ul>
<h4 id="2-检查-Associated-Domains-配置"><a href="#2-检查-Associated-Domains-配置" class="headerlink" title="2. 检查 Associated Domains 配置"></a>2. 检查 Associated Domains 配置</h4><ul>
<li><p>在 Xcode 的 <code>Capabilities</code> 选项卡中，启用 <strong>Associated Domains</strong>，并确保正确添加了对应的域名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">applinks:cdnminigame.lightlygame.com</span><br></pre></td></tr></table></figure></li>
<li><p>该域名必须与微信开放平台中的配置保持一致。</p>
</li>
</ul>
<h4 id="3-检查-AASA-文件的正确性"><a href="#3-检查-AASA-文件的正确性" class="headerlink" title="3. 检查 AASA 文件的正确性"></a>3. 检查 AASA 文件的正确性</h4><ul>
<li><p>你需要确保你的服务器上存在一个正确的 <code>apple-app-site-association</code> (AASA) 文件。</p>
</li>
<li><p>AASA 文件通常位于服务器的根目录或 <code>.well-known</code> 目录下。例如：</p>
<ul>
<li><code>https://cdnminigame.lightlygame.com/.well-known/apple-app-site-association</code></li>
</ul>
</li>
<li><p>AASA 文件的内容应该包括对你的应用的相关配置，例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;applinks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;apps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;appID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;TeamID&gt;.&lt;BundleID&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;/appsnake/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;/&quot;</span> <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>确保 <code>&lt;TeamID&gt;</code> 是你的 Apple Developer 账户的团队 ID，<code>&lt;BundleID&gt;</code> 是你的应用的包名。</p>
</li>
</ul>
<h4 id="4-检查-Universal-Link-是否正常工作"><a href="#4-检查-Universal-Link-是否正常工作" class="headerlink" title="4. 检查 Universal Link 是否正常工作"></a>4. 检查 Universal Link 是否正常工作</h4><ul>
<li>使用 iOS 设备上的 Safari 浏览器访问你的 Universal Link，确认它能够正确打开应用。如果应用未被正确打开，可能是 AASA 文件配置有问题。</li>
<li>你可以使用苹果提供的调试工具，来检查你的域名和 AASA 文件是否被正确解析：<ul>
<li>访问 <a target="_blank" rel="noopener" href="https://branch.io/resources/aasa-validator/">Apple Universal Links Validator</a> 或类似的工具，输入你的域名，检查 AASA 文件的有效性。</li>
</ul>
</li>
</ul>
<h4 id="5-检查微信开发者后台配置"><a href="#5-检查微信开发者后台配置" class="headerlink" title="5. 检查微信开发者后台配置"></a>5. 检查微信开发者后台配置</h4><ul>
<li>确保在 <a target="_blank" rel="noopener" href="https://open.weixin.qq.com/">微信开放平台</a> 后台的 iOS 应用配置中，正确填写了 Universal Link 地址。</li>
<li>微信后台中的 Universal Link 必须和 Xcode 中 Associated Domains 的域名保持一致。</li>
</ul>
<h4 id="6-强制重新安装应用"><a href="#6-强制重新安装应用" class="headerlink" title="6. 强制重新安装应用"></a>6. 强制重新安装应用</h4><ul>
<li>如果你已经修改了 Universal Link 的配置，强烈建议将应用删除后重新安装，因为 iOS 会缓存旧的 Universal Link 配置。</li>
<li>删除应用后重新安装通常会刷新缓存，确保最新的 Universal Link 配置被正确应用。</li>
</ul>
<h4 id="7-调试信息的解释"><a href="#7-调试信息的解释" class="headerlink" title="7. 调试信息的解释"></a>7. 调试信息的解释</h4><ul>
<li>微信 SDK 提示 <code>&quot;Universal Link check passed&quot;</code>，表示部分检查通过，但是 <code>&quot;The application is launched by WeChat via Universal Link&quot;</code> 表示应用是通过 Universal Link 启动的，这可能意味着配置存在某些不匹配。</li>
<li>确保应用启动时从微信 SDK 返回的 <code>result</code> 和 <code>suggestion</code> 信息也是显示成功的。</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>这个问题通常是由于 Universal Link 的配置不完整或错误导致的。请按照以下步骤排查：</p>
<ol>
<li><strong>检查 Apple Developer 配置和 Xcode 中的 Associated Domains 是否正确</strong>。</li>
<li><strong>确保服务器上的 AASA 文件正确配置</strong>，并且可以从外网访问。</li>
<li><strong>检查微信开放平台的配置</strong>，确保所有配置项一致。</li>
<li><strong>使用调试工具验证 AASA 文件</strong>，确保它被正确解析。</li>
<li><strong>重新安装应用</strong>以刷新设备的缓存。</li>
</ol>
<p>这些步骤应该可以帮助你排查和解决 Universal Link 的问题，使微信登录功能正常工作。</p>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>使用微信授权返回到游戏时，在走完onResp:方法后，控制台会打印WeChatSDK: wxlog:Error:set token fail, errCode:4, errLog:wx token[] or contextId[(null)] is nil</p>
<p>按照文档自检方法，检查结果都是正常的：All Check Passed！</p>
<p>我今天也遇到了问题，在社区论坛搜了类似问题都没有收获，就在绝望之际 看到了这个</p>
<p>官方升级的 ReadMe文件</p>
<p>SDK1.9.9</p>
<ol>
<li>授权登录支持关闭自动授权</li>
<li>分享支持添加签名，防止篡改</li>
</ol>
<p>因 查看日志发现，其实返回了 code 但是 微信唤起的时候 一闪而过，有返回code 但是和前些年接入的时候交互不同，于是就在代码搜索 自动 搜到了这个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/** 是否关闭自动授权</span><br><span class="line"></span><br><span class="line"> * @note YES为关闭自动授权，每次登陆都需要用户手动授权；NO为允许自动授权</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) BOOL nonautomatic;</span><br></pre></td></tr></table></figure>



<p>于是思考 是否是因为 默认启动了 自动授权呢？于是登陆逻辑修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//构造SendAuthReq结构体</span><br><span class="line"></span><br><span class="line">SendAuthReq* req =[[SendAuthReq alloc ] init ];</span><br><span class="line"></span><br><span class="line">req.scope = @&quot;snsapi_userinfo&quot;;// 只能填 snsapi_userinfo</span><br><span class="line"></span><br><span class="line">req.state = @&quot;snake&quot;;  //此处需要填写自己的key</span><br><span class="line"></span><br><span class="line">req.nonautomatic = YES;//nonautomatic 属性来控制授权行为 可以这样设置为关闭自动授权</span><br><span class="line"></span><br><span class="line">//第三方向微信终端发送一个SendAuthReq消息结构</span><br><span class="line"></span><br><span class="line">[WXApi sendReq:req completion:nil];</span><br></pre></td></tr></table></figure>



<p>然后就看到了 选择 取消、拒绝，登陆按钮的页面了！！！</p>
<p>很奇怪，微信这么大的改动，接入文档里居然没有提及，让我耗费了几个小时一直以为是自己哪里接入错误了！</p>
<h2 id="修改Universal-Link"><a href="#修改Universal-Link" class="headerlink" title="修改Universal Link"></a>修改Universal Link</h2><p>最近项目更换了CDN地址 于是就要修改登录文件的位置 按照下面步骤修改可以更换，特别是代码内的地址，容易忽略掉</p>
<h3 id="新的cdn-存放文件-名为apple-app-site-association-没有后缀-记得"><a href="#新的cdn-存放文件-名为apple-app-site-association-没有后缀-记得" class="headerlink" title="新的cdn 存放文件 名为apple-app-site-association 没有后缀 记得"></a>新的cdn 存放文件 名为<code>apple-app-site-association</code> 没有后缀 记得</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;applinks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;apps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;appID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NKF6VH268U.com.lark.snake.official&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;/appsnake/*&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="微信开放后台修改Universal-Link"><a href="#微信开放后台修改Universal-Link" class="headerlink" title="微信开放后台修改Universal Link"></a>微信开放后台修改Universal Link</h3><p><img src="/post/7486189e/6904a3da36344cbd12346c6e3693060d.png" alt="6904a3da36344cbd12346c6e3693060d"></p>
<h3 id="Xcode修改配置"><a href="#Xcode修改配置" class="headerlink" title="Xcode修改配置"></a>Xcode修改配置</h3><p><img src="/post/7486189e/image-20241118113508964.png" alt="image-20241118113508964"></p>
<h3 id="微信SDK相关代码修改域名"><a href="#微信SDK相关代码修改域名" class="headerlink" title="微信SDK相关代码修改域名"></a>微信SDK相关代码修改域名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//初始化微信appid，appsecret</span><br><span class="line">+(BOOL)initWx:(NSString *)appName andId:(NSString *)appId andSecret:(NSString *)appSecret &#123;</span><br><span class="line">    [WXApi startLogByLevel:WXLogLevelNormal logBlock:^(NSString *log) &#123;</span><br><span class="line">        NSLog(@&quot;WeChatSDK : %@&quot;, log);</span><br><span class="line">    &#125;];</span><br><span class="line">    NSLog(@&quot;WeChatSDK : %@   %@   %@&quot;, appName,appId,appSecret);</span><br><span class="line">    [WXApi registerApp:@&quot;wx6942656f257f4644&quot; universalLink:@&quot;https://tcs-cdn.galsanggame.com/appsnake/&quot;]; //填写自己对应的url</span><br><span class="line">    </span><br><span class="line">//    //调用自检函数</span><br><span class="line">//    [WXApi checkUniversalLinkReady:^(WXULCheckStep step, WXCheckULStepResult* result) &#123;</span><br><span class="line">//        NSLog(@&quot;checkUniversalLinkReady:%@, %u, %@, %@&quot;, @(step), result.success, result.errorInfo, result.suggestion);</span><br><span class="line">//    &#125;];</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="域名验证通过"><a href="#域名验证通过" class="headerlink" title="域名验证通过"></a>域名验证通过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tcs-cdn.galsanggame.com/appsnake/</span><br></pre></td></tr></table></figure>

<p>相关验证地址：<a target="_blank" rel="noopener" href="https://branch.io/resources/aasa-validator/">https://branch.io/resources/aasa-validator/</a></p>
<p><img src="/post/7486189e/UniversalLink.png" alt="UniversalLink"></p>
<h3 id="清理打包验证"><a href="#清理打包验证" class="headerlink" title="清理打包验证"></a>清理打包验证</h3><p>可以正常唤起微信登录</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/doc/000e2088448c806626ea2723451c00">WeChatSDK: wxlog:Error:set token fail, errCode:4</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6995762911851315231">iOS Universal Link(通用链接)使用</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/pqg3EKL6DpomQqhKD8PE9Q">从客户端到服务器端，适配微信iOS OpenSDK中的Universal Links</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/_pKht9-6GmXf8zIWj5mD4w">iOS Universal Links 唤起应用</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ftGvo3tSPOh5-UGSsUmTIw">【Coding】Universal Links in iOS</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/RZuiTQPoWWtW4Doi1ckLxA">iOS Universal Link使用总结</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/r2yxszLKcWBc9HI5fhlRlg">IOS通用链接如何生成?</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/RZuiTQPoWWtW4Doi1ckLxA">iOS Universal Link使用总结</a></li>
</ul>

  </div>
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--页脚广告-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/post/657141b7.html">
        <i class="iconfont icon-angle-left"></i>
        <span>jszip.js库3.10.1报错ReferenceError: setImmediate is not define解决方案</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/post/64a9a637.html">
        <span>iOS微信开发如何运行官方demo</span>
        <i class="iconfont icon-angle-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/post/7486189e.html" id="toc-header" class="mdui-ripple">文章目录</a>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#iOS%E4%B8%AD%E7%9A%84%E9%80%9A%E7%94%A8%E9%93%BE%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text">iOS中的通用链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Universal-Link%E4%BC%98%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">Universal Link优点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Universal-Links-%E9%85%8D%E7%BD%AE"><span class="toc-number"></span> <span class="toc-text">Universal Links 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86%E7%9B%B8%E5%85%B3%E6%96%87%E6%A1%A3"><span class="toc-number"></span> <span class="toc-text">微信登陆相关文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apple-app-site-association-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number"></span> <span class="toc-text">apple-app-site-association 的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number"></span> <span class="toc-text">微信公众平台设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xcode%E9%85%8D%E7%BD%AE"><span class="toc-number"></span> <span class="toc-text">Xcode配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Associated-Domains%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">Associated Domains设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL-Types-%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">URL Types 设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LSApplicationQueriesSchemes-%E6%B7%BB%E5%8A%A0"><span class="toc-number">3.</span> <span class="toc-text">LSApplicationQueriesSchemes 添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81-%EF%BC%88%E5%BF%85%E9%A1%BBios%E6%89%8B%E6%9C%BA%EF%BC%89Safari%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">手机验证 （必须ios手机）Safari浏览器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E7%9B%B8%E5%85%B3"><span class="toc-number"></span> <span class="toc-text">登陆相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-number"></span> <span class="toc-text">相关问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E8%87%AA%E6%A3%80%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">调用自检函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E8%87%AA%E6%A3%80%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">关闭自检函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number"></span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%A1%AE%E4%BF%9D-Apple-Developer-%E7%BD%91%E7%AB%99%E4%B8%8A%E7%9A%84%E9%85%8D%E7%BD%AE%E6%AD%A3%E7%A1%AE"><span class="toc-number">0.1.</span> <span class="toc-text">1. 确保 Apple Developer 网站上的配置正确</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A3%80%E6%9F%A5-Associated-Domains-%E9%85%8D%E7%BD%AE"><span class="toc-number">0.2.</span> <span class="toc-text">2. 检查 Associated Domains 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%A3%80%E6%9F%A5-AASA-%E6%96%87%E4%BB%B6%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%A7"><span class="toc-number">0.3.</span> <span class="toc-text">3. 检查 AASA 文件的正确性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%A3%80%E6%9F%A5-Universal-Link-%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C"><span class="toc-number">0.4.</span> <span class="toc-text">4. 检查 Universal Link 是否正常工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%A3%80%E6%9F%A5%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E8%80%85%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">0.5.</span> <span class="toc-text">5. 检查微信开发者后台配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%BC%BA%E5%88%B6%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8"><span class="toc-number">0.6.</span> <span class="toc-text">6. 强制重新安装应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E7%9A%84%E8%A7%A3%E9%87%8A"><span class="toc-number">0.7.</span> <span class="toc-text">7. 调试信息的解释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number"></span> <span class="toc-text">其他问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9Universal-Link"><span class="toc-number"></span> <span class="toc-text">修改Universal Link</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E7%9A%84cdn-%E5%AD%98%E6%94%BE%E6%96%87%E4%BB%B6-%E5%90%8D%E4%B8%BAapple-app-site-association-%E6%B2%A1%E6%9C%89%E5%90%8E%E7%BC%80-%E8%AE%B0%E5%BE%97"><span class="toc-number">1.</span> <span class="toc-text">新的cdn 存放文件 名为apple-app-site-association 没有后缀 记得</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%BC%80%E6%94%BE%E5%90%8E%E5%8F%B0%E4%BF%AE%E6%94%B9Universal-Link"><span class="toc-number">2.</span> <span class="toc-text">微信开放后台修改Universal Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xcode%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">Xcode修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1SDK%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9%E5%9F%9F%E5%90%8D"><span class="toc-number">4.</span> <span class="toc-text">微信SDK相关代码修改域名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E9%AA%8C%E8%AF%81%E9%80%9A%E8%BF%87"><span class="toc-number">5.</span> <span class="toc-text">域名验证通过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E6%89%93%E5%8C%85%E9%AA%8C%E8%AF%81"><span class="toc-number">6.</span> <span class="toc-text">清理打包验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5"><span class="toc-number"></span> <span class="toc-text">相关链接</span></a>
      </li>
    </ul>
  </div>



  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
        <a href="https://beian.miit.gov.cn" rel="noopener" target="_blank"></a>
      
      <span>
        &copy; 2018 - 2025 
        
          <span style="color:#d9333f" class="iconfont icon-heart"></span>
        
        asroads
      </span>
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span>Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span>Theme: <a href="https://github.com/kb1000fx/Meadow" rel="noopener" target="_blank">Meadow</a></span>
        </div>
      
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span id="busuanzi_container_site_uv" style="display: none;"> <span class="iconfont icon-user"></span>总访客量 <span id="busuanzi_value_site_uv"></span></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span id="busuanzi_container_site_pv" style="display: none;"> <span class="iconfont icon-eye"></span>总访问量 <span id="busuanzi_value_site_pv"></span></span>
        </div>
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  

    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/js/mdui.min.v1.0.0.js"></script>




<script src="/js/meadow.js"></script>

</body>
</html >