<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="/icons/favicon.ico">
    

    
    
        
<link rel="stylesheet" href="/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/iconfont.css">


    
    












          


    
    
    <title>
        
            Cocos Creator中JavaScript和Object-C 互相调用（Mac） | Asroads&#39;Blog
        
    </title>
    
    
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Asroads'Blog" type="application/atom+xml">
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/" class="mdui-typo-headline">Asroads&#39;Blog</a>
    <a href="/" class="header-subtitle mdui-typo-headline">君子不器</a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">站点概览</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">关于</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">首页</div>
                </a>
            
                
                <a href="/categories/game" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-folder"></i>
                    </div>
                    <div class="mdui-list-item-content">手游</div>
                </a>
            
                
                <a href="/categories/tool/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-tools"></i>
                    </div>
                    <div class="mdui-list-item-content">技术</div>
                </a>
            
                
                <a href="/categories/other" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-gallery"></i>
                    </div>
                    <div class="mdui-list-item-content">杂项</div>
                </a>
            
                
                <a href="/categories/life" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-blog"></i>
                    </div>
                    <div class="mdui-list-item-content">感悟</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">标签</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">归档</div>
                </a>
            
                
                <a href="/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">关于</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">夜间模式</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="/icons/avatar.png"/>
                
            </div>
            <div class="sidebar-author-name">asroads</div>
            <div class="sidebar-description">自信是成功第一法宝</div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="/jsroads@163.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/jsroads" class="mdui-chip-title">jsroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/asroads" class="mdui-chip-title">asroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-qq"></i></span>
                    <a target="_blank" rel="noopener" href="https://jq.qq.com/?_wv=1027&k=fTVxmSSA" class="mdui-chip-title">QQ群</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">友情链接</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://seazhang.github.io/" class="mdui-list-item mdui-ripple">
                            麦田守望者
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://zhaoyabo.github.io/" class="mdui-list-item mdui-ripple">
                            YABO的博客
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://dreamheavenyang.github.io/" class="mdui-list-item mdui-ripple">
                            DreamHeaven
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/post/289dec55.html">Cocos Creator中JavaScript和Object-C 互相调用（Mac）</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      发布于:&nbsp;2019-11-02
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      更新于:&nbsp;2025-04-22
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      分类于:&nbsp;<a class="category-link" href="/categories/game/">game</a>
    </span>
    
      <span>
        <span class="iconfont icon-eye"></span>
        阅读次数:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=Cocos Creator中JavaScript和Object-C 互相调用（Mac）&url=http://blog.asroads.com/post/289dec55.html&pic=http://blog.asroads.com/icons/favicon.ico&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=Cocos Creator中JavaScript和Object-C 互相调用（Mac）&url=http://blog.asroads.com/post/289dec55.html&via=asroads" target="_blank" class="mdui-ripple">分享到 Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.asroads.com/post/289dec55.html" target="_blank" class="mdui-ripple">分享到 Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=http://blog.asroads.com/post/289dec55.html" target="_blank" class="mdui-ripple">分享到 Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://blog.asroads.com/post/289dec55.html&title=Cocos Creator中JavaScript和Object-C 互相调用（Mac）" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=Asroads&#39;Blog&title=Cocos Creator中JavaScript和Object-C 互相调用（Mac）&summary=自信是成功第一法宝&pics=http://blog.asroads.com/icons/favicon.ico&url=http://blog.asroads.com/post/289dec55.html" target="_blank" class="mdui-ripple">分享到 QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=http://blog.asroads.com/post/289dec55.html&text=Cocos Creator中JavaScript和Object-C 互相调用（Mac）" target="_blank" class="mdui-ripple">分享到 Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  <div class="post-tags">
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/Cocos/ >Cocos</a>
      </i>
    
  </div>

  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <p>H5游戏做了许久，一直没怎么亲密接触过Native原生开发，之前接入SDK 也是用的JS版本，这些天开始用H5游戏，导出原生平台 Apk（安卓）和ipa（iOS）文件，不免用到了JavaScript和原生语言的调用，官方关于这块有两部分，一个是JSB2.0一个是原生的反射机制，由于开发时间有限，退而求其次，选择了反射机制。</p>
<span id="more"></span>
<p>首先这里用Mac环境和Cocos Creator最新版本 2.2.0版本 语言使用 Typescript ，这个和js一样的，下面我将详细介绍如何从新建项目到相互调用成功。项目源码 已经上传，大家可以去 <a target="_blank" rel="noopener" href="https://github.com/jsroads/jstalktonative">点击</a> 查看 原生导出 项目在 jstalktonative/build/jsb-link/frameworks/runtime-src/proj.ios_mac 下面</p>
<h3 id="步骤一：环境支持"><a href="#步骤一：环境支持" class="headerlink" title="步骤一：环境支持"></a>步骤一：环境支持</h3><ul>
<li>Cocos Creator</li>
<li>Typescript</li>
<li>Xcode</li>
<li>Webstorm（代码编辑器 可选）</li>
</ul>
<h3 id="步骤二：流程"><a href="#步骤二：流程" class="headerlink" title="步骤二：流程"></a>步骤二：流程</h3><ol>
<li>首先我们打开我们的Cocos Creator 新建一个Typescript项目</li>
</ol>
<p><img src="/post/289dec55/image-20191102122737393.png" alt="image-20191102122737393"></p>
<ol start="2">
<li>新建一个类 叫 JSTalkHelper.ts (名字自己随便起)</li>
</ol>
<p><img src="/post/289dec55/image-20191102123116151.png" alt="image-20191102123116151"></p>
<ol start="3">
<li>挂载我们新建的脚本</li>
</ol>
<p><img src="/post/289dec55/image-20191102125031866.png" alt="image-20191102125031866"></p>
<ol start="4">
<li>在场景里面 拖动几个按钮，好区分我们的几种方法</li>
</ol>
<p><img src="/post/289dec55/image-20191102125111475.png" alt="image-20191102125111475"></p>
<ul>
<li>无参无返  —&gt; 没有参数，不返回值</li>
<li>无参有返  —&gt; 没有参数，有返回值</li>
<li>有参有返  —&gt; 有参数，有返回值</li>
<li>有参无返  —&gt; 有参数，无返回值</li>
<li>原生调用JS—&gt; 原生调用 js 本例使用一个点击 触发，然后 Objective-c 使用 timer 主动调用</li>
</ul>
<ol start="3">
<li>我们操作之后，开始 构建项目  如果是安卓项目，必须配置对象的 SDK 和 NDK </li>
</ol>
<p><img src="/post/289dec55/image-20191102131119870.png" alt="image-20191102131119870"></p>
<ol start="4">
<li><p>使用 Xcode 打开我们的项目</p>
<p><img src="/post/289dec55/image-20191102131400244.png" alt="image-20191102131400244"></p>
</li>
<li><p>在 AppController.mm 文件 添加我们的调用代码</p>
</li>
</ol>
<p>完整代码如下  我对 Objective C 不是很熟悉 写的最简单的 熟悉的可以自己按照最好的语法格式书写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">/****************************************************************************</span><br><span class="line"> Copyright (c) 2010-2013 cocos2d-x.org</span><br><span class="line"> Copyright (c) 2013-2016 Chukong Technologies Inc.</span><br><span class="line"> Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.</span><br><span class="line"> </span><br><span class="line"> http://www.cocos2d-x.org</span><br><span class="line"> </span><br><span class="line"> Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line"> of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line"> in the Software without restriction, including without limitation the rights</span><br><span class="line"> to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line"> copies of the Software, and to permit persons to whom the Software is</span><br><span class="line"> furnished to do so, subject to the following conditions:</span><br><span class="line"> </span><br><span class="line"> The above copyright notice and this permission notice shall be included in</span><br><span class="line"> all copies or substantial portions of the Software.</span><br><span class="line"> </span><br><span class="line"> THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line"> IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line"> FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line"> AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line"> LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line"> OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span><br><span class="line"> THE SOFTWARE.</span><br><span class="line"> ****************************************************************************/</span><br><span class="line"></span><br><span class="line">#import &quot;AppController.h&quot;</span><br><span class="line">#import &quot;cocos2d.h&quot;</span><br><span class="line">#import &quot;AppDelegate.h&quot;</span><br><span class="line">#import &quot;RootViewController.h&quot;</span><br><span class="line">#import &quot;SDKWrapper.h&quot;</span><br><span class="line">#import &quot;platform/ios/CCEAGLView-ios.h&quot;</span><br><span class="line">#include &quot;cocos/scripting/js-bindings/jswrapper/SeApi.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">using namespace cocos2d;</span><br><span class="line"></span><br><span class="line">@implementation AppController</span><br><span class="line"></span><br><span class="line">Application* app = nullptr;</span><br><span class="line">@synthesize window;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line">#pragma mark Application lifecycle</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    [[SDKWrapper getInstance] application:application didFinishLaunchingWithOptions:launchOptions];</span><br><span class="line">    // Add the view controller&#x27;s view to the window and display.</span><br><span class="line">    float scale = [[UIScreen mainScreen] scale];</span><br><span class="line">    CGRect bounds = [[UIScreen mainScreen] bounds];</span><br><span class="line">    window = [[UIWindow alloc] initWithFrame: bounds];</span><br><span class="line">    </span><br><span class="line">    // cocos2d application instance</span><br><span class="line">    app = new AppDelegate(bounds.size.width * scale, bounds.size.height * scale);</span><br><span class="line">    app-&gt;setMultitouch(true);</span><br><span class="line">    </span><br><span class="line">    // Use RootViewController to manage CCEAGLView</span><br><span class="line">    _viewController = [[RootViewController alloc]init];</span><br><span class="line">#ifdef NSFoundationVersionNumber_iOS_7_0</span><br><span class="line">    _viewController.automaticallyAdjustsScrollViewInsets = NO;</span><br><span class="line">    _viewController.extendedLayoutIncludesOpaqueBars = NO;</span><br><span class="line">    _viewController.edgesForExtendedLayout = UIRectEdgeAll;</span><br><span class="line">#else</span><br><span class="line">    _viewController.wantsFullScreenLayout = YES;</span><br><span class="line">#endif</span><br><span class="line">    // Set RootViewController to window</span><br><span class="line">    if ( [[UIDevice currentDevice].systemVersion floatValue] &lt; 6.0)</span><br><span class="line">    &#123;</span><br><span class="line">        // warning: addSubView doesn&#x27;t work on iOS6</span><br><span class="line">        [window addSubview: _viewController.view];</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        // use this method on ios6</span><br><span class="line">        [window setRootViewController:_viewController];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [window makeKeyAndVisible];</span><br><span class="line">    </span><br><span class="line">    [[UIApplication sharedApplication] setStatusBarHidden:YES];</span><br><span class="line">    </span><br><span class="line">    //run the cocos2d-x game scene</span><br><span class="line">    app-&gt;start();</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillResignActive:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</span><br><span class="line">     Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillResignActive:application];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidBecomeActive:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationDidBecomeActive:application];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</span><br><span class="line">     If your application supports background execution, called instead of applicationWillTerminate: when the user quits.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationDidEnterBackground:application];</span><br><span class="line">    app-&gt;applicationDidEnterBackground();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillEnterForeground:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Called as part of  transition from the background to the inactive state: here you can undo many of the changes made on entering the background.</span><br><span class="line">     */</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillEnterForeground:application];</span><br><span class="line">    app-&gt;applicationWillEnterForeground();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillTerminate:(UIApplication *)application</span><br><span class="line">&#123;</span><br><span class="line">    [[SDKWrapper getInstance] applicationWillTerminate:application];</span><br><span class="line">    delete app;</span><br><span class="line">    app = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line">#pragma mark Memory management</span><br><span class="line"></span><br><span class="line">- (void)applicationDidReceiveMemoryWarning:(UIApplication *)application &#123;</span><br><span class="line">    /*</span><br><span class="line">     Free up as much memory as possible by purging cached data objects that can be recreated (or reloaded from disk) later.</span><br><span class="line">     */</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> 无参数，无返回值</span><br><span class="line"> */</span><br><span class="line">+(void)oneHundred&#123;</span><br><span class="line">    NSLog(@&quot;OC收到：无参数，无返回值&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line">无参数，有返回值</span><br><span class="line">*/</span><br><span class="line">+(int)twoHundred&#123;</span><br><span class="line">    NSLog(@&quot;OC收到：有参数，有返回值 返回值：%d&quot;,2000);</span><br><span class="line">    return 2000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">有参数，有返回值</span><br><span class="line">*/</span><br><span class="line">+(NSString *)threeHundred:(NSString*)adId withContent:(int)age&#123;</span><br><span class="line">    NSLog(@&quot;OC收到：有参数，有返回值 %@ 和 %d 返回值：hello&quot;,adId,age);</span><br><span class="line">    return @&quot;hello&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">有参数，无返回值</span><br><span class="line">*/</span><br><span class="line">+(void)fourHundred:(NSString*)adId withContent:(int)age&#123;</span><br><span class="line">    NSLog(@&quot;OC收到：有参数，无返回值 %@ 和 %d&quot;,adId,age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">启动一个timer sec秒后调用 JS</span><br><span class="line">*/</span><br><span class="line">+(void)fiveHundred:(int)sec&#123;</span><br><span class="line">    NSLog(@&quot;OC收到： %d 秒后 调用JS&quot;,sec);</span><br><span class="line">        NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:sec</span><br><span class="line">              target:[NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">            /* do this! */</span><br><span class="line">            NSLog(@&quot;时间到触发&quot;);</span><br><span class="line">            [self talkJS];</span><br><span class="line">        &#125;]</span><br><span class="line">              selector:@selector(main)</span><br><span class="line">              userInfo:nil</span><br><span class="line">              repeats:NO</span><br><span class="line">        ];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">+(NSString *)talkJS&#123;</span><br><span class="line">    std::string strRet = &quot;you are niu B&quot;;</span><br><span class="line">       std::string jsCallStr = cocos2d::StringUtils::format(&quot;timerTestJSCallBck(\&quot;%s\&quot;);&quot;, strRet.c_str());</span><br><span class="line">       se::Value *ret = new se::Value();</span><br><span class="line">       se::ScriptEngine::getInstance()-&gt;evalString(jsCallStr.c_str() , -1 , ret);</span><br><span class="line">       NSLog(@&quot;jsCallStr = %s&quot;, jsCallStr.c_str());</span><br><span class="line">       return @&quot;hehe&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+(void)callJsEngineCallBack:(NSString*) funcNameStr withCmd:(NSString*) cmdStr withContent:(NSString*) contentStr</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;callJsEngineCallBack...&quot;);</span><br><span class="line">    std::string funcName = [funcNameStr UTF8String];</span><br><span class="line">    std::string param001 = [cmdStr UTF8String];</span><br><span class="line">    std::string param002 = [contentStr UTF8String];</span><br><span class="line">    std::string jsCallStr = cocos2d::StringUtils::format(&quot;%s(\&quot;%s\&quot;,\&quot;%s\&quot;);&quot;,funcName.c_str(), param001.c_str(),param002.c_str());</span><br><span class="line">    NSLog(@&quot;jsCallStr = %s&quot;, jsCallStr.c_str());</span><br><span class="line">    se::ScriptEngine::getInstance()-&gt;evalString(jsCallStr.c_str());</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>另外 附上 JSTalkHelper.ts </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jsroads on 2019/11/2 . 12:30 下午</span></span><br><span class="line"><span class="comment"> * Note:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Browser</span> <span class="keyword">from</span> <span class="string">&quot;./Browser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TalkBack</span> <span class="keyword">from</span> <span class="string">&quot;./TalkBack&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;ccclass, property&#125; = cc.<span class="property">_decorator</span>;</span><br><span class="line"><span class="meta">@ccclass</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">JSTalkHelper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">cc.Component</span> &#123;</span><br><span class="line">    <span class="meta">@property</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: cc.<span class="property">Label</span>,</span><br><span class="line">        <span class="attr">displayName</span>: <span class="string">&quot;状态信息文本&quot;</span>,</span><br><span class="line">        <span class="attr">tooltip</span>: <span class="string">&quot;展示操作过程的状态&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">descriptionLabel</span>: cc.<span class="property">Label</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">onLoad</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="title class_">TalkBack</span>.<span class="title function_">init</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">descriptionLabel</span>.<span class="property">string</span> = <span class="string">&quot;准备完毕，点击按钮开始通信&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">touchHandler</span>(<span class="attr">event</span>: cc.<span class="property">Event</span>.<span class="property">EventTouch</span>, <span class="attr">data</span>: <span class="built_in">any</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (data) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;100&quot;</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了 &#x27;无参无返&#x27; 按钮，开始调用&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">test100</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;200&quot;</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了 &#x27;无参有返&#x27; 按钮，开始调用&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">test200</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;300&quot;</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了 &#x27;有参有返&#x27; 按钮，开始调用&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">test300</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;400&quot;</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了 &#x27;有参无返&#x27; 按钮，开始调用&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">test400</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;500&quot;</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了 &#x27;OC 主动调用&#x27; 按钮，1秒后开始&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">test500</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 无参数，无返回值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">test100</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isIOS</span>()) &#123;</span><br><span class="line">            jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;AppController&quot;</span>, <span class="string">&quot;oneHundred&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isAndroid</span>()) &#123;</span><br><span class="line">            <span class="comment">// TODO 安卓平台</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;平台不支持&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 无参数，有返回值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">test200</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isIOS</span>()) &#123;</span><br><span class="line">            result = jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;AppController&quot;</span>, <span class="string">&quot;twoHundred&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回值&quot;</span>,result);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isAndroid</span>()) &#123;</span><br><span class="line">            <span class="comment">// TODO 安卓平台</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;平台不支持&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 有参数，有返回值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">test300</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>,adId = <span class="string">&quot;cocos10086&quot;</span>,age = <span class="number">18</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isIOS</span>()) &#123;</span><br><span class="line">            result = jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;AppController&quot;</span>, <span class="string">&quot;threeHundred:withContent:&quot;</span>,adId,age);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回值&quot;</span>,result);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isAndroid</span>()) &#123;</span><br><span class="line">            <span class="comment">// TODO 安卓平台</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;平台不支持&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 有参数，无返回值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">test400</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>,adId = <span class="string">&quot;cocos10086&quot;</span>,age = <span class="number">18</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isIOS</span>()) &#123;</span><br><span class="line">            jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;AppController&quot;</span>, <span class="string">&quot;fourHundred:withContent:&quot;</span>,adId,age);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;无 返回值&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isAndroid</span>()) &#123;</span><br><span class="line">            <span class="comment">// TODO 安卓平台</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;平台不支持&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 主动调用 timer 返回</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">test500</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>,sec = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isIOS</span>()) &#123;</span><br><span class="line">            result = jsb.<span class="property">reflection</span>.<span class="title function_">callStaticMethod</span>(<span class="string">&quot;AppController&quot;</span>, <span class="string">&quot;fiveHundred:&quot;</span>,sec);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回值&quot;</span>,result);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Browser</span>.<span class="title function_">isAndroid</span>()) &#123;</span><br><span class="line">            <span class="comment">// TODO 安卓平台</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;平台不支持&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TalkBack.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jsroads on 2019/9/24 . 4:14 下午</span></span><br><span class="line"><span class="comment"> * Note:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">TalkBack</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Back init&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">timerTestJSCallBck</span> = <span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JS 成功返回 输出&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Window</span> &#123;</span><br><span class="line">        <span class="attr">talkBack</span>: <span class="title class_">TalkBack</span></span><br><span class="line">        <span class="attr">timerTestJSCallBck</span>:<span class="built_in">any</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Browser.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jsroads on 2019/11/2 . 12:32 下午</span></span><br><span class="line"><span class="comment"> * Note:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Browser</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">now</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cc.<span class="property">sys</span>.<span class="title function_">now</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是小游戏平台</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">onMiniGame</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> cc.<span class="property">sys</span>.<span class="property">browserType</span> === cc.<span class="property">sys</span>.<span class="property">BROWSER_TYPE_WECHAT_GAME</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">isAndroid</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> cc.<span class="property">sys</span>.<span class="property">isNative</span>&amp;&amp;cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_ANDROID</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">isIOS</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> cc.<span class="property">sys</span>.<span class="property">isNative</span>&amp;&amp;(cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span> || cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_OSX</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>最后在Xcode 项目里 运行我们的代码 测试输出</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">JS: 点击了 <span class="string">&#x27;无参无返&#x27;</span> 按钮，开始调用</span><br><span class="line">2019-11-02 15:24:54.807695+0800 jstalknative-mobile[9058:251859] OC收到：无参数，无返回值</span><br><span class="line">JS: 点击了 <span class="string">&#x27;无参有返&#x27;</span> 按钮，开始调用</span><br><span class="line">2019-11-02 15:24:56.726084+0800 jstalknative-mobile[9058:251859] OC收到：有参数，有返回值 返回值：2000</span><br><span class="line">JS: 返回值 2000</span><br><span class="line">JS: 点击了 <span class="string">&#x27;有参有返&#x27;</span> 按钮，开始调用</span><br><span class="line">2019-11-02 15:24:58.406802+0800 jstalknative-mobile[9058:251859] OC收到：有参数，有返回值 cocos10086 和 18 返回值：hello</span><br><span class="line">JS: 返回值 hello</span><br><span class="line">JS: 点击了 <span class="string">&#x27;有参无返&#x27;</span> 按钮，开始调用</span><br><span class="line">2019-11-02 15:24:59.356885+0800 jstalknative-mobile[9058:251859] OC收到：有参数，无返回值 cocos10086 和 18</span><br><span class="line">JS: 无 返回值</span><br><span class="line">JS: 点击了 <span class="string">&#x27;OC 主动调用&#x27;</span> 按钮，1秒后开始</span><br><span class="line">2019-11-02 15:25:00.306419+0800 jstalknative-mobile[9058:251859] OC收到： 1 秒后 调用JS</span><br><span class="line">JS: 返回值 undefined</span><br><span class="line">2019-11-02 15:25:01.320414+0800 jstalknative-mobile[9058:251859] 时间到触发</span><br><span class="line">JS: JS 成功返回 输出 <span class="string">&quot;you are niu B&quot;</span></span><br><span class="line">2019-11-02 15:25:01.321842+0800 jstalknative-mobile[9058:251859] jsCallStr = timerTestJSCallBck(<span class="string">&quot;you are niu B&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>成功调用</p>
<h3 id="项目源码"><a href="#项目源码" class="headerlink" title="项目源码"></a>项目源码</h3><p>此项目 我已经开源放在仓库里 <a target="_blank" rel="noopener" href="https://github.com/jsroads/jstalktonative">点击访问</a></p>
<h4 id="拓展学习："><a href="#拓展学习：" class="headerlink" title="拓展学习："></a>拓展学习：</h4><h5 id="Objective-c-回调JS-（2020-05-25-新增）"><a href="#Objective-c-回调JS-（2020-05-25-新增）" class="headerlink" title="Objective c 回调JS （2020-05-25 新增）"></a>Objective c 回调JS （2020-05-25 新增）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+(void)callJsEngineCallBackStart:(BOOL) mustUpdate &#123;</span><br><span class="line">    NSLog(@&quot;callJsEngineCallBack...&quot;);</span><br><span class="line">    NSString *funcNameStr = @&quot;startCallBackStart&quot;;</span><br><span class="line">    std::string funcName = [funcNameStr UTF8String];</span><br><span class="line">    std::string mustUpdateStr = &quot;update&quot;;</span><br><span class="line">    if(mustUpdate == false)&#123;</span><br><span class="line">        mustUpdateStr = &quot;no&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::string jsCallStr = cocos2d::StringUtils::format(&quot;%s(\&quot;%s\&quot;);&quot;,funcName.c_str(),mustUpdateStr.c_str());</span><br><span class="line">    NSLog(@&quot;jsCallStr = %s&quot;, jsCallStr.c_str());</span><br><span class="line">//    se::ScriptEngine::getInstance()-&gt;evalString(jsCallStr.c_str());</span><br><span class="line">//    auto isDestroyed = _isDestroyed;</span><br><span class="line">       auto scheduler = Application::getInstance()-&gt;getScheduler();</span><br><span class="line">       scheduler-&gt;performFunctionInCocosThread([=]()&#123;</span><br><span class="line">        se::ScriptEngine::getInstance()-&gt;evalString(jsCallStr.c_str());</span><br><span class="line">        NSLog(@&quot;performFunctionInCocosThread...&quot;);</span><br><span class="line">       &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Objective-C-一个方法如何传递多个参数"><a href="#Objective-C-一个方法如何传递多个参数" class="headerlink" title="Objective-C 一个方法如何传递多个参数"></a>Objective-C 一个方法如何传递多个参数</h5><p>一个方法可以包含多个参数，不过后面的参数都要写名字。</p>
<p>多个参数的写法</p>
<p>(方法的数据类型) 函数名: (参数1数据类型) 参数1值的名字 参数2的名字: (参数2数据类型) 参数2值的名字 …. ;</p>
<p>举个例子，一个方法的定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(void) setKids: (NSString *)myOldestKidName secondKid: (NSString *) mySecondOldestKidName thirdKid: (NSString *) myThirdOldestKidName;</span><br></pre></td></tr></table></figure>

<p>实现这个函数的时候：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-(void) setKids: (NSString *)myOldestKidName secondKid: (NSString *) mySecondOldestKidName thirdKid: (NSString *) myThirdOldestKidName&#123;</span><br><span class="line">大儿子 = myOldestKidName;</span><br><span class="line">二儿子 = mySecondOldestKidName;</span><br><span class="line">三儿子 = myThirdOldestKidName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用的时候：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Kids *myKids = [[Kids alloc] init];</span><br><span class="line">[myKids setKids: @”张大力” secondKid: @”张二力” thirdKid: @”张小力”];</span><br></pre></td></tr></table></figure>

<p>下面是initWithNibName方法，传入2个参数的示例代码（Objective-C）：</p>
<p>注意：（1）除第一个参数之外，后面的参数需要写label标签的。</p>
<h5 id="Objective-C-方法调用"><a href="#Objective-C-方法调用" class="headerlink" title="Objective-C 方法调用"></a>Objective-C 方法调用</h5><blockquote>
<p>+表示类方法，-表示实例方法</p>
<p>总结一下几点：</p>
<p>1.类（static）方法</p>
<p>a. 类方法的调用</p>
<p>[类名称 类方法名称];</p>
<p>[Human toString]; </p>
<p>注意：类方法<br>1，类方法可以调用类方法。<br>2，类方法不可以调用实例方法，但是类方法可以通过创建对象来访问实例方法。<br>3，类方法不可以使用实例变量。类方法可以使用self，因为self不是实例变量。<br>4，类方法作为消息，可以被发送到类或者对象里面去（实际上，就是可以通过类或者对象调用类方法的意思）。</p>
<p>2.实例方法</p>
<p>a.实例方法的调用</p>
<p>首先需要实例化该类</p>
<p>Human *man = [Human new]; 或者 Human *man = [Human alloc] init];</p>
<p>[类的实例  实例方法名称];</p>
<p> [man showSex];   </p>
<p>注意:此处实例化该类时，调用了该类的构造函数init</p>
<p>并且该类的构造函数调用[super init]的返回值 不等于 该类的self。</p>
<p>定义子类的实例</p>
<p>Woman *wife = [Woman new]; </p>
<p>此处实例化该类时，调用了该类的构造函数init</p>
<p>并且该类的构造函数调用[super init]的返回值 等于 该类的self。</p>
<p>3.OverWrite方法（覆写，重载）</p>
<p>覆写父类的+(void)toString </p>
<p>调用[Woman toString]; </p>
<p>4.属性（property）</p>
<p>声明一个成员变量BOOL married; </p>
<p>声明set方法-(void) setMarried:(BOOL)m; </p>
<p>声明get方法-(BOOL) Married; </p>
</blockquote>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来讲，这次技术摸索了很久，特别是原生的语法格式，函数调用，中间也查阅了很多API 和文档，也向公司内同事请教了很多问题，最终算是简单实现了，相互调用。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b92d63b2a773">Cocos Creator iOS 互相调用看我的就够了</a> -简书</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/116826d2570c">Cocos creator ios开发—Javascript和Objective-C交互</a> -简书</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhuhai__yizhi/article/details/42197473">Objective-C 一个方法如何传递多个参数？</a>-CSDN</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mars2639/article/details/7282527">Objective-C-类（static）方法、实例方法、overwrite（覆写）、属性（property）</a>-CSDN</li>
</ul>

  </div>
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--页脚广告-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/post/c8509325.html">
        <i class="iconfont icon-angle-left"></i>
        <span>Cocos Creator 热更新（Mac）</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/post/2cb5d315.html">
        <span>Cocos Creator 手动安装更新 SDKBox</span>
        <i class="iconfont icon-angle-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/post/289dec55.html" id="toc-header" class="mdui-ripple">文章目录</a>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E7%8E%AF%E5%A2%83%E6%94%AF%E6%8C%81"><span class="toc-number">1.</span> <span class="toc-text">步骤一：环境支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">步骤二：流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">项目源码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E5%AD%A6%E4%B9%A0%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">拓展学习：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Objective-c-%E5%9B%9E%E8%B0%83JS-%EF%BC%882020-05-25-%E6%96%B0%E5%A2%9E%EF%BC%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">Objective c 回调JS （2020-05-25 新增）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Objective-C-%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E5%A6%82%E4%BD%95%E4%BC%A0%E9%80%92%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text">Objective-C 一个方法如何传递多个参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Objective-C-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">Objective-C 方法调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol>
      </li>
    </ul>
  </div>



  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
        <a href="https://beian.miit.gov.cn" rel="noopener" target="_blank"></a>
      
      <span>
        &copy; 2018 - 2025 
        
          <span style="color:#d9333f" class="iconfont icon-heart"></span>
        
        asroads
      </span>
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span>Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span>Theme: <a href="https://github.com/kb1000fx/Meadow" rel="noopener" target="_blank">Meadow</a></span>
        </div>
      
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span id="busuanzi_container_site_uv" style="display: none;"> <span class="iconfont icon-user"></span>总访客量 <span id="busuanzi_value_site_uv"></span></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span id="busuanzi_container_site_pv" style="display: none;"> <span class="iconfont icon-eye"></span>总访问量 <span id="busuanzi_value_site_pv"></span></span>
        </div>
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  

    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/js/mdui.min.v1.0.0.js"></script>




<script src="/js/meadow.js"></script>

</body>
</html >