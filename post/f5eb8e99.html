<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="/icons/favicon.ico">
    

    
    
        
<link rel="stylesheet" href="/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/iconfont.css">


    
    












          


    
    
    <title>
        
            ironsource海外试玩广告踩坑指南 | Asroads&#39;Blog
        
    </title>
    
    
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Asroads'Blog" type="application/atom+xml">
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/" class="mdui-typo-headline">Asroads&#39;Blog</a>
    <a href="/" class="header-subtitle mdui-typo-headline">君子不器</a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">站点概览</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">关于</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">首页</div>
                </a>
            
                
                <a href="/categories/game" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-folder"></i>
                    </div>
                    <div class="mdui-list-item-content">手游</div>
                </a>
            
                
                <a href="/categories/tool/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-tools"></i>
                    </div>
                    <div class="mdui-list-item-content">技术</div>
                </a>
            
                
                <a href="/categories/other" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-gallery"></i>
                    </div>
                    <div class="mdui-list-item-content">杂项</div>
                </a>
            
                
                <a href="/categories/life" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-blog"></i>
                    </div>
                    <div class="mdui-list-item-content">感悟</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">标签</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">归档</div>
                </a>
            
                
                <a href="/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">关于</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">夜间模式</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="/icons/avatar.png"/>
                
            </div>
            <div class="sidebar-author-name">asroads</div>
            <div class="sidebar-description">自信是成功第一法宝</div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="/jsroads@163.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/jsroads" class="mdui-chip-title">jsroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/asroads" class="mdui-chip-title">asroads</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-qq"></i></span>
                    <a target="_blank" rel="noopener" href="https://jq.qq.com/?_wv=1027&k=fTVxmSSA" class="mdui-chip-title">QQ群</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">友情链接</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://seazhang.github.io/" class="mdui-list-item mdui-ripple">
                            麦田守望者
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://zhaoyabo.github.io/" class="mdui-list-item mdui-ripple">
                            YABO的博客
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://dreamheavenyang.github.io/" class="mdui-list-item mdui-ripple">
                            DreamHeaven
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/post/f5eb8e99.html">ironsource海外试玩广告踩坑指南</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      发布于:&nbsp;2024-09-23
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      更新于:&nbsp;2025-04-22
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      分类于:&nbsp;<a class="category-link" href="/categories/game/">game</a>
    </span>
    
      <span>
        <span class="iconfont icon-eye"></span>
        阅读次数:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=ironsource海外试玩广告踩坑指南&url=http://blog.asroads.com/post/f5eb8e99.html&pic=http://blog.asroads.com/icons/favicon.ico&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=ironsource海外试玩广告踩坑指南&url=http://blog.asroads.com/post/f5eb8e99.html&via=asroads" target="_blank" class="mdui-ripple">分享到 Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.asroads.com/post/f5eb8e99.html" target="_blank" class="mdui-ripple">分享到 Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=http://blog.asroads.com/post/f5eb8e99.html" target="_blank" class="mdui-ripple">分享到 Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://blog.asroads.com/post/f5eb8e99.html&title=ironsource海外试玩广告踩坑指南" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=Asroads&#39;Blog&title=ironsource海外试玩广告踩坑指南&summary=自信是成功第一法宝&pics=http://blog.asroads.com/icons/favicon.ico&url=http://blog.asroads.com/post/f5eb8e99.html" target="_blank" class="mdui-ripple">分享到 QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=http://blog.asroads.com/post/f5eb8e99.html&text=ironsource海外试玩广告踩坑指南" target="_blank" class="mdui-ripple">分享到 Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  <div class="post-tags">
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/Cocos/ >Cocos</a>
      </i>
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/%E8%AF%95%E7%8E%A9/ >试玩</a>
      </i>
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/ironsource/ >ironsource</a>
      </i>
    
  </div>

  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <p>这里是你博客列表显示的摘要文字，现在很多游戏都喜欢用素材广告来吸引用户，就引发了游戏试玩的制作，本身<code>Cocos Creator</code>不支持直接导出试玩，但很多开发者们已经研究了一套试玩的工具和方法策略，下面就简单的说说如何制作海外试玩。</p>
<span id="more"></span>
<p>现在海外的试玩平台有很多。比如 <code>AppLovin</code>、<code>Facebook</code>、<code>Google</code>、<code>IronSource</code>、<code>Liftoff</code>、<code>Mintegral</code>、<code>Moloco</code>、<code>Pangle</code>、<code>Rubeex</code>、<code>Tiktok</code>、<code>Unity</code>等试玩广告平台。这些平台有个特点就是构建导出的web目录，最终要生成一个<code>html</code>文件。</p>
<h2 id="工具插件相关"><a href="#工具插件相关" class="headerlink" title="工具插件相关"></a>工具插件相关</h2><h3 id="super-html（128元）【收费】"><a href="#super-html（128元）【收费】" class="headerlink" title="super-html（128元）【收费】"></a>super-html（128元）【收费】</h3><p><img src="/post/f5eb8e99/680c8252f3c14f33a7a67bf1e1355d9c.png" alt="5F831E2DCB72440180E479CBE99A7801.png"></p>
<p><img src="/post/f5eb8e99/4c7f831ebbe4448e830bde2c85644a90.png" alt="1698944421453.png"></p>
<p>商店地址：<a target="_blank" rel="noopener" href="https://store.cocos.com/app/detail/3657">https://store.cocos.com/app/detail/3657</a></p>
<ul>
<li>接入文档 [<a target="_blank" rel="noopener" href="https://github.com/magician-f/cocos-playable-demo">demo | sdk]</a></li>
<li>最后更新时间：2024-03-07</li>
</ul>
<h3 id="SmartAd试玩打包工具（支持GoogleAds、Facebook等7个渠道）【免费】"><a href="#SmartAd试玩打包工具（支持GoogleAds、Facebook等7个渠道）【免费】" class="headerlink" title="SmartAd试玩打包工具（支持GoogleAds、Facebook等7个渠道）【免费】"></a>SmartAd试玩打包工具（支持GoogleAds、Facebook等7个渠道）【免费】</h3><p><img src="/post/f5eb8e99/c250734851e3600c09bc1931c92bb1f522790.jpg" alt="打包.jpg"></p>
<p>商店地址：<a target="_blank" rel="noopener" href="https://store.cocos.com/app/detail/3732">https://store.cocos.com/app/detail/3732</a></p>
<ul>
<li>最后更新时间：2022-05-11</li>
</ul>
<h3 id="CreatePlayableAd【免费】"><a href="#CreatePlayableAd【免费】" class="headerlink" title="CreatePlayableAd【免费】"></a>CreatePlayableAd【免费】</h3><p><img src="/post/f5eb8e99/5ecd2a51440047ca9fc9974ed791e8d1.png" alt="1715875139821.png"></p>
<p><img src="/post/f5eb8e99/5f923df290fa45dfb4ccf0441631797c.png" alt="1715875347947.png"></p>
<h4 id="插件特色"><a href="#插件特色" class="headerlink" title="插件特色"></a>插件特色</h4><ul>
<li>没有sdk，没有sdk，没有sdk（重要的事情说三遍）。所以扩展性极高，任何新的平台都可以轻松拿捏</li>
<li>支持绝大多数 cocos 2d 组件。例如 spine/plist/particle……</li>
<li>支持的文件格式完全满足需要，包含 json/plist/js/pem/atlas……</li>
<li>支持的资源格式也足够丰富，包含 wasm/png/jpg/gif/wav/bin/mp3/ttf/dbbin/mp4……</li>
</ul>
<p>插件地址：<a target="_blank" rel="noopener" href="https://store.cocos.com/app/detail/6293">https://store.cocos.com/app/detail/6293</a></p>
<p>最后更新时间：2024-06-18</p>
<h3 id="Playable-ads-adapter【免费】"><a href="#Playable-ads-adapter【免费】" class="headerlink" title="Playable ads adapter【免费】"></a>Playable ads adapter【免费】</h3><p>地址：<a target="_blank" rel="noopener" href="https://github.com/ppgee/cocos-pnp">https://github.com/ppgee/cocos-pnp</a></p>
<p>Cocos广告试玩多渠道导出插件</p>
<h4 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h4><p>如果只是使用，可以直接下载构建包，大版本区分2.x和3.x，目前已通过测试的版本是2.4.9、2.4.10、3.6.0、3.8.2，其他版本自行测试，有问题欢迎提issue或者解决提mr</p>
<h4 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h4><p>插件下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ppgee/cocos-pnp/releases?q=playable-ads-adapter&amp;expanded=true">https://github.com/ppgee/cocos-pnp/releases?q=playable-ads-adapter&amp;expanded=true</a></p>
<blockquote>
<h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><p>将下载好的插件解压后放到Cocos对应的插件文件夹：</p>
<ul>
<li>2.x的插件目录是项目根目录的packages</li>
<li>3.x的插件目录是项目根目录的extensions</li>
</ul>
<p>安装后即可使用（如果找不到插件的，可以选择重启一下项目）</p>
<h4 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h4><ul>
<li>插件有两种方式进行适配，第一种是正常点击项目构建发布（构建渠道请选择 <code>web-mobile</code> 或者 <code>web-desktop</code>）时，自动触发适配功能</li>
<li>项目选项栏中出现 <strong>多渠道构建</strong> ，点击该选项下的 <strong>开始构建</strong>进行构建</li>
</ul>
<h4 id="插件说明"><a href="#插件说明" class="headerlink" title="插件说明"></a>插件说明</h4><h4 id="支持渠道"><a href="#支持渠道" class="headerlink" title="支持渠道"></a>支持渠道</h4><table>
<thead>
<tr>
<th></th>
<th>AppLovin</th>
<th>Facebook</th>
<th>Google</th>
<th>IronSource</th>
<th>Liftoff</th>
<th>Mintegral</th>
<th>Moloco</th>
<th>Pangle</th>
<th>Rubeex</th>
<th>Tiktok</th>
<th>Unity</th>
</tr>
</thead>
<tbody><tr>
<td><strong>&gt;= 2.4.6</strong></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><strong>3.8.x</strong></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody></table>
</blockquote>
<h3 id="Cocos-Creator-Build-Tool"><a href="#Cocos-Creator-Build-Tool" class="headerlink" title="Cocos-Creator-Build-Tool"></a>Cocos-Creator-Build-Tool</h3><p>地址：<a target="_blank" rel="noopener" href="https://gitee.com/welcome2jcSpace/Cocos-Creator-Build-Tool">https://gitee.com/welcome2jcSpace/Cocos-Creator-Build-Tool</a></p>
<p>可以解决CocosCreator2.4x版本Web包跨域问题打包成单Html</p>
<p>论坛地址：<a target="_blank" rel="noopener" href="https://forum.cocos.org/t/topic/120482">https://forum.cocos.org/t/topic/120482</a></p>
<h2 id="其他制作"><a href="#其他制作" class="headerlink" title="其他制作"></a>其他制作</h2><h3 id="SmartAd试玩广告制作平台"><a href="#SmartAd试玩广告制作平台" class="headerlink" title="SmartAd试玩广告制作平台"></a>SmartAd试玩广告制作平台</h3><p>官方地址：<a target="_blank" rel="noopener" href="https://www.smartad.pro/">https://www.smartad.pro/</a></p>
<p><img src="/post/f5eb8e99/image-20240801172718174.png" alt="image-20240801172718174"></p>
<p><img src="/post/f5eb8e99/image-20240801172728968.png" alt="image-20240801172728968"></p>
<h4 id="试玩多渠道支持添加SDK操作说明"><a href="#试玩多渠道支持添加SDK操作说明" class="headerlink" title="试玩多渠道支持添加SDK操作说明"></a>试玩多渠道支持添加SDK操作说明</h4><h5 id="添加SDK"><a href="#添加SDK" class="headerlink" title="添加SDK"></a>添加SDK</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.smartad_sdk &amp;&amp; window.smartad_sdk() </span><br></pre></td></tr></table></figure>

<h5 id="SDK调用时机"><a href="#SDK调用时机" class="headerlink" title="SDK调用时机"></a>SDK调用时机</h5><p>在试玩广告的落地页安装按钮（有的渠道也称下载按钮）点击时调用上述SDK。</p>
<h4 id="优化文章"><a href="#优化文章" class="headerlink" title="优化文章"></a>优化文章</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.smartad.pro/help/4">Cocos试玩加载速度优化</a></li>
<li><a target="_blank" rel="noopener" href="https://www.smartad.pro/help/5">包体大小优化</a></li>
</ul>
<h3 id="微游H5出海开发者中心"><a href="#微游H5出海开发者中心" class="headerlink" title="微游H5出海开发者中心"></a>微游H5出海开发者中心</h3><p>官方地址：<a target="_blank" rel="noopener" href="https://www.minigamecloud.com/">https://www.minigamecloud.com/</a></p>
<p><img src="/post/f5eb8e99/image-20240923164213335.png" alt="image-20240923164213335"></p>
<h4 id="SDK接入指南"><a href="#SDK接入指南" class="headerlink" title="SDK接入指南"></a>SDK接入指南</h4><p><a target="_blank" rel="noopener" href="https://www.minigamecloud.com/docs/cocos-creator-2.xjieruzhinan">https://www.minigamecloud.com/docs/cocos-creator-2.xjieruzhinan</a></p>
<h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2><p>这里我们使用一个免费版 <a target="_blank" rel="noopener" href="https://github.com/ppgee/cocos-pnp">Playable ads adapter</a></p>
<h4 id="修改源码"><a href="#修改源码" class="headerlink" title="修改源码"></a>修改源码</h4><p><img src="/post/f5eb8e99/image-20240923171903693.png" alt="image-20240923171903693"></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">AD_SDK_SCRIPT</span> = <span class="string">`&lt;script&gt;&quot;use strict&quot;;function _typeof(e)&#123;return(_typeof=&quot;function&quot;==typeof Symbol&amp;&amp;&quot;symbol&quot;==typeof Symbol.iterator?function(e)&#123;return typeof e&#125;:function(e)&#123;return e&amp;&amp;&quot;function&quot;==typeof Symbol&amp;&amp;e.constructor===Symbol&amp;&amp;e!==Symbol.prototype?&quot;symbol&quot;:typeof e&#125;)(e)&#125;function _classCallCheck(e,t)&#123;if(!(e instanceof t))throw new TypeError(&quot;Cannot call a class as a function&quot;)&#125;function _defineProperties(e,t)&#123;for(var i=0;i&lt;t.length;i++)&#123;var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,&quot;value&quot;in n&amp;&amp;(n.writable=!0),Object.defineProperty(e,n.key,n)&#125;&#125;function _createClass(e,t,i)&#123;return t&amp;&amp;_defineProperties(e.prototype,t),i&amp;&amp;_defineProperties(e,i),e&#125;var Config=&#123;LIB_VERSION:&quot;2.2.4&quot;,LIB_NAME:&quot;MG&quot;&#125;,_=&#123;&#125;,ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker=&#123;&#125;,utmTypes=[&quot;utm_source&quot;,&quot;utm_medium&quot;,&quot;utm_campaign&quot;,&quot;utm_content&quot;,&quot;utm_term&quot;];_.each=function(e,t,i)&#123;if(null==e)return!1;if(nativeForEach&amp;&amp;e.forEach===nativeForEach)e.forEach(t,i);else if(e.length===+e.length)&#123;for(var n=0,a=e.length;n&lt;a;n++)if(n in e&amp;&amp;t.call(i,e[n],n,e)===breaker)return!1&#125;else for(var r in e)if(nativeHasOwnProperty.call(e,r)&amp;&amp;t.call(i,e[r],r,e)===breaker)return!1&#125;,_.extend=function(i)&#123;return _.each(slice.call(arguments,1),function(e)&#123;for(var t in e)void 0!==e[t]&amp;&amp;(i[t]=e[t])&#125;),i&#125;,_.extend2Layers=function(i)&#123;return _.each(slice.call(arguments,1),function(e)&#123;for(var t in e)void 0!==e[t]&amp;&amp;(_.isObject(e[t])&amp;&amp;_.isObject(i[t])?_.extend(i[t],e[t]):i[t]=e[t])&#125;),i&#125;,_.isArray=nativeIsArray||function(e)&#123;return&quot;[object Array]&quot;===nativeToString.call(e)&#125;,_.isFunction=function(e)&#123;try&#123;return&quot;function&quot;==typeof e&#125;catch(e)&#123;return!1&#125;&#125;,_.isPromise=function(e)&#123;return&quot;[object Promise]&quot;===nativeToString.call(e)&amp;&amp;null!=e&#125;,_.isObject=function(e)&#123;return&quot;[object Object]&quot;===nativeToString.call(e)&amp;&amp;null!=e&#125;,_.isEmptyObject=function(e)&#123;if(_.isObject(e))&#123;for(var t in e)if(nativeHasOwnProperty.call(e,t))return!1;return!0&#125;return!1&#125;,_.isUndefined=function(e)&#123;return void 0===e&#125;,_.isString=function(e)&#123;return&quot;[object String]&quot;===nativeToString.call(e)&#125;,_.isDate=function(e)&#123;return&quot;[object Date]&quot;===nativeToString.call(e)&#125;,_.isBoolean=function(e)&#123;return&quot;[object Boolean]&quot;===nativeToString.call(e)&#125;,_.isNumber=function(e)&#123;return&quot;[object Number]&quot;===nativeToString.call(e)&amp;&amp;/[\\d\\.]+/.test(String(e))&#125;,_.isJSONString=function(e)&#123;try&#123;JSON.parse(e)&#125;catch(e)&#123;return!1&#125;return!0&#125;,_.decodeURIComponent=function(t)&#123;var i=&quot;&quot;;try&#123;i=decodeURIComponent(t)&#125;catch(e)&#123;i=t&#125;return i&#125;,_.encodeURIComponent=function(t)&#123;var i=&quot;&quot;;try&#123;i=encodeURIComponent(t)&#125;catch(e)&#123;i=t&#125;return i&#125;,_.utf8Encode=function(e)&#123;for(var t,i=&quot;&quot;,n=t=0,a=(e=(e+&quot;&quot;).replace(/\\r\\n/g,&quot;\\n&quot;).replace(/\\r/g,&quot;\\n&quot;)).length,r=0;r&lt;a;r++)&#123;var s=e.charCodeAt(r),o=null;s&lt;128?t++:o=127&lt;s&amp;&amp;s&lt;2048?String.fromCharCode(s&gt;&gt;6|192,63&amp;s|128):String.fromCharCode(s&gt;&gt;12|224,s&gt;&gt;6&amp;63|128,63&amp;s|128),null!==o&amp;&amp;(n&lt;t&amp;&amp;(i+=e.substring(n,t)),i+=o,n=t=r+1)&#125;return n&lt;t&amp;&amp;(i+=e.substring(n,e.length)),i&#125;,_.base64Encode=function(e)&#123;var t,i,n,a,r=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;,s=0,o=0,c=&quot;&quot;,u=[];if(!e)return e;for(e=_.utf8Encode(e);t=(a=e.charCodeAt(s++)&lt;&lt;16|e.charCodeAt(s++)&lt;&lt;8|e.charCodeAt(s++))&gt;&gt;18&amp;63,i=a&gt;&gt;12&amp;63,n=a&gt;&gt;6&amp;63,a=63&amp;a,u[o++]=r.charAt(t)+r.charAt(i)+r.charAt(n)+r.charAt(a),s&lt;e.length;);switch(c=u.join(&quot;&quot;),e.length%3)&#123;case 1:c=c.slice(0,-2)+&quot;==&quot;;break;case 2:c=c.slice(0,-1)+&quot;=&quot;&#125;return c&#125;,_.encodeDates=function(n)&#123;return _.each(n,function(e,t)&#123;if(_.isDate(e))n[t]=_.formatDate(e);else if(_.isObject(e))n[t]=_.encodeDates(e);else if(_.isArray(e))for(var i=0;i&lt;e.length;i++)_.isDate(e[i])&amp;&amp;(n[t][i]=_.formatDate(e[i]))&#125;),n&#125;,_.formatDate=function(e)&#123;function t(e)&#123;return e&lt;10?&quot;0&quot;+e:e&#125;return e.getFullYear()+&quot;-&quot;+t(e.getMonth()+1)+&quot;-&quot;+t(e.getDate())+&quot; &quot;+t(e.getHours())+&quot;:&quot;+t(e.getMinutes())+&quot;:&quot;+t(e.getSeconds())+&quot;.&quot;+((i=e.getMilliseconds())&lt;100&amp;&amp;9&lt;i?&quot;0&quot;+i:i&lt;10?&quot;00&quot;+i:i);var i&#125;,_.searchObjDate=function(i)&#123;try&#123;(_.isObject(i)||_.isArray(i))&amp;&amp;_.each(i,function(e,t)&#123;_.isObject(e)||_.isArray(e)?_.searchObjDate(i[t]):_.isDate(e)&amp;&amp;(i[t]=_.formatDate(e))&#125;)&#125;catch(e)&#123;logger$1.warn(e)&#125;&#125;,_.UUID=function()&#123;var e=(new Date).getTime();return String(Math.random()).replace(&quot;.&quot;,&quot;&quot;).slice(1,11)+&quot;-&quot;+e&#125;,_.UUIDv4=function()&#123;return&quot;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&quot;.replace(/[xy]/g,function(e)&#123;var t=16*Math.random()|0;return(&quot;x&quot;===e?t:3&amp;t|8).toString(16)&#125;)&#125;,_.setMpPlatform=function(e)&#123;_.mpPlatform=e&#125;,_.getMpPlatform=function()&#123;return _.mpPlatform&#125;,_.createExtraHeaders=function()&#123;return&#123;&quot;TA-Integration-Type&quot;:Config.LIB_NAME,&quot;TA-Integration-Version&quot;:Config.LIB_VERSION,&quot;TA-Integration-Count&quot;:&quot;1&quot;,&quot;TA-Integration-Extra&quot;:_.getMpPlatform()&#125;&#125;,_.checkAppId=function(e)&#123;return e=e.replace(/\\s*/g,&quot;&quot;)&#125;,_.checkUrl=function(e)&#123;return e=e.replace(/\\s*/g,&quot;&quot;),e=_.url(&quot;basic&quot;,e)&#125;,_.url=function()&#123;function a()&#123;return new RegExp(/(.*?)\\.?([^.]*?)\\.(com|net|org|biz|ws|in|me|co\\.uk|co|org\\.uk|ltd\\.uk|plc\\.uk|me\\.uk|edu|mil|br\\.com|cn\\.com|eu\\.com|hu\\.com|no\\.com|qc\\.com|sa\\.com|se\\.com|se\\.net|us\\.com|uy\\.com|ac|co\\.ac|gv\\.ac|or\\.ac|ac\\.ac|af|am|as|at|ac\\.at|co\\.at|gv\\.at|or\\.at|asn\\.au|com\\.au|edu\\.au|org\\.au|net\\.au|id\\.au|be|ac\\.be|adm\\.br|adv\\.br|am\\.br|arq\\.br|art\\.br|bio\\.br|cng\\.br|cnt\\.br|com\\.br|ecn\\.br|eng\\.br|esp\\.br|etc\\.br|eti\\.br|fm\\.br|fot\\.br|fst\\.br|g12\\.br|gov\\.br|ind\\.br|inf\\.br|jor\\.br|lel\\.br|med\\.br|mil\\.br|net\\.br|nom\\.br|ntr\\.br|odo\\.br|org\\.br|ppg\\.br|pro\\.br|psc\\.br|psi\\.br|rec\\.br|slg\\.br|tmp\\.br|tur\\.br|tv\\.br|vet\\.br|zlg\\.br|br|ab\\.ca|bc\\.ca|mb\\.ca|nb\\.ca|nf\\.ca|ns\\.ca|nt\\.ca|on\\.ca|pe\\.ca|qc\\.ca|sk\\.ca|yk\\.ca|ca|cc|ac\\.cn|net\\.cn|com\\.cn|edu\\.cn|gov\\.cn|org\\.cn|bj\\.cn|sh\\.cn|tj\\.cn|cq\\.cn|he\\.cn|nm\\.cn|ln\\.cn|jl\\.cn|hl\\.cn|js\\.cn|zj\\.cn|ah\\.cn|gd\\.cn|gx\\.cn|hi\\.cn|sc\\.cn|gz\\.cn|yn\\.cn|xz\\.cn|sn\\.cn|gs\\.cn|qh\\.cn|nx\\.cn|xj\\.cn|tw\\.cn|hk\\.cn|mo\\.cn|cn|cx|cz|de|dk|fo|com\\.ec|tm\\.fr|com\\.fr|asso\\.fr|presse\\.fr|fr|gf|gs|co\\.il|net\\.il|ac\\.il|k12\\.il|gov\\.il|muni\\.il|ac\\.in|co\\.in|org\\.in|ernet\\.in|gov\\.in|net\\.in|res\\.in|is|it|ac\\.jp|co\\.jp|go\\.jp|or\\.jp|ne\\.jp|ac\\.kr|co\\.kr|go\\.kr|ne\\.kr|nm\\.kr|or\\.kr|li|lt|lu|asso\\.mc|tm\\.mc|com\\.mm|org\\.mm|net\\.mm|edu\\.mm|gov\\.mm|ms|nl|no|nu|pl|ro|org\\.ro|store\\.ro|tm\\.ro|firm\\.ro|www\\.ro|arts\\.ro|rec\\.ro|info\\.ro|nom\\.ro|nt\\.ro|se|si|com\\.sg|org\\.sg|net\\.sg|gov\\.sg|sk|st|tf|ac\\.th|co\\.th|go\\.th|mi\\.th|net\\.th|or\\.th|tm|to|com\\.tr|edu\\.tr|gov\\.tr|k12\\.tr|net\\.tr|org\\.tr|com\\.tw|org\\.tw|net\\.tw|ac\\.uk|uk\\.com|uk\\.net|gb\\.com|gb\\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\\.hk|org\\.hk|net\\.hk|edu\\.hk|us|tk|cd|by|ad|lv|eu\\.lv|bz|es|jp|cl|ag|mobi|eu|co\\.nz|org\\.nz|net\\.nz|maori\\.nz|iwi\\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\\.pt|edu\\.pt|asia|fi|com\\.ve|net\\.ve|fi|org\\.ve|web\\.ve|info\\.ve|co\\.ve|tel|im|gr|ru|net\\.ru|org\\.ru|hr|com\\.hr|ly|xyz)$/)&#125;function r(e,t)&#123;var i=e.charAt(0),t=t.split(i);return i===e?t:t[(e=parseInt(e.substring(1),10))&lt;0?t.length+e:e-1]&#125;function s(e,t)&#123;for(var i,n,a=e.charAt(0),r=t.split(&quot;&amp;&quot;),s=[],o=&#123;&#125;,c=e.substring(1),u=0,l=r.length;u&lt;l;u++)if(&quot;&quot;!==(s=(s=r[u].match(/(.*?)=(.*)/))||[r[u],r[u],&quot;&quot;])[1].replace(/\\s/g,&quot;&quot;))&#123;if(s[2]=(n=s[2]||&quot;&quot;,_.decodeURIComponent(n.replace(/\\+/g,&quot; &quot;))),c===s[1])return s[2];(i=s[1].match(/(.*)\\[([0-9]+)\\]/))?(o[i[1]]=o[i[1]]||[],o[i[1]][i[2]]=s[2]):o[s[1]]=s[2]&#125;return a===e?o:o[c]&#125;return function(e,t)&#123;var i=&#123;&#125;;if(&quot;tld?&quot;===e)return a();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),t.match(/^mailto:([^/].+)/))n=t.match(/^mailto:([^/].+)/),i.protocol=&quot;mailto&quot;,i.email=n[1];else&#123;if(t.match(/(.*?)\\/#!(.*)/)&amp;&amp;(t=(n=t.match(/(.*?)\\/#!(.*)/))[1]+n[2]),t.match(/(.*?)#(.*)/)&amp;&amp;(n=t.match(/(.*?)#(.*)/),i.hash=n[2],t=n[1]),i.hash&amp;&amp;e.match(/^#/))return s(e,i.hash);if(t.match(/(.*?)\\?(.*)/)&amp;&amp;(n=t.match(/(.*?)\\?(.*)/),i.query=n[2],t=n[1]),i.query&amp;&amp;e.match(/^\\?/))return s(e,i.query);if(t.match(/(.*?):?\\/\\/(.*)/)&amp;&amp;(n=t.match(/(.*?):?\\/\\/(.*)/),i.protocol=n[1].toLowerCase(),t=n[2]),t.match(/(.*?)(\\/.*)/)&amp;&amp;(n=t.match(/(.*?)(\\/.*)/),i.path=n[2],t=n[1]),i.path=(i.path||&quot;&quot;).replace(/^([^/])/,&quot;/$1&quot;).replace(/\\/$/,&quot;&quot;),e.match(/^[-0-9]+$/)&amp;&amp;(e=e.replace(/^([^/])/,&quot;/$1&quot;)),e.match(/^\\//))return r(e,i.path.substring(1));if((n=(n=r(&quot;/-1&quot;,i.path.substring(1)))&amp;&amp;n.match(/(.*?)\\.(.*)/))&amp;&amp;(i.file=n[0],i.filename=n[1],i.fileext=n[2]),t.match(/(.*):([0-9]+)$/)&amp;&amp;(n=t.match(/(.*):([0-9]+)$/),i.port=n[2],t=n[1]),t.match(/(.*?)@(.*)/)&amp;&amp;(n=t.match(/(.*?)@(.*)/),i.auth=n[1],t=n[2]),i.auth&amp;&amp;(n=i.auth.match(/(.*):(.*)/),i.user=n?n[1]:i.auth,i.pass=n?n[2]:void 0),i.hostname=t.toLowerCase(),&quot;.&quot;===e.charAt(0))return r(e,i.hostname);a()&amp;&amp;(n=i.hostname.match(a()))&amp;&amp;(i.tld=n[3],i.domain=n[2]?n[2]+&quot;.&quot;+n[3]:void 0,i.sub=n[1]||void 0);var n=i.port?&quot;:&quot;+i.port:&quot;&quot;;i.protocol=i.protocol||window.location.protocol.replace(&quot;:&quot;,&quot;&quot;),i.port=i.port||(&quot;https&quot;===i.protocol?&quot;443&quot;:&quot;80&quot;),i.protocol=i.protocol||(&quot;443&quot;===i.port?&quot;https&quot;:&quot;http&quot;),i.basic=i.protocol+&quot;://&quot;+i.hostname+n&#125;return e in i?i[e]:&quot;&#123;&#125;&quot;===e?i:&quot;&quot;&#125;&#125;(),_.createString=function(e)&#123;for(var t=e,i=Math.random().toString(36).substr(2);i.length&lt;t;)i+=Math.random().toString(36).substr(2);return i=i.substr(0,e)&#125;,_.createAesKey=function()&#123;return _.createString(16)&#125;,_.generateEncryptyData=function(e,t)&#123;if(void 0===t)return e;var i=t.publicKey,n=t.version;if(void 0===i||void 0===n)return e;if(&quot;undefined&quot;==typeof CryptoJS||&quot;undefined&quot;==typeof JSEncrypt)return e;var a=_.createAesKey();try&#123;var r=CryptoJS.enc.Utf8.parse(a),s=CryptoJS.enc.Utf8.parse(JSON.stringify(e)),o=_.isUndefined(CryptoJS.pad.Pkcs7)?CryptoJS.pad.PKCS7:CryptoJS.pad.Pkcs7,r=CryptoJS.AES.encrypt(s,r,&#123;mode:CryptoJS.mode.ECB,padding:o&#125;).toString(),o=new JSEncrypt;o.setPublicKey(i);o=o.encrypt(a);return!1===o?(logger$1.warn(&quot;Encryption failed, return the original data&quot;),e):&#123;pkv:n,ekey:o,payload:r&#125;&#125;catch(e)&#123;logger$1.warn(&quot;Encryption failed, return the original data: &quot;+e)&#125;return e&#125;,_.getUtm=function()&#123;var i=&#123;&#125;;return _.each(utmTypes,function(e)&#123;try&#123;var t=_.getQueryParam(location.href,e);t.length&amp;&amp;(i[e]=t)&#125;catch(e)&#123;logger$1.warn(&quot;get utm fail: &quot;+e)&#125;&#125;),JSON.stringify(i)&#125;,_.getQueryParam=function(e,t)&#123;t=t.replace(/[\\[]/,&quot;\\\\[&quot;).replace(/[\\]]/,&quot;\\\\]&quot;),e=_.decodeURIComponent(e);e=new RegExp(&quot;[\\\\?&amp;]&quot;+t+&quot;=([^&amp;#]*)&quot;).exec(e);return null===e||e&amp;&amp;&quot;string&quot;!=typeof e[1]&amp;&amp;e[1].length?&quot;&quot;:_.decodeURIComponent(e[1])&#125;,_.getUtmFromQuery=function(t)&#123;var i=&#123;&#125;;return _.each(utmTypes,function(e)&#123;t[e]&amp;&amp;(i[e]=t[e])&#125;),JSON.stringify(i)&#125;,_.indexOf=function(e,t)&#123;var i=e.indexOf;if(i)return i.call(e,t);for(var n=0;n&lt;e.length;n++)if(t===e[n])return n;return-1&#125;,_.checkCalibration=function(e,t,i)&#123;return e&#125;;var logger$1=&quot;object&quot;===_typeof(logger$1)?logger$1:&#123;&#125;;logger$1.info=function()&#123;if(&quot;object&quot;===(&quot;undefined&quot;==typeof console?&quot;undefined&quot;:_typeof(console))&amp;&amp;console.log&amp;&amp;logger$1.enabled)try&#123;return console.log.apply(console,arguments)&#125;catch(e)&#123;console.log(arguments[0])&#125;&#125;,logger$1.warn=function()&#123;if(&quot;object&quot;===(&quot;undefined&quot;==typeof console?&quot;undefined&quot;:_typeof(console))&amp;&amp;console.log&amp;&amp;logger$1.enabled)try&#123;return console.warn.apply(console,arguments)&#125;catch(e)&#123;console.warn(arguments[0])&#125;&#125;;var PlatformProxy=function()&#123;function e()&#123;_classCallCheck(this,e),this.config=&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_mg&quot;&#125;&#125;return _createClass(e,[&#123;key:&quot;getConfig&quot;,value:function()&#123;return this.config&#125;&#125;,&#123;key:&quot;getStorage&quot;,value:function(e,t,i)&#123;e=localStorage.getItem(e);if(!t)return _.isJSONString(e)?JSON.parse(e):&#123;&#125;;_.isJSONString(e)?i(JSON.parse(e)):i(&#123;&#125;)&#125;&#125;,&#123;key:&quot;setStorage&quot;,value:function(e,t)&#123;localStorage.setItem(e,t)&#125;&#125;,&#123;key:&quot;removeStorage&quot;,value:function(e)&#123;localStorage.removeItem(e)&#125;&#125;,&#123;key:&quot;_setSystemProxy&quot;,value:function(e)&#123;this._sysCallback=e&#125;&#125;,&#123;key:&quot;getSystemInfo&quot;,value:function(e)&#123;var t=&#123;mp_platform:&quot;web&quot;,system:this._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height,systemLanguage:navigator.language&#125;;this._sysCallback&amp;&amp;(t=_.extend(t,this._sysCallback(e))),e.success(t),e.complete()&#125;&#125;,&#123;key:&quot;_getOs&quot;,value:function()&#123;var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?&quot;Windows Phone&quot;:&quot;Windows&quot;:/(iPhone|iPad|iPod)/.test(e)?&quot;iOS&quot;:/Android/.test(e)?&quot;Android&quot;:/(BlackBerry|PlayBook|BB10)/i.test(e)?&quot;BlackBerry&quot;:/Mac/i.test(e)?&quot;MacOS&quot;:/Linux/.test(e)?&quot;Linux&quot;:/CrOS/.test(e)?&quot;ChromeOS&quot;:&quot;&quot;&#125;&#125;,&#123;key:&quot;getNetworkType&quot;,value:function(e)&#123;e.complete()&#125;&#125;,&#123;key:&quot;onNetworkStatusChange&quot;,value:function()&#123;&#125;&#125;,&#123;key:&quot;request&quot;,value:function(e)&#123;var t=&#123;&#125;,i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function()&#123;4===i.readyState&amp;&amp;200===i.status?(t.statusCode=200,_.isJSONString(i.responseText)&amp;&amp;(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&amp;&amp;(t.errMsg=&quot;network error&quot;,e.fail(t))&#125;,i.ontimeout=function()&#123;t.errMsg=&quot;timeout&quot;,e.fail(t)&#125;,i.send(e.data),i&#125;&#125;,&#123;key:&quot;initAutoTrackInstance&quot;,value:function(e,t)&#123;this.instance=e,this.autoTrack=t.autoTrack;var i=this;&quot;onpagehide&quot;in window?window.onpagehide=function()&#123;i.onPageHide(!0)&#125;:window.onbeforeunload=function()&#123;i.onPageHide(!0)&#125;,i.onPageShow(),i.autoTrack.appHide&amp;&amp;i.instance.timeEvent(&quot;ta_page_hide&quot;),&quot;onvisibilitychange&quot;in document&amp;&amp;(document.onvisibilitychange=function()&#123;document.hidden?i.onPageHide(!1):(i.onPageShow(),i.autoTrack.appHide&amp;&amp;i.instance.timeEvent(&quot;ta_page_hide&quot;))&#125;)&#125;&#125;,&#123;key:&quot;setGlobal&quot;,value:function(e,t)&#123;window[t]=e&#125;&#125;,&#123;key:&quot;getAppOptions&quot;,value:function()&#123;&#125;&#125;,&#123;key:&quot;showToast&quot;,value:function()&#123;&#125;&#125;,&#123;key:&quot;onPageShow&quot;,value:function()&#123;var e;this.autoTrack.appShow&amp;&amp;(e=&#123;&#125;,_.extend(e,this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&amp;&amp;_.extend(e,this.autoTrack.callback(&quot;appShow&quot;)),this.instance._internalTrack(&quot;ta_page_show&quot;,e))&#125;&#125;,&#123;key:&quot;onPageHide&quot;,value:function(e)&#123;var t;this.autoTrack.appHide&amp;&amp;(t=&#123;&#125;,_.extend(t,this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&amp;&amp;_.extend(t,this.autoTrack.callback(&quot;appHide&quot;)),this.instance._internalTrack(&quot;ta_page_hide&quot;,t,new Date,null,e))&#125;&#125;],[&#123;key:&quot;createInstance&quot;,value:function()&#123;return new e&#125;&#125;]),e&#125;(),AutoTrackBridge=function()&#123;function i(e,t)&#123;_classCallCheck(this,i),this.taInstance=e,this.config=t||&#123;&#125;,this.referrer=&quot;Directly open&quot;,this.config.isPlugin?(e.App=function()&#123;App.apply(this,arguments)&#125;,inension(e.Page)):(e=App,App=this._initAppExtention(e),e=Page,Page=this._initPageExtension(e))&#125;return _createClass(i,[&#123;key:&quot;_initPageExtension&quot;,value:function(n)&#123;var a=this;return function(e)&#123;var t=e.onShow,i=e.onShareAppMessage;return e.onShow=function(e)&#123;a.onPageShow(),&quot;function&quot;==typeof t&amp;&amp;t.call(this,e)&#125;,&quot;function&quot;==typeof i&amp;&amp;(e.onShareAppMessage=function(e)&#123;e=i.call(this,e);return a.onPageShare(e)&#125;),n(e)&#125;&#125;&#125;,&#123;key:&quot;_initAppExtention&quot;,value:function(a)&#123;var r=this;return function(e)&#123;var t=e.onLaunch,i=e.onShow,n=e.onHide;return e.onLaunch=function(e)&#123;r.onAppLaunch(e,this),&quot;function&quot;==typeof t&amp;&amp;t.call(this,e)&#125;,e.onShow=function(e)&#123;r.onAppShow(e),&quot;function&quot;==typeof i&amp;&amp;i.call(this,e)&#125;,e.onHide=function()&#123;r.onAppHide(),&quot;function&quot;==typeof n&amp;&amp;n.call(this)&#125;,a(e)&#125;&#125;&#125;,&#123;key:&quot;onAppLaunch&quot;,value:function(e,t)&#123;this._setAutoTrackProperties(e),_.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch&amp;&amp;(t=&#123;&#125;,e&amp;&amp;e.path&amp;&amp;(t[&quot;#url_path&quot;]=this._getPath(e.path)),e&amp;&amp;e.query&amp;&amp;(t[&quot;#utm&quot;]=_.getUtmFromQuery(e.query)),this.taInstance._internalTrack(&quot;ta_mp_launch&quot;,t))&#125;&#125;,&#123;key:&quot;onAppShow&quot;,value:function(e)&#123;var t;this.config.appHide&amp;&amp;this.taInstance.timeEvent(&quot;ta_mp_hide&quot;),this._setAutoTrackProperties(e),this.config.appShow&amp;&amp;(t=&#123;&#125;,e&amp;&amp;e.path&amp;&amp;(t[&quot;#url_path&quot;]=this._getPath(e.path)),e&amp;&amp;e.query&amp;&amp;(t[&quot;#utm&quot;]=_.getUtmFromQuery(e.query)),_.extend(t,this.config.properties),_.isFunction(this.config.callback)&amp;&amp;_.extend(t,this.config.callback(&quot;appShow&quot;)),this.taInstance._internalTrack(&quot;ta_mp_show&quot;,t))&#125;&#125;,&#123;key:&quot;onAppHide&quot;,value:function()&#123;var e;this.config.appHide&amp;&amp;(e=&#123;&quot;#url_path&quot;:this._getCurrentPath()&#125;,_.extend(e,this.config.properties),_.isFunction(this.config.callback)&amp;&amp;_.extend(e,this.config.callback(&quot;appHide&quot;)),this.taInstance._internalTrack(&quot;ta_mp_hide&quot;,e))&#125;&#125;,&#123;key:&quot;_getCurrentPath&quot;,value:function()&#123;var e=&quot;Not to get&quot;;try&#123;var t=getCurrentPages(),e=t[t.length-1].route&#125;catch(e)&#123;logger$1.info(e)&#125;return e&#125;&#125;,&#123;key:&quot;_setAutoTrackProperties&quot;,value:function(e)&#123;e=&#123;&quot;#scene&quot;:e.scene&#125;;this.taInstance._setAutoTrackProperties(e)&#125;&#125;,&#123;key:&quot;_getPath&quot;,value:function(e)&#123;return&quot;string&quot;==typeof e?e.replace(/^\\//,&quot;&quot;):&quot;Abnormal values&quot;&#125;&#125;,&#123;key:&quot;onPageShare&quot;,value:function(e)&#123;return this.config.pageShare&amp;&amp;this.taInstance._internalTrack(&quot;ta_mp_share&quot;,&#123;&quot;#url_path&quot;:this._getCurrentPath()&#125;),_.isObject(e)?e:&#123;&#125;&#125;&#125;,&#123;key:&quot;onPageShow&quot;,value:function()&#123;var e,t;this.config.pageShow&amp;&amp;(t=&#123;&quot;#url_path&quot;:(e=this._getCurrentPath())||&quot;The system did not get a value&quot;,&quot;#referrer&quot;:this.referrer&#125;,this.referrer=e,this.taInstance._internalTrack(&quot;ta_mp_view&quot;,t))&#125;&#125;]),i&#125;(),AutoTrackBridge$1=function()&#123;function a(e,t,i)&#123;var n=this;_classCallCheck(this,a),this.taInstance=e,this.config=t||&#123;&#125;;t=i.getLaunchOptionsSync();this._onShow(t),this.startTracked=!0,i.onShow(function(e)&#123;n._onShow(e)&#125;),i.onHide(function()&#123;var e;n.startTracked=!1,n.config.appHide&amp;&amp;(e=&#123;&#125;,_.extend(e,n.config.properties),_.isFunction(n.config.callback)&amp;&amp;_.extend(e,n.config.callback(&quot;appHide&quot;)),n.taInstance._internalTrack(&quot;ta_mg_hide&quot;,e))&#125;)&#125;return _createClass(a,[&#123;key:&quot;_onShow&quot;,value:function(e)&#123;this.startTracked||(this.config.appHide&amp;&amp;this.taInstance.timeEvent(&quot;ta_mg_hide&quot;),e&amp;&amp;e.scene&amp;&amp;this.taInstance._setAutoTrackProperties(&#123;&quot;#scene&quot;:e.scene&#125;),this.config.appShow&amp;&amp;(e=&#123;&#125;,_.extend(e,this.config.properties),_.isFunction(this.config.callback)&amp;&amp;_.extend(e,this.config.callback(&quot;appShow&quot;)),this.taInstance._internalTrack(&quot;ta_mg_show&quot;,e)))&#125;&#125;]),a&#125;(),PlatformProxy$1=function()&#123;function n(e,t,i)&#123;_classCallCheck(this,n),this.api=e,this.config=t,this._config=i&#125;return _createClass(n,[&#123;key:&quot;getConfig&quot;,value:function()&#123;return this.config&#125;&#125;,&#123;key:&quot;getStorage&quot;,value:function(e,t,i)&#123;if(!t)&#123;if(&quot;dd_mp&quot;===this._config.platform)&#123;var n=this.api.getStorageSync(&#123;key:e&#125;);return _.isJSONString(n.data)?JSON.parse(n.data):&#123;&#125;&#125;n=this.api.getStorageSync(e);return _.isJSONString(n)?JSON.parse(n):&#123;&#125;&#125;this.api.getStorage(&#123;key:e,success:function(e)&#123;e=_.isJSONString(e.data)?JSON.parse(e.data):&#123;&#125;;i(e)&#125;,fail:function()&#123;logger$1.warn(&quot;getStorage faild&quot;),i(&#123;&#125;)&#125;&#125;)&#125;&#125;,&#123;key:&quot;setStorage&quot;,value:function(e,t)&#123;&quot;ali_mp&quot;===this._config.platform||&quot;tb_mp&quot;===this._config.platform||&quot;dd_mp&quot;===this._config.platform?this.api.setStorageSync(&#123;key:e,data:t&#125;):this.api.setStorageSync(e,t)&#125;&#125;,&#123;key:&quot;removeStorage&quot;,value:function(e)&#123;_.isFunction(this.api.removeStorage)?this.api.removeStorage(&#123;key:e&#125;):_.isFunction(this.api.deleteStorage)&amp;&amp;this.api.deleteStorage(&#123;key:e&#125;)&#125;&#125;,&#123;key:&quot;_getPlatform&quot;,value:function()&#123;return&quot;&quot;&#125;&#125;,&#123;key:&quot;getSystemInfo&quot;,value:function(t)&#123;var i=this._config.mpPlatform;this.api.getSystemInfo(&#123;success:function(e)&#123;_.isFunction(i)?e.mp_platform=i(e):e.mp_platform=i,t.success(e),&quot;wechat&quot;===i&amp;&amp;t.complete()&#125;,complete:function()&#123;t.complete()&#125;&#125;)&#125;&#125;,&#123;key:&quot;getNetworkType&quot;,value:function(t)&#123;_.isFunction(this.api.getNetworkType)?this.api.getNetworkType(&#123;success:function(e)&#123;t.success(e)&#125;,complete:function()&#123;t.complete()&#125;&#125;):(t.success(&#123;&#125;),t.complete())&#125;&#125;,&#123;key:&quot;onNetworkStatusChange&quot;,value:function(e)&#123;_.isFunction(this.api.onNetworkStatusChange)?this.api.onNetworkStatusChange(e):e(&#123;&#125;)&#125;&#125;,&#123;key:&quot;request&quot;,value:function(t)&#123;if(&quot;ali_mp&quot;!==this._config.platform&amp;&amp;&quot;dd_mp&quot;!==this._config.platform)return this.api.request(t);var e=_.extend(&#123;&#125;,t);return e.headers=t.header,e.success=function(e)&#123;e.statusCode=e.status,t.success(e)&#125;,e.fail=function(e)&#123;e.errMsg=e.errorMessage,t.fail(e)&#125;,&quot;dd_mp&quot;===this._config.platform?this.api.httpRequest(e):this.api.request(e)&#125;&#125;,&#123;key:&quot;initAutoTrackInstance&quot;,value:function(e,t)&#123;return _.isObject(t.autoTrack)&amp;&amp;(t.autoTrack.isPlugin=t.is_plugin),new(this._config.mp?AutoTrackBridge:AutoTrackBridge$1)(e,t.autoTrack,this.api)&#125;&#125;,&#123;key:&quot;setGlobal&quot;,value:function(e,t)&#123;this._config.mp?logger$1.warn(&quot;ThinkingAnalytics: we do not set global name for TA instance when you do not enable auto track.&quot;):GameGlobal[t]=e&#125;&#125;,&#123;key:&quot;getAppOptions&quot;,value:function(e)&#123;var t=&#123;&#125;;try&#123;t=this.api.getLaunchOptionsSync()&#125;catch(e)&#123;logger$1.warn(&quot;Cannot get launch options.&quot;)&#125;if(_.isFunction(e))try&#123;this._config.mp?this.api.onAppShow(e):this.api.onShow(e)&#125;catch(e)&#123;logger$1.warn(&quot;Cannot register onShow callback.&quot;)&#125;return t&#125;&#125;,&#123;key:&quot;showToast&quot;,value:function(e)&#123;var t;_.isFunction(this.api.showToast)&amp;&amp;(t=&#123;title:e&#125;,&quot;dd_mp&quot;!==this._config.platform&amp;&amp;&quot;ali_mp&quot;!==this._config.platform||(t.content=e),this.api.showToast(t))&#125;&#125;],[&#123;key:&quot;createInstance&quot;,value:function()&#123;return this._createInstance(&quot;R_CURRENT_PLATFORM&quot;)&#125;&#125;,&#123;key:&quot;_createInstance&quot;,value:function(e)&#123;switch(e)&#123;case&quot;wechat_mp&quot;:return new n(wx,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_wechat&quot;&#125;,&#123;mpPlatform:&quot;wechat&quot;,mp:!0,platform:e&#125;);case&quot;wechat_mg&quot;:return new n(wx,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_wechat_game&quot;&#125;,&#123;mpPlatform:&quot;wechat&quot;,platform:e&#125;);case&quot;qq_mp&quot;:return new n(qq,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qq&quot;&#125;,&#123;mpPlatform:&quot;qq&quot;,mp:!0,platform:e&#125;);case&quot;qq_mg&quot;:return new n(qq,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qq_game&quot;&#125;,&#123;mpPlatform:&quot;qq&quot;,platform:e&#125;);case&quot;baidu_mp&quot;:return new n(swan,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_swan&quot;&#125;,&#123;mpPlatform:function(e)&#123;return e.host&#125;,mp:!0,platform:e&#125;);case&quot;baidu_mg&quot;:return new n(swan,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_swan_game&quot;&#125;,&#123;mpPlatform:function(e)&#123;return e.host&#125;,platform:e&#125;);case&quot;tt_mg&quot;:return new n(tt,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_tt_game&quot;&#125;,&#123;mpPlatform:function(e)&#123;return e.appName&#125;,platform:e&#125;);case&quot;tt_mp&quot;:return new n(tt,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_tt&quot;&#125;,&#123;mpPlatform:function(e)&#123;return e.appName&#125;,mp:!0,platform:e&#125;);case&quot;ali_mp&quot;:return new n(my,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_ali&quot;&#125;,&#123;mpPlatform:function(e)&#123;return e.app&#125;,mp:!0,platform:e&#125;);case&quot;dd_mp&quot;:return new n(dd,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_dd&quot;&#125;,&#123;mpPlatform:&quot;dingding&quot;,mp:!0,platform:e&#125;);case&quot;bl_mg&quot;:return new n(bl,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_mg&quot;&#125;,&#123;mpPlatform:&quot;bilibili&quot;,platform:e&#125;);case&quot;kuaishou_mp&quot;:return new n(ks,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_kuaishou&quot;&#125;,&#123;mpPlatform:&quot;kuaishou&quot;,mp:!0,platform:e&#125;);case&quot;qh360_mg&quot;:return new n(qh,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qh360&quot;&#125;,&#123;mpPlatform:&quot;qh360&quot;,platform:e&#125;);case&quot;tb_mp&quot;:return new n(my,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_tb&quot;&#125;,&#123;mpPlatform:&quot;tb&quot;,mp:!0,platform:e&#125;);case&quot;jd_mp&quot;:return new n(jd,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_jd&quot;&#125;,&#123;mpPlatform:&quot;jd&quot;,mp:!0,platform:e&#125;);case&quot;qh360_mp&quot;:return new n(qh,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qh360&quot;&#125;,&#123;mpPlatform:&quot;qh360&quot;,mp:!0,platform:e&#125;);case&quot;WEB&quot;:return new PlatformProxy.createInstance&#125;&#125;&#125;]),n&#125;(),AutoTrackBridge$2=function e(t,i)&#123;var n=this;_classCallCheck(this,e),this.taInstance=t,this.config=i||&#123;&#125;,this.config.appShow&amp;&amp;this.taInstance._internalTrack(&quot;ta_mg_show&quot;),this.config.appHide&amp;&amp;this.taInstance.timeEvent(&quot;ta_mg_hide&quot;),qg.onShow(function()&#123;var e;n.config.appHide&amp;&amp;n.taInstance.timeEvent(&quot;ta_mg_hide&quot;),n.config.appShow&amp;&amp;(e=&#123;&#125;,_.extend(e,n.config.properties),_.isFunction(n.config.callback)&amp;&amp;_.extend(e,n.config.callback(&quot;appShow&quot;)),n.taInstance._internalTrack(&quot;ta_mg_show&quot;))&#125;),qg.onHide(function()&#123;var e;n.config.appHide&amp;&amp;(e=&#123;&#125;,_.extend(e,n.config.properties),_.isFunction(n.config.callback)&amp;&amp;_.extend(e,n.config.callback(&quot;appHide&quot;)),n.taInstance._internalTrack(&quot;ta_mg_hide&quot;))&#125;)&#125;,PlatformProxy$2=function()&#123;function e()&#123;_classCallCheck(this,e),this.config=&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qg_vivo_game&quot;,asyncPersistence:!0&#125;&#125;return _createClass(e,[&#123;key:&quot;getConfig&quot;,value:function()&#123;return this.config||&#123;&#125;&#125;&#125;,&#123;key:&quot;getStorage&quot;,value:function(e,t,i)&#123;if(!t)&#123;t=qg.getStorageSync(&#123;key:e&#125;);return _.isJSONString(t)?JSON.parse(t):&#123;&#125;&#125;qg.getStorage(&#123;key:e,success:function(e)&#123;e=_.isJSONString(e)?JSON.parse(e):&#123;&#125;;i(e)&#125;,fail:function()&#123;i(&#123;&#125;)&#125;&#125;)&#125;&#125;,&#123;key:&quot;setStorage&quot;,value:function(e,t)&#123;qg.setStorage(&#123;key:e,value:t&#125;)&#125;&#125;,&#123;key:&quot;removeStorage&quot;,value:function(e)&#123;qg.deleteStorage(&#123;key:e&#125;)&#125;&#125;,&#123;key:&quot;getSystemInfo&quot;,value:function(n)&#123;qg.getSystemInfo(&#123;success:function(e)&#123;var t=e,i=[e.osType,e.osVersionName].join(&quot; &quot;);t.brand=e.manufacturer,t.system=i,t.mp_platform=&quot;vivo_qg&quot;,n.success(t)&#125;,complete:function()&#123;n.complete()&#125;&#125;)&#125;&#125;,&#123;key:&quot;getNetworkType&quot;,value:function(i)&#123;qg.getNetworkType(&#123;success:function(e)&#123;var t=e;t.networkType=e.type,i.success(t)&#125;,complete:function()&#123;i.complete()&#125;&#125;)&#125;&#125;,&#123;key:&quot;onNetworkStatusChange&quot;,value:function(i)&#123;qg.subscribeNetworkStatus(&#123;callback:function(e)&#123;var t=e;t.networkType=e.type,i(t)&#125;&#125;)&#125;&#125;,&#123;key:&quot;request&quot;,value:function(t)&#123;return qg.request(&#123;url:t.url,data:t.data,method:t.method,header:t.header,success:function(e)&#123;t.success(e)&#125;,fail:function(e)&#123;t.fail(e)&#125;&#125;)&#125;&#125;,&#123;key:&quot;initAutoTrackInstance&quot;,value:function(e,t)&#123;return new AutoTrackBridge$2(e,t.autoTrack)&#125;&#125;,&#123;key:&quot;setGlobal&quot;,value:function(e,t)&#123;globalThis[t]=e&#125;&#125;,&#123;key:&quot;getAppOptions&quot;,value:function()&#123;return&#123;&#125;&#125;&#125;,&#123;key:&quot;showToast&quot;,value:function(e)&#123;qg.showToast(&#123;message:e,duration:0&#125;)&#125;&#125;],[&#123;key:&quot;createInstance&quot;,value:function()&#123;return new e&#125;&#125;]),e&#125;(),AutoTrackBridge$3=function e(t,i,n)&#123;var a=this;_classCallCheck(this,e),this.taInstance=t,this.config=i||&#123;&#125;,this.config.appShow&amp;&amp;(i=&#123;&#125;,_.extend(i,this.config.properties),_.isFunction(this.config.callback)&amp;&amp;_.extend(i,this.config.callback(&quot;appShow&quot;)),this.taInstance._internalTrack(&quot;ta_mg_show&quot;,i)),this.config.appHide&amp;&amp;this.taInstance.timeEvent(&quot;ta_mg_hide&quot;),n.onShow(function()&#123;var e;a.config.appHide&amp;&amp;a.taInstance.timeEvent(&quot;ta_mg_hide&quot;),a.config.appShow&amp;&amp;(e=&#123;&#125;,_.extend(e,a.config.properties),_.isFunction(a.config.callback)&amp;&amp;_.extend(e,a.config.callback(&quot;appShow&quot;)),a.taInstance._internalTrack(&quot;ta_mg_show&quot;,e))&#125;),n.onHide(function()&#123;var e;a.config.appHide&amp;&amp;(e=&#123;&#125;,_.extend(e,a.config.properties),_.isFunction(a.config.callback)&amp;&amp;_.extend(e,a.config.callback(&quot;appHide&quot;)),a.taInstance._internalTrack(&quot;ta_mg_hide&quot;,e))&#125;)&#125;,PlatformProxy$3=function()&#123;function n(e,t,i)&#123;_classCallCheck(this,n),this.api=e,this.config=t,this._config=i&#125;return _createClass(n,[&#123;key:&quot;getConfig&quot;,value:function()&#123;return this.config||&#123;&#125;&#125;&#125;,&#123;key:&quot;getStorage&quot;,value:function(e,t,i)&#123;e=localStorage.getItem(e);if(!t)return _.isJSONString(e)?JSON.parse(e):&#123;&#125;;_.isJSONString(e)?i(JSON.parse(e)):i(&#123;&#125;)&#125;&#125;,&#123;key:&quot;setStorage&quot;,value:function(e,t)&#123;localStorage.setItem(e,t)&#125;&#125;,&#123;key:&quot;removeStorage&quot;,value:function(e)&#123;localStorage.removeItem(e)&#125;&#125;,&#123;key:&quot;getSystemInfo&quot;,value:function(t)&#123;var i=this._config.mpPlatform;this.api.getSystemInfo(&#123;success:function(e)&#123;e.mp_platform=i,t.success(e)&#125;,complete:function()&#123;t.complete()&#125;&#125;)&#125;&#125;,&#123;key:&quot;getNetworkType&quot;,value:function(t)&#123;this.api.getNetworkType(&#123;success:function(e)&#123;t.success(e)&#125;,complete:function()&#123;t.complete()&#125;&#125;)&#125;&#125;,&#123;key:&quot;onNetworkStatusChange&quot;,value:function(t)&#123;this.api.onNetworkStatusChange(&#123;callback:function(e)&#123;t(e)&#125;&#125;)&#125;&#125;,&#123;key:&quot;request&quot;,value:function(e)&#123;var t=&#123;&#125;,i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function()&#123;4===i.readyState&amp;&amp;200===i.status?(t.statusCode=200,_.isJSONString(i.responseText)&amp;&amp;(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&amp;&amp;(t.errMsg=&quot;network error&quot;,e.fail(t))&#125;,i.ontimeout=function()&#123;t.errMsg=&quot;timeout&quot;,e.fail(t)&#125;,i.send(e.data),i&#125;&#125;,&#123;key:&quot;initAutoTrackInstance&quot;,value:function(e,t)&#123;return new AutoTrackBridge$3(e,t.autoTrack,this.api)&#125;&#125;,&#123;key:&quot;setGlobal&quot;,value:function(e,t)&#123;globalThis[t]=e&#125;&#125;,&#123;key:&quot;getAppOptions&quot;,value:function()&#123;return this.api.getLaunchOptionsSync()&#125;&#125;,&#123;key:&quot;showToast&quot;,value:function(e)&#123;this.api.showToast(&#123;title:e,icon:&quot;none&quot;,duration:2e3&#125;)&#125;&#125;],[&#123;key:&quot;createInstance&quot;,value:function()&#123;return this._createInstance(&quot;R_CURRENT_PLATFORM&quot;)&#125;&#125;,&#123;key:&quot;_createInstance&quot;,value:function(e)&#123;switch(e)&#123;case&quot;oppo&quot;:return new n(qg,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qg_oppo_game&quot;&#125;,&#123;mpPlatform:&quot;oppo_qg&quot;&#125;);case&quot;huawei&quot;:return new n(hbs,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qg_huawei_game&quot;&#125;,&#123;mpPlatform:&quot;huawei_qg&quot;&#125;);case&quot;mz&quot;:return new n(qg,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qg_mz_game&quot;&#125;,&#123;mpPlatform:&quot;mz&quot;&#125;);case&quot;xiaomi&quot;:return new n(qg,&#123;persistenceName:&quot;thinkingdata&quot;,persistenceNameOld:&quot;thinkingdata_qg&quot;&#125;,&#123;mpPlatform:&quot;xiaomi&quot;&#125;)&#125;&#125;&#125;]),n&#125;(),PlatformProxyCC=function()&#123;function e()&#123;_classCallCheck(this,e)&#125;return _createClass(e,null,[&#123;key:&quot;createInstance&quot;,value:function()&#123;var e=Object.freeze(&#123;WECHAT_GAME:104,QQ_PLAY:105,BAIDU_GAME:107,VIVO_GAME:108,OPPO_GAME:109,HUAWEI_GAME:110,XIAOMI_GAME:111,BYTEDANCE_GAME:117,QTT_GAME:116,LINKSURE:119,WECHAT_MINI_GAME:&quot;WECHAT_GAME&quot;,BAIDU_MINI_GAME:&quot;BAIDU_MINI_GAME&quot;,XIAOMI_QUICK_GAME:&quot;XIAOMI_QUICK_GAME&quot;,OPPO_MINI_GAME:&quot;OPPO_MINI_GAME&quot;,VIVO_MINI_GAME:&quot;VIVO_MINI_GAME&quot;,HUAWEI_QUICK_GAME:&quot;HUAWEI_QUICK_GAME&quot;,BYTEDANCE_MINI_GAME:&quot;BYTEDANCE_MINI_GAME&quot;,QTT_MINI_GAME:&quot;QTT_MINI_GAME&quot;,LINKSURE_MINI_GAME:&quot;LINKSURE_MINI_GAME&quot;&#125;);if(cc.sys.platform===e.WECHAT_GAME||cc.sys.platform===e.WECHAT_MINI_GAME)return PlatformProxy$1._createInstance(&quot;wechat_mg&quot;);if(cc.sys.platform===e.BAIDU_GAME||cc.sys.platform===e.BAIDU_MIN_GAME)return PlatformProxy$1._createInstance(&quot;baidu_mg&quot;);if(cc.sys.platform===e.VIVO_GAME||cc.sys.platform===e.VIVO_MINI_GAME)return PlatformProxy$2.createInstance();if(cc.sys.platform===e.QQ_PLAY)return PlatformProxy$1._createInstance(&quot;qq_mg&quot;);if(cc.sys.platform===e.OPPO_GAME||cc.sys.platform===e.OPPO_MINI_GAME)return PlatformProxy$3._createInstance(&quot;oppo&quot;);if(cc.sys.platform===e.HUAWEI_GAME||cc.sys.platform===e.HUAWEI_QUICK_GAME)return PlatformProxy$3._createInstance(&quot;huawei&quot;);if(cc.sys.platform===e.XIAOMI_GAME||cc.sys.platform===e.XIAOMI_QUICK_GAME)return PlatformProxy$3._createInstance(&quot;xiaomi&quot;);if(cc.sys.platform===e.BYTEDANCE_GAME||cc.sys.platform===e.BYTEDANCE_MINI_GAME)return PlatformProxy$1._createInstance(&quot;tt_mg&quot;);var i=PlatformProxy.createInstance();return i._sysCallback=function()&#123;return&#123;system:cc.sys.os.replace(&quot; &quot;,&quot;&quot;)+&quot; &quot;+cc.sys.osVersion&#125;&#125;,i.getNetworkType=function(e)&#123;var t=&#123;&#125;;switch(cc.sys.getNetworkType())&#123;case cc.sys.NetworkType.LAN:t.networkType=&quot;WIFI&quot;;break;case cc.sys.NetworkType.WWAN:t.networkType=&quot;WWAN&quot;;break;default:t.networkType=&quot;NONE&quot;&#125;e.success(t),e.complete()&#125;,i.getSystemInfo=function(e)&#123;var t=&#123;mp_platform:cc.sys.platform.toString(),system:i._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height&#125;;i._sysCallback&amp;&amp;(t=_.extend(t,i._sysCallback(e))),e.success(t),e.complete()&#125;,i&#125;&#125;]),e&#125;(),PlatformAPI=function()&#123;function e()&#123;_classCallCheck(this,e)&#125;return _createClass(e,null,[&#123;key:&quot;_getCurrentPlatform&quot;,value:function()&#123;return this.currentPlatform||(this.currentPlatform=PlatformProxyCC.createInstance())&#125;&#125;,&#123;key:&quot;getConfig&quot;,value:function()&#123;return this._getCurrentPlatform().getConfig()&#125;&#125;,&#123;key:&quot;getStorage&quot;,value:function(e,t,i)&#123;return this._getCurrentPlatform().getStorage(e,t,i)&#125;&#125;,&#123;key:&quot;setStorage&quot;,value:function(e,t)&#123;return this._getCurrentPlatform().setStorage(e,t)&#125;&#125;,&#123;key:&quot;removeStorage&quot;,value:function(e)&#123;return this._getCurrentPlatform().removeStorage(e)&#125;&#125;,&#123;key:&quot;getSystemInfo&quot;,value:function(e)&#123;return this._getCurrentPlatform().getSystemInfo(e)&#125;&#125;,&#123;key:&quot;getNetworkType&quot;,value:function(e)&#123;return this._getCurrentPlatform().getNetworkType(e)&#125;&#125;,&#123;key:&quot;onNetworkStatusChange&quot;,value:function(e)&#123;this._getCurrentPlatform().onNetworkStatusChange(e)&#125;&#125;,&#123;key:&quot;request&quot;,value:function(e)&#123;return this._getCurrentPlatform().request(e)&#125;&#125;,&#123;key:&quot;initAutoTrackInstance&quot;,value:function(e,t)&#123;return this._getCurrentPlatform().initAutoTrackInstance(e,t)&#125;&#125;,&#123;key:&quot;setGlobal&quot;,value:function(e,t)&#123;e&amp;&amp;t&amp;&amp;this._getCurrentPlatform().setGlobal(e,t)&#125;&#125;,&#123;key:&quot;getAppOptions&quot;,value:function(e)&#123;return this._getCurrentPlatform().getAppOptions(e)&#125;&#125;,&#123;key:&quot;showDebugToast&quot;,value:function(e)&#123;this._getCurrentPlatform().showToast(e)&#125;&#125;]),e&#125;(),KEY_NAME_MATCH_REGEX=/^[a-zA-Z][a-zA-Z0-9_]&#123;0,49&#125;$/,PropertyChecker=function()&#123;function e()&#123;_classCallCheck(this,e)&#125;return _createClass(e,null,[&#123;key:&quot;stripProperties&quot;,value:function(e)&#123;return _.isObject(e)&amp;&amp;_.each(e,function(e,t)&#123;_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||_.isObject(e)||logger$1.warn(&quot;Your data -&quot;,t,e,&quot;- format does not meet requirements and may not be stored correctly. Attribute values only support String, Number, Date, Boolean, Array, Object&quot;)&#125;),e&#125;&#125;,&#123;key:&quot;_checkPropertiesKey&quot;,value:function(e)&#123;var i=!0;return _.each(e,function(e,t)&#123;KEY_NAME_MATCH_REGEX.test(t)||(logger$1.warn(&quot;Invalid KEY: &quot;+t),i=!1)&#125;),i&#125;&#125;,&#123;key:&quot;event&quot;,value:function(e)&#123;return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger$1.warn(&quot;Check the parameter format. The eventName must start with an English letter and contain no more than 50 characters including letters, digits, and underscores: &quot;+e),!1)&#125;&#125;,&#123;key:&quot;propertyName&quot;,value:function(e)&#123;return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger$1.warn(&quot;Check the parameter format. PropertyName must start with a letter and contain letters, digits, and underscores (_). The value is a string of no more than 50 characters: &quot;+e),!1)&#125;&#125;,&#123;key:&quot;properties&quot;,value:function(e)&#123;return this.stripProperties(e),!e||(_.isObject(e)?!!this._checkPropertiesKey(e)||(logger$1.warn(&quot;Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters&quot;),!1):(logger$1.warn(&quot;properties can be none, but it must be an object&quot;),!1))&#125;&#125;,&#123;key:&quot;propertiesMust&quot;,value:function(e)&#123;return this.stripProperties(e),void 0===e||!_.isObject(e)||_.isEmptyObject(e)?(logger$1.warn(&quot;properties must be an object with a value&quot;),!1):!!this._checkPropertiesKey(e)||(logger$1.warn(&quot;Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters&quot;),!1)&#125;&#125;,&#123;key:&quot;userId&quot;,value:function(e)&#123;return!(!_.isString(e)||!/^.&#123;1,64&#125;$/.test(e))||(logger$1.warn(&quot;The user ID must be a string of less than 64 characters and cannot be null&quot;),!1)&#125;&#125;,&#123;key:&quot;userAddProperties&quot;,value:function(e)&#123;if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isNumber(e[t]))return logger$1.warn(&quot;The attributes of userAdd need to be Number&quot;),!1;return!0&#125;&#125;,&#123;key:&quot;userAppendProperties&quot;,value:function(e)&#123;if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isArray(e[t]))return logger$1.warn(&quot;The attribute of userAppend must be Array&quot;),!1;return!0&#125;&#125;]),e&#125;(),HttpTask=function()&#123;function r(e,t,i,n,a)&#123;_classCallCheck(this,r),this.data=e,this.serverUrl=t,this.callback=a,this.tryCount=_.isNumber(i)?i:1,this.timeout=_.isNumber(n)?n:3e3,this.taClassName=&quot;HttpTask&quot;&#125;return _createClass(r,[&#123;key:&quot;run&quot;,value:function()&#123;var t=this,e=_.createExtraHeaders();e[&quot;content-type&quot;]=&quot;application/json&quot;;var i=PlatformAPI.request(&#123;url:this.serverUrl,method:&quot;POST&quot;,data:this.data,header:e,success:function(e)&#123;t.onSuccess(e),clearTimeout(n)&#125;,fail:function(e)&#123;t.onFailed(e),clearTimeout(n)&#125;&#125;),n=setTimeout(function()&#123;(_.isObject(i)||_.isPromise(i))&amp;&amp;_.isFunction(i.abort)&amp;&amp;i.abort()&#125;,this.timeout)&#125;&#125;,&#123;key:&quot;onSuccess&quot;,value:function(e)&#123;if(200===e.statusCode)&#123;var t;switch(e.data.code)&#123;case 0:t=&quot;success&quot;;break;case-1:t=&quot;invalid data&quot;;break;case-2:t=&quot;invalid APP ID&quot;;break;default:t=&quot;Unknown return code&quot;&#125;this.callback(&#123;code:e.data.code,msg:t&#125;)&#125;else this.callback(&#123;code:-3,msg:e.statusCode&#125;)&#125;&#125;,&#123;key:&quot;onFailed&quot;,value:function(e)&#123;0&lt;--this.tryCount?this.run():this.callback(&#123;code:-3,msg:e.errMsg&#125;)&#125;&#125;]),r&#125;(),HttpTaskDebug=function()&#123;function o(e,t,i,n,a,r,s)&#123;_classCallCheck(this,o),this.data=e,this.serverDebugUrl=t,this.callback=s,this.tryCount=_.isNumber(i)?i:1,this.timeout=_.isNumber(n)?n:3e3,this.dryrun=a,this.deviceId=r,this.taClassName=&quot;HttpTaskDebug&quot;&#125;return _createClass(o,[&#123;key:&quot;run&quot;,value:function()&#123;var t=this,e=&quot;appid=&quot;+this.data[&quot;#app_id&quot;]+&quot;&amp;source=client&amp;dryRun=&quot;+this.dryrun+&quot;&amp;deviceId=&quot;+this.deviceId+&quot;&amp;data=&quot;+encodeURIComponent(JSON.stringify(this.data.data[0])),i=_.createExtraHeaders();i[&quot;content-type&quot;]=&quot;application/x-www-form-urlencoded&quot;;var n=PlatformAPI.request(&#123;url:this.serverDebugUrl,method:&quot;POST&quot;,data:e,header:i,success:function(e)&#123;t.onSuccess(e),clearTimeout(a)&#125;,fail:function(e)&#123;t.onFailed(e),clearTimeout(a)&#125;&#125;),a=setTimeout(function()&#123;(_.isObject(n)||_.isPromise(n))&amp;&amp;_.isFunction(n.abort)&amp;&amp;n.abort()&#125;,this.timeout)&#125;&#125;,&#123;key:&quot;onSuccess&quot;,value:function(e)&#123;if(200===e.statusCode)&#123;var t;if(0===e.data.errorLevel)t=&quot;Verify data success.&quot;;else if(1===e.data.errorLevel)&#123;for(var i=e.data.errorProperties,n=&quot;&quot;,a=0;a&lt;i.length;a++)var r=i[a].errorReason,n=n+&quot; propertyName:&quot;+i[a].propertyName+&quot; errorReasons:&quot;+r+&quot;\\n&quot;;t=&quot;Debug data error. errorLevel:&quot;+e.data.errorLevel+&quot; reason:&quot;+n&#125;else 2!==e.data.errorLevel&amp;&amp;-1!==e.data.errorLevel||(t=&quot;Debug data error. errorLevel:&quot;+e.data.errorLevel+&quot; reason:&quot;+e.data.errorReasons);logger$1.info(t),this.callback(&#123;code:e.data.errorLevel,msg:t&#125;)&#125;else this.callback(&#123;code:-3,msg:e.statusCode&#125;)&#125;&#125;,&#123;key:&quot;onFailed&quot;,value:function(e)&#123;0&lt;--this.tryCount?this.run():this.callback(&#123;code:-3,msg:e.errMsg&#125;)&#125;&#125;]),o&#125;(),SenderQueue=function()&#123;function e()&#123;_classCallCheck(this,e),this.items=[],this.isRunning=!1,this.showDebug=!1&#125;return _createClass(e,[&#123;key:&quot;enqueue&quot;,value:function(e,t,i,n)&#123;var n=!(3&lt;arguments.length&amp;&amp;void 0!==n)||n,a=this,t=&quot;debug&quot;===i.debugMode?new HttpTaskDebug(e,t,i.maxRetries,i.sendTimeout,0,i.deviceId,function(e)&#123;a.isRunning=!1,_.isFunction(i.callback)&amp;&amp;i.callback(e),a._runNext(),!1===a.showDebug&amp;&amp;(0!==e.code&amp;&amp;1!==e.code&amp;&amp;2!==e.code||(a.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&amp;&amp;PlatformAPI.showDebugToast(&quot;The current mode is Debug&quot;)))&#125;):&quot;debugOnly&quot;===i.debugMode?new HttpTaskDebug(e,t,i.maxRetries,i.sendTimeout,1,i.deviceId,function(e)&#123;a.isRunning=!1,_.isFunction(i.callback)&amp;&amp;i.callback(e),a._runNext(),!1===a.showDebug&amp;&amp;(0!==e.code&amp;&amp;1!==e.code&amp;&amp;2!==e.code||(a.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&amp;&amp;PlatformAPI.showDebugToast(&quot;The current mode is debugOnly&quot;)))&#125;):new HttpTask(JSON.stringify(e),t,i.maxRetries,i.sendTimeout,function(e)&#123;a.isRunning=!1,_.isFunction(i.callback)&amp;&amp;i.callback(e),a._runNext()&#125;);!0===n?(this.items.push(t),this._runNext()):t.run()&#125;&#125;,&#123;key:&quot;_dequeue&quot;,value:function()&#123;return this.items.shift()&#125;&#125;,&#123;key:&quot;_runNext&quot;,value:function()&#123;if(0&lt;this.items.length&amp;&amp;!this.isRunning)if(this.isRunning=!0,&quot;HttpTask&quot;!==this.items[0].taClassName)this._dequeue().run();else&#123;var e=this.items.splice(0,this.items.length),t=e[0],i=JSON.parse(t.data),n=i[&quot;#app_id&quot;],a=[];a.push(t.callback);for(var r=1;r&lt;e.length;r++)&#123;var s=e[r],o=JSON.parse(s.data);o[&quot;#app_id&quot;]===n&amp;&amp;t.serverUrl===s.serverUrl?(i.data=i.data.concat(o.data),a.push(s.callback)):this.items.push(s)&#125;var c=(new Date).getTime();i[&quot;#flush_time&quot;]=c,new HttpTask(JSON.stringify(i),t.serverUrl,t.tryCount,t.timeout,function(e)&#123;for(var t in a)Object.hasOwnProperty.call(a,t)&amp;&amp;(0,a[t])(e)&#125;).run()&#125;&#125;&#125;]),e&#125;(),senderQueue=new SenderQueue,DEFAULT_CONFIG=&#123;name:&quot;thinkingdata&quot;,is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1,debugMode:&quot;none&quot;,enableCalibrationTime:!1&#125;,systemInformation=&#123;properties:&#123;&quot;#lib&quot;:Config.LIB_NAME,&quot;#lib_version&quot;:Config.LIB_VERSION&#125;,initDeviceId:function(e)&#123;_.isString(e)&amp;&amp;(this.properties[&quot;#device_id&quot;]=e)&#125;,getSystemInfo:function(e)&#123;var i=this;PlatformAPI.onNetworkStatusChange(function(e)&#123;i.properties[&quot;#network_type&quot;]=e.networkType&#125;),PlatformAPI.getNetworkType(&#123;success:function(e)&#123;i.properties[&quot;#network_type&quot;]=e.networkType&#125;,complete:function()&#123;PlatformAPI.getSystemInfo(&#123;success:function(e)&#123;logger$1.info(JSON.stringify(e,null,4));var t=e.system?e.system.replace(/\\s+/g,&quot; &quot;).split(&quot; &quot;):[],t=&#123;&quot;#manufacturer&quot;:e.brand,&quot;#device_model&quot;:e.model,&quot;#screen_width&quot;:Number(e.screenWidth),&quot;#screen_height&quot;:Number(e.screenHeight),&quot;#os&quot;:t[0],&quot;#os_version&quot;:t[1],&quot;#mp_platform&quot;:e.mp_platform,&quot;#system_language&quot;:e.systemLanguage&#125;;_.extend(i.properties,t),_.setMpPlatform(e.mp_platform)&#125;,complete:function()&#123;e()&#125;&#125;)&#125;&#125;)&#125;&#125;,ThinkingDataPersistence=function()&#123;function e(t,i)&#123;var n=this;_classCallCheck(this,e),this.enabled=t.enablePersistence,this.enabled?(t.isChildInstance?(this.name=t.persistenceName+&quot;_&quot;+t.name,this.nameOld=t.persistenceNameOld+&quot;_&quot;+t.name):(this.name=t.persistenceName,this.nameOld=t.persistenceNameOld),t.asyncPersistence?(this._state=&#123;&#125;,PlatformAPI.getStorage(this.name,!0,function(e)&#123;_.isEmptyObject(e)?PlatformAPI.getStorage(n.nameOld,!0,function(e)&#123;n._state=_.extend2Layers(&#123;&#125;,e,n._state),n._init(t,i),n._save()&#125;):(n._state=_.extend2Layers(&#123;&#125;,e,n._state),n._init(t,i),n._save())&#125;)):(this._state=PlatformAPI.getStorage(this.name)||&#123;&#125;,_.isEmptyObject(this._state)&amp;&amp;(this._state=PlatformAPI.getStorage(this.nameOld)||&#123;&#125;),this._init(t,i))):(this._state=&#123;&#125;,this._init(t,i))&#125;return _createClass(e,[&#123;key:&quot;_init&quot;,value:function(e,t)&#123;this.getDistinctId()||this.setDistinctId(_.UUID()),e.isChildInstance||(this.getDeviceId()||this._setDeviceId(_.UUID()),systemInformation.initDeviceId(this.getDeviceId())),this.initComplete=!0,&quot;function&quot;==typeof t&amp;&amp;t(),this._save()&#125;&#125;,&#123;key:&quot;_save&quot;,value:function()&#123;this.enabled&amp;&amp;this.initComplete&amp;&amp;PlatformAPI.setStorage(this.name,JSON.stringify(this._state))&#125;&#125;,&#123;key:&quot;_set&quot;,value:function(e,t)&#123;var i,n=this;&quot;string&quot;==typeof e?(i=&#123;&#125;)[e]=t:&quot;object&quot;===_typeof(e)&amp;&amp;(i=e),_.each(i,function(e,t)&#123;n._state[t]=e&#125;),this._save()&#125;&#125;,&#123;key:&quot;_get&quot;,value:function(e)&#123;return this._state[e]&#125;&#125;,&#123;key:&quot;setEventTimer&quot;,value:function(e,t)&#123;var i=this._state.event_timers||&#123;&#125;;i[e]=t,this._set(&quot;event_timers&quot;,i)&#125;&#125;,&#123;key:&quot;removeEventTimer&quot;,value:function(e)&#123;var t=(this._state.event_timers||&#123;&#125;)[e];return _.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t&#125;&#125;,&#123;key:&quot;getDeviceId&quot;,value:function()&#123;return this._state.device_id&#125;&#125;,&#123;key:&quot;_setDeviceId&quot;,value:function(e)&#123;this.getDeviceId()?logger$1.warn(&quot;cannot modify the device id.&quot;):this._set(&quot;device_id&quot;,e)&#125;&#125;,&#123;key:&quot;getDistinctId&quot;,value:function()&#123;return this._state.distinct_id&#125;&#125;,&#123;key:&quot;setDistinctId&quot;,value:function(e)&#123;this._set(&quot;distinct_id&quot;,e)&#125;&#125;,&#123;key:&quot;getAccountId&quot;,value:function()&#123;return this._state.account_id&#125;&#125;,&#123;key:&quot;setAccountId&quot;,value:function(e)&#123;this._set(&quot;account_id&quot;,e)&#125;&#125;,&#123;key:&quot;getSuperProperties&quot;,value:function()&#123;return this._state.props||&#123;&#125;&#125;&#125;,&#123;key:&quot;setSuperProperties&quot;,value:function(e,t)&#123;e=t?e:_.extend(this.getSuperProperties(),e);this._set(&quot;props&quot;,e)&#125;&#125;]),e&#125;(),dataStoragePrefix=&quot;tampsdk_&quot;,tabStoragePrefix=&quot;tab_tampsdk_&quot;,BatchConsumer=function()&#123;function i(e,t)&#123;_classCallCheck(this,i),this.config=e,this.ta=t,this.timer=null,this.batchConfig=_.extend(&#123;size:5,interval:5e3,storageLimit:200&#125;,this.config.batchConfig),this.batchConfig.size&lt;1&amp;&amp;(this.batchConfig.size=1),30&lt;this.batchConfig.size&amp;&amp;(this.batchConfig.size=30),this.tabKey=tabStoragePrefix+this.config.appId,this.storageLimit=this.batchConfig.storageLimit,this.isRequest=!1,this.trackList=[],this.needFlush=!1&#125;return _createClass(i,[&#123;key:&quot;batchInterval&quot;,value:function()&#123;var e=this;e.timer=setTimeout(function()&#123;e.recycle(),e.send(),clearTimeout(e.timer),e.batchInterval()&#125;,this.batchConfig.interval)&#125;&#125;,&#123;key:&quot;add&quot;,value:function(e)&#123;if(this.isRequest)this.trackList.push(e);else&#123;var t=e,i=dataStoragePrefix+this.config.appId+&quot;_&quot;+String(_.UUID()),e=PlatformAPI.getStorage(this.tabKey);if(_.isArray(e)||(e=[]),e.length&lt;=this.storageLimit)e.push(i),PlatformAPI.setStorage(this.tabKey,JSON.stringify(e)),PlatformAPI.setStorage(i,JSON.stringify(t));else&#123;var n=e.splice(0,20);console.log(&quot;deleted events data:&quot;+n),e.push(i),PlatformAPI.setStorage(this.tabKey,JSON.stringify(e)),PlatformAPI.setStorage(i,JSON.stringify(t));for(var t=&#123;&#125;,a=[],r=0;r&lt;n.length;r++)&#123;var s=PlatformAPI.getStorage(n[r]);a.push(s)&#125;t.data=a,t[&quot;#app_id&quot;]=this.config.appId,this.request(t,n)&#125;&#125;&#125;&#125;,&#123;key:&quot;flush&quot;,value:function()&#123;clearTimeout(this.timer),this.send(),this.batchInterval()&#125;&#125;,&#123;key:&quot;send&quot;,value:function()&#123;if(this.isRequest)this.needFlush=!0;else&#123;var e=PlatformAPI.getStorage(this.tabKey);if(e&amp;&amp;e.length)&#123;for(var t=&#123;&#125;,i=[],n=[],a=e.length&lt;this.batchConfig.size?e.length:this.batchConfig.size,r=0;r&lt;a;r++)&#123;var s=PlatformAPI.getStorage(e[r]);i.push(s),n.push(e[r])&#125;t.data=i,t[&quot;#app_id&quot;]=this.config.appId,this.request(t,n)&#125;&#125;&#125;&#125;,&#123;key:&quot;request&quot;,value:function(e,i)&#123;var n=this;logger$1.info(&quot;flush data: &quot;+JSON.stringify(e)),n.isRequest=!0,senderQueue.enqueue(e,this.ta.serverUrl,&#123;maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:function(e)&#123;0==e.code&amp;&amp;n.remove(i),n.isRequest=!1;for(var t=0;t&lt;n.trackList.length;t++)n.add(n.trackList[t]);n.trackList=[],n.needFlush&amp;&amp;(n.needFlush=!1,n.flush())&#125;,debugMode:this.config.debugMode,deviceId:this.ta.getDeviceId()&#125;)&#125;&#125;,&#123;key:&quot;remove&quot;,value:function(e)&#123;var t=PlatformAPI.getStorage(this.tabKey);if(t)&#123;for(var i=0;i&lt;e.length;i++)&#123;var n=_.indexOf(t,e[i]);-1&lt;n&amp;&amp;t.splice(n,1),PlatformAPI.removeStorage(e[i])&#125;PlatformAPI.setStorage(this.tabKey,JSON.stringify(t))&#125;&#125;&#125;,&#123;key:&quot;recycle&quot;,value:function()&#123;&#125;&#125;]),i&#125;(),ThinkingDataAPI=function()&#123;function i(e)&#123;_classCallCheck(this,i),e.appId=e.appId?_.checkAppId(e.appId):_.checkAppId(e.appid),e.serverUrl=e.serverUrl?_.checkUrl(e.serverUrl):_.checkUrl(e.server_url);var t=_.extend(&#123;&#125;,DEFAULT_CONFIG,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)&#125;return _createClass(i,[&#123;key:&quot;_init&quot;,value:function(e)&#123;var t=this;this.name=e.name,this.appId=e.appId||e.appid;var i=e.serverUrl||e.server_url;this.serverUrl=i+&quot;/sync_xcx&quot;,this.serverDebugUrl=i+&quot;/data_debug&quot;,this.configUrl=i+&quot;/config&quot;,this.autoTrackProperties=&#123;&#125;,this._queue=[],this.updateConfig(this.configUrl,this.appId),e.isChildInstance?this._state=&#123;&#125;:(logger$1.enabled=e.enableLog,this.instances=[],this._state=&#123;getSystemInfo:!1,initComplete:!1&#125;,PlatformAPI.setGlobal(this,this.name)),this.store=new ThinkingDataPersistence(e,function()&#123;t.config.asyncPersistence&amp;&amp;_.isFunction(t.config.persistenceComplete)&amp;&amp;t.config.persistenceComplete(t),t._updateState()&#125;),this.enabled=!_.isBoolean(this.store._get(&quot;ta_enabled&quot;))||this.store._get(&quot;ta_enabled&quot;),this.isOptOut=!!_.isBoolean(this.store._get(&quot;ta_isOptOut&quot;))&amp;&amp;this.store._get(&quot;ta_isOptOut&quot;),!e.isChildInstance&amp;&amp;e.autoTrack&amp;&amp;(this.autoTrack=PlatformAPI.initAutoTrackInstance(this,e)),void 0!==this.config.enableBatch&amp;&amp;!1!==this.config.enableBatch&amp;&amp;(this.batchConsumer=new BatchConsumer(this.config,this),this.batchConsumer.batchInterval())&#125;&#125;,&#123;key:&quot;initSystemInfo&quot;,value:function()&#123;var e=this;this.config.isChildInstance||systemInformation.getSystemInfo(function()&#123;e._updateState(&#123;getSystemInfo:!0&#125;)&#125;)&#125;&#125;,&#123;key:&quot;updateConfig&quot;,value:function(e,t)&#123;var i=this,n=_.createExtraHeaders();n[&quot;content-type&quot;]=&quot;application/json&quot;;var a=PlatformAPI.request(&#123;url:e+&quot;?appid=&quot;+t,method:&quot;GET&quot;,header:n,success:function(e)&#123;_.isUndefined(e)||_.isUndefined(e.data)||(logger$1.info(&quot;config update success(&quot;+t+&quot;) :&quot;+JSON.stringify(e.data)),_.isUndefined(e.data.data)||(i.config.syncBatchSize=e.data.data.sync_batch_size,i.config.syncInterval=e.data.data.sync_interval,i.config.disableEventList=e.data.data.disable_event_list,_.isUndefined(e.data.data.secret_key)||(e=e.data.data.secret_key,i.config.secretKey=&#123;publicKey:e.key,version:e.version&#125;)))&#125;,fail:function(e)&#123;logger$1.info(&quot;config update fail(&quot;+t+&quot;) :&quot;+e.errMsg)&#125;&#125;);setTimeout(function()&#123;(_.isObject(a)||_.isPromise(a))&amp;&amp;_.isFunction(a.abort)&amp;&amp;a.abort()&#125;,3e3)&#125;&#125;,&#123;key:&quot;initInstance&quot;,value:function(e,t)&#123;if(this.config.isChildInstance)logger$1.warn(&quot;initInstance() cannot be called on child instance&quot;);else&#123;if(_.isString(e)&amp;&amp;e!==this.name&amp;&amp;_.isUndefined(this[e]))&#123;t=new i(_.extend(&#123;&#125;,this.config,&#123;enablePersistence:!1,isChildInstance:!0,name:e&#125;,t));return this[e]=t,this.instances.push(e),this[e]._state=this._state,t&#125;logger$1.warn(&quot;initInstance() failed due to the name is invalid: &quot;+e)&#125;&#125;&#125;,&#123;key:&quot;lightInstance&quot;,value:function(e)&#123;return this[e]&#125;&#125;,&#123;key:&quot;_setAutoTrackProperties&quot;,value:function(e)&#123;_.extend(this.autoTrackProperties,e)&#125;&#125;,&#123;key:&quot;init&quot;,value:function()&#123;if(this.initSystemInfo(),this._state.initComplete)return!1;this._updateState(&#123;initComplete:!0&#125;),logger$1.info(&quot;Thinking Analytics SDK initialized successfully with mode: &quot;+this.config.debugMode+&quot;, APP ID : &quot;+this.config.appId+&quot;, server url: &quot;+this.config.serverUrl+&quot;, libversion: &quot;+Config.LIB_VERSION)&#125;&#125;,&#123;key:&quot;_isReady&quot;,value:function()&#123;return this._state.getSystemInfo&amp;&amp;this._state.initComplete&amp;&amp;this.store.initComplete&amp;&amp;this.getDeviceId()&#125;&#125;,&#123;key:&quot;_updateState&quot;,value:function(e)&#123;var t=this;_.isObject(e)&amp;&amp;_.extend(this._state,e),this._onStateChange(),_.each(this.instances,function(e)&#123;t[e]._onStateChange()&#125;)&#125;&#125;,&#123;key:&quot;_onStateChange&quot;,value:function()&#123;var t=this;this._isReady()&amp;&amp;this._queue&amp;&amp;0&lt;this._queue.length&amp;&amp;(_.each(this._queue,function(e)&#123;t[e[0]].apply(t,slice.call(e[1]))&#125;),this._queue=[])&#125;&#125;,&#123;key:&quot;_hasDisabled&quot;,value:function()&#123;var e=!this.enabled||this.isOptOut;return e&amp;&amp;logger$1.info(&quot;ThinkingData is Pause or Stop!&quot;),e&#125;&#125;,&#123;key:&quot;_sendRequest&quot;,value:function(e,t,i)&#123;if(!this._hasDisabled())if(_.isUndefined(this.config.disableEventList)||!this.config.disableEventList.includes(e.eventName))&#123;t=_.isDate(t)?t:new Date;var n=&#123;data:[&#123;&quot;#type&quot;:e.type,&quot;#time&quot;:_.formatDate(t),&quot;#distinct_id&quot;:this.store.getDistinctId()&#125;]&#125;;this.store.getAccountId()&amp;&amp;(n.data[0][&quot;#account_id&quot;]=this.store.getAccountId()),&quot;track&quot;===e.type||&quot;track_update&quot;===e.type||&quot;track_overwrite&quot;===e.type?(n.data[0][&quot;#event_name&quot;]=e.eventName,&quot;track_update&quot;===e.type||&quot;track_overwrite&quot;===e.type?n.data[0][&quot;#event_id&quot;]=e.extraId:e.firstCheckId&amp;&amp;(n.data[0][&quot;#first_check_id&quot;]=e.firstCheckId),n.data[0].properties=_.extend(&#123;&quot;#zone_offset&quot;:0-t.getTimezoneOffset()/60&#125;,systemInformation.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():&#123;&#125;),t=this.store.removeEventTimer(e.eventName),_.isUndefined(t)||(r=(new Date).getTime()-t,86400&lt;(a=parseFloat((r/1e3).toFixed(3)))?a=86400:a&lt;0&amp;&amp;(a=0),n.data[0].properties[&quot;#duration&quot;]=a)):n.data[0].properties=&#123;&#125;,_.isObject(e.properties)&amp;&amp;!_.isEmptyObject(e.properties)&amp;&amp;_.extend(n.data[0].properties,e.properties),_.searchObjDate(n.data[0]),1&lt;this.config.maxRetries&amp;&amp;(n.data[0][&quot;#uuid&quot;]=_.UUIDv4()),n[&quot;#app_id&quot;]=this.appId,logger$1.info(JSON.stringify(n,null,4));var a,r=&quot;debug&quot;===this.config.debugMode||&quot;debugOnly&quot;===this.config.debugMode?this.serverDebugUrl:this.serverUrl;if(_.isBoolean(this.config.enableEncrypt)&amp;&amp;!0===this.config.enableEncrypt&amp;&amp;(n.data[0]=_.generateEncryptyData(n.data[0],this.config.secretKey)),this.batchConsumer&amp;&amp;&quot;none&quot;===this.config.debugMode&amp;&amp;!i)return this.batchConsumer.add(n.data[0]),void(_.isFunction(e.onComplete)&amp;&amp;e.onComplete(&#123;code:0,msg:&quot;success&quot;&#125;));i?(a=new FormData,&quot;debug&quot;===this.config.debugMode||&quot;debugOnly&quot;===this.config.debugMode?(a.append(&quot;source&quot;,&quot;client&quot;),a.append(&quot;appid&quot;,this.appId),a.append(&quot;dryRun&quot;,&quot;debugOnly&quot;===this.config.debugMode?1:0),a.append(&quot;deviceId&quot;,this.getDeviceId()),a.append(&quot;data&quot;,JSON.stringify(n.data[0]))):(i=_.base64Encode(JSON.stringify(n)),a.append(&quot;data&quot;,i)),navigator.sendBeacon(r,a),_.isFunction(e.onComplete)&amp;&amp;e.onComplete(&#123;statusCode:200&#125;)):senderQueue.enqueue(n,r,&#123;maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode,deviceId:this.getDeviceId()&#125;)&#125;else logger$1.info(&quot;disabled Event : &quot;+e.eventName)&#125;&#125;,&#123;key:&quot;_isObjectParams&quot;,value:function(e)&#123;return _.isObject(e)&amp;&amp;_.isFunction(e.onComplete)&#125;&#125;,&#123;key:&quot;track&quot;,value:function(e,t,i,n)&#123;var a;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(a=e).eventName,t=a.properties,i=a.time,n=a.onComplete),PropertyChecker.event(e)&amp;&amp;PropertyChecker.properties(t)||!this.config.strict?this._internalTrack(e,t,i,n):_.isFunction(n)&amp;&amp;n(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;))&#125;&#125;,&#123;key:&quot;trackUpdate&quot;,value:function(e)&#123;var t,i;this._hasDisabled()||(e&amp;&amp;e.eventId&amp;&amp;(PropertyChecker.event(e.eventName)&amp;&amp;PropertyChecker.properties(e.properties)||!this.config.strict)?this._isReady()?(t=_.checkCalibration(e.properties,e.time,this.config.enableCalibrationTime),i=_.isDate(e.time)?e.time:new Date,this._sendRequest(&#123;type:&quot;track_update&quot;,eventName:e.eventName,properties:t,onComplete:e.onComplete,extraId:e.eventId&#125;,i)):this._queue.push([&quot;trackUpdate&quot;,[e]]):(logger$1.warn(&quot;Invalide parameter for trackUpdate: you should pass an object contains eventId to trackUpdate()&quot;),_.isFunction(e.onComplete)&amp;&amp;e.onComplete(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;trackOverwrite&quot;,value:function(e)&#123;var t,i;this._hasDisabled()||(e&amp;&amp;e.eventId&amp;&amp;(PropertyChecker.event(e.eventName)&amp;&amp;PropertyChecker.properties(e.properties)||!this.config.strict)?this._isReady()?(t=_.checkCalibration(e.properties,e.time,this.config.enableCalibrationTime),i=_.isDate(e.time)?e.time:new Date,this._sendRequest(&#123;type:&quot;track_overwrite&quot;,eventName:e.eventName,properties:t,onComplete:e.onComplete,extraId:e.eventId&#125;,i)):this._queue.push([&quot;trackOverwrite&quot;,[e]]):(logger$1.warn(&quot;Invalide parameter for trackOverwrite: you should pass an object contains eventId to trackOverwrite()&quot;),_.isFunction(e.onComplete)&amp;&amp;e.onComplete(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;trackFirstEvent&quot;,value:function(e)&#123;var t,i;this._hasDisabled()||(e&amp;&amp;e.eventName&amp;&amp;(PropertyChecker.event(e.eventName)&amp;&amp;PropertyChecker.properties(e.properties)||!this.config.strict)?this._isReady()?(t=_.checkCalibration(e.properties,e.time,this.config.enableCalibrationTime),i=_.isDate(e.time)?e.time:new Date,this._sendRequest(&#123;type:&quot;track&quot;,eventName:e.eventName,properties:t,onComplete:e.onComplete,firstCheckId:e.firstCheckId||this.getDeviceId()&#125;,i)):this._queue.push([&quot;trackFirstEvent&quot;,[e]]):(logger$1.warn(&quot;Invalide parameter for trackFirstEvent: you should pass an object contains eventName to trackFirstEvent()&quot;),_.isFunction(e.onComplete)&amp;&amp;e.onComplete(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;_internalTrack&quot;,value:function(e,t,i,n,a)&#123;var r;this._hasDisabled()||(r=_.checkCalibration(t,i,this.config.enableCalibrationTime),i=_.isDate(i)?i:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;track&quot;,eventName:e,properties:r,onComplete:n&#125;,i,a):this._queue.push([&quot;_internalTrack&quot;,[e,t,i,n]]))&#125;&#125;,&#123;key:&quot;userSet&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(n=e).properties,t=n.time,i=n.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_set&quot;,properties:e,onComplete:i&#125;,t):this._queue.push([&quot;userSet&quot;,[e,t,i]])):(logger$1.warn(&quot;calling userSet failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;userSetOnce&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(n=e).properties,t=n.time,i=n.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_setOnce&quot;,properties:e,onComplete:i&#125;,t):this._queue.push([&quot;userSetOnce&quot;,[e,t,i]])):(logger$1.warn(&quot;calling userSetOnce failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;userUnset&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(n)&amp;&amp;(e=n.property,t=n.time,i=n.onComplete),PropertyChecker.propertyName(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?((n=&#123;&#125;)[e]=0,this._sendRequest(&#123;type:&quot;user_unset&quot;,properties:n,onComplete:i&#125;,t)):this._queue.push([&quot;userUnset&quot;,[e,i,t]])):(logger$1.warn(&quot;calling userUnset failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;userDel&quot;,value:function(e,t)&#123;var i;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(i=e).time,t=i.onComplete),e=_.isDate(e)?e:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_del&quot;,onComplete:t&#125;,e):this._queue.push([&quot;userDel&quot;,[e,t]]))&#125;&#125;,&#123;key:&quot;userAdd&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(n=e).properties,t=n.time,i=n.onComplete),PropertyChecker.userAddProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_add&quot;,properties:e,onComplete:i&#125;,t):this._queue.push([&quot;userAdd&quot;,[e,t,i]])):(logger$1.warn(&quot;calling userAdd failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;userAppend&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(n=e).properties,t=n.time,i=n.onComplete),PropertyChecker.userAppendProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_append&quot;,properties:e,onComplete:i&#125;,t):this._queue.push([&quot;userAppend&quot;,[e,t,i]])):(logger$1.warn(&quot;calling userAppend failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;userUniqAppend&quot;,value:function(e,t,i)&#123;var n;this._hasDisabled()||(this._isObjectParams(e)&amp;&amp;(e=(n=e).properties,t=n.time,i=n.onComplete),PropertyChecker.userAppendProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest(&#123;type:&quot;user_uniq_append&quot;,properties:e,onComplete:i&#125;,t):this._queue.push([&quot;userUniqAppend&quot;,[e,t,i]])):(logger$1.warn(&quot;calling userAppend failed due to invalid arguments&quot;),_.isFunction(i)&amp;&amp;i(&#123;code:-1,msg:&quot;invalid parameters&quot;&#125;)))&#125;&#125;,&#123;key:&quot;flush&quot;,value:function()&#123;this.batchConsumer&amp;&amp;&quot;none&quot;===this.config.debugMode&amp;&amp;this.batchConsumer.flush()&#125;&#125;,&#123;key:&quot;authorizeOpenID&quot;,value:function(e)&#123;this.identify(e)&#125;&#125;,&#123;key:&quot;identify&quot;,value:function(e)&#123;if(!this._hasDisabled())&#123;if(&quot;number&quot;==typeof e)e=String(e);else if(&quot;string&quot;!=typeof e)return!1;this.store.setDistinctId(e)&#125;&#125;&#125;,&#123;key:&quot;getDistinctId&quot;,value:function()&#123;return this.store.getDistinctId()&#125;&#125;,&#123;key:&quot;login&quot;,value:function(e)&#123;if(!this._hasDisabled())&#123;if(&quot;number&quot;==typeof e)e=String(e);else if(&quot;string&quot;!=typeof e)return!1;this.store.setAccountId(e)&#125;&#125;&#125;,&#123;key:&quot;getAccountId&quot;,value:function()&#123;return this.store.getAccountId()&#125;&#125;,&#123;key:&quot;logout&quot;,value:function()&#123;this._hasDisabled()||this.store.setAccountId(null)&#125;&#125;,&#123;key:&quot;setSuperProperties&quot;,value:function(e)&#123;this._hasDisabled()||(PropertyChecker.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):logger$1.warn(&quot;setSuperProperties parameter must be a valid property value&quot;))&#125;&#125;,&#123;key:&quot;clearSuperProperties&quot;,value:function()&#123;this._hasDisabled()||this.store.setSuperProperties(&#123;&#125;,!0)&#125;&#125;,&#123;key:&quot;unsetSuperProperty&quot;,value:function(e)&#123;var t;this._hasDisabled()||_.isString(e)&amp;&amp;(delete(t=this.getSuperProperties())[e],this.store.setSuperProperties(t,!0))&#125;&#125;,&#123;key:&quot;getSuperProperties&quot;,value:function()&#123;return this.store.getSuperProperties()&#125;&#125;,&#123;key:&quot;getPresetProperties&quot;,value:function()&#123;var e=systemInformation.properties,t=&#123;&#125;,i=e[&quot;#os&quot;];t.os=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#screen_width&quot;];t.screenWidth=_.isUndefined(i)?0:i;i=e[&quot;#screen_height&quot;];t.screenHeight=_.isUndefined(i)?0:i;i=e[&quot;#network_type&quot;];t.networkType=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#device_model&quot;];t.deviceModel=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#os_version&quot;];t.osVersion=_.isUndefined(i)?&quot;&quot;:i,t.deviceId=this.getDeviceId();var n=0-(new Date).getTimezoneOffset()/60;t.zoneOffset=n;e=e[&quot;#manufacturer&quot;];return t.manufacturer=_.isUndefined(e)?&quot;&quot;:e,t.toEventPresetProperties=function()&#123;return&#123;&quot;#device_model&quot;:t.deviceModel,&quot;#device_id&quot;:t.deviceId,&quot;#screen_width&quot;:t.screenWidth,&quot;#screen_height&quot;:t.screenHeight,&quot;#os&quot;:t.os,&quot;#os_version&quot;:t.osVersion,&quot;#network_type&quot;:t.networkType,&quot;#zone_offset&quot;:n,&quot;#manufacturer&quot;:t.manufacturer&#125;&#125;,t&#125;&#125;,&#123;key:&quot;setDynamicSuperProperties&quot;,value:function(e)&#123;this._hasDisabled()||(&quot;function&quot;==typeof e?PropertyChecker.properties(e())||!this.config.strict?this.dynamicProperties=e:logger$1.warn(&quot;A dynamic public property must return a valid property value&quot;):logger$1.warn(&quot;setDynamicSuperProperties parameter must be a function type&quot;))&#125;&#125;,&#123;key:&quot;timeEvent&quot;,value:function(e,t)&#123;this._hasDisabled()||(t=_.isDate(t)?t:new Date,this._isReady()?PropertyChecker.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):logger$1.warn(&quot;calling timeEvent failed due to invalid eventName: &quot;+e):this._queue.push([&quot;timeEvent&quot;,[e,t]]))&#125;&#125;,&#123;key:&quot;getDeviceId&quot;,value:function()&#123;return systemInformation.properties[&quot;#device_id&quot;]&#125;&#125;,&#123;key:&quot;enableTracking&quot;,value:function(e)&#123;this.enabled=e,this.store._set(&quot;ta_enabled&quot;,e)&#125;&#125;,&#123;key:&quot;optOutTracking&quot;,value:function()&#123;this.store.setSuperProperties(&#123;&#125;,!0),this.store.setDistinctId(_.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set(&quot;ta_isOptOut&quot;,!0)&#125;&#125;,&#123;key:&quot;optOutTrackingAndDeleteUser&quot;,value:function()&#123;var e=new Date;this._sendRequest(&#123;type:&quot;user_del&quot;&#125;,e),this.optOutTracking()&#125;&#125;,&#123;key:&quot;optInTracking&quot;,value:function()&#123;this.isOptOut=!1,this.store._set(&quot;ta_isOptOut&quot;,!1)&#125;&#125;,&#123;key:&quot;setTrackStatus&quot;,value:function(e)&#123;switch(e)&#123;case&quot;PAUSE&quot;:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!1);break;case&quot;STOP&quot;:this.eventSaveOnly=!1,this.optOutTracking(!0);break;case&quot;SAVE_ONLY&quot;:break;case&quot;NORMAL&quot;:default:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!0)&#125;logger$1.info(&quot;switch track status:&quot;+e)&#125;&#125;]),i&#125;(),DEFAULT_CONFIG$1=&#123;name:&quot;thinkingdata&quot;,enableLog:!0,enableNative:!1&#125;,ThinkingDataAPIForNative=function()&#123;function i(e)&#123;_classCallCheck(this,i),e.appId=e.appId?_.checkAppId(e.appId):_.checkAppId(e.appid),e.serverUrl=e.serverUrl?_.checkUrl(e.serverUrl):_.checkUrl(e.server_url);var t=_.extend(&#123;&#125;,DEFAULT_CONFIG$1,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)&#125;return _createClass(i,[&#123;key:&quot;_isNativePlatform&quot;,value:function()&#123;return!(!this._isIOS()&amp;&amp;!this._isAndroid()||!this.config.enableNative)&#125;&#125;,&#123;key:&quot;_isIOS&quot;,value:function()&#123;return!(!cc.sys.isNative||&quot;iOS&quot;!==cc.sys.os)&#125;&#125;,&#123;key:&quot;_isAndroid&quot;,value:function()&#123;return!(!cc.sys.isNative||&quot;Android&quot;!==cc.sys.os)&#125;&#125;,&#123;key:&quot;_init&quot;,value:function(e)&#123;this.name=e.name,this.appId=e.appId||e.appid,this._isNativePlatform()?(this.initInstanceForNative(this.name,e,this.appId),this._readStorage(e)):this.taJs=new ThinkingAnalyticsAPIForJS(e)&#125;&#125;,&#123;key:&quot;_readStorage&quot;,value:function(e)&#123;var t=this,i=e.persistenceName,n=e.persistenceNameOld;e.isChildInstance&amp;&amp;(i=e.persistenceName+&quot;_&quot;+e.name,n=e.persistenceNameOld+&quot;_&quot;+e.name),this._state=PlatformAPI.getStorage(i)||&#123;&#125;,_.isEmptyObject(this._state)&amp;&amp;(this._state=PlatformAPI.getStorage(n)||&#123;&#125;),_.isEmptyObject(this._state)?PlatformAPI.getStorage(i,!0,function(e)&#123;_.isEmptyObject(e)?PlatformAPI.getStorage(n,!0,function(e)&#123;t._state=_.extend2Layers(&#123;&#125;,e,t._state)&#125;):t._state=_.extend2Layers(&#123;&#125;,e,t._state),t._state.distinct_id&amp;&amp;t.identifyForNative(t._state.distinct_id),t._state.account_id&amp;&amp;t.loginForNative(t._state.account_id)&#125;):(this._state.distinct_id&amp;&amp;this.identifyForNative(this._state.distinct_id),this._state.account_id&amp;&amp;this.loginForNative(this._state.account_id))&#125;&#125;,&#123;key:&quot;initInstance&quot;,value:function(e,t)&#123;return this._isNativePlatform()?_.isUndefined(t)?this[e]=new ThinkingAnalyticsAPI(this.config):this[e]=new ThinkingAnalyticsAPI(t):this[e]=this.taJs.initInstance(e,t),this[e]&#125;&#125;,&#123;key:&quot;lightInstance&quot;,value:function(e)&#123;return this[e]&#125;&#125;,&#123;key:&quot;init&quot;,value:function()&#123;if(this._isNativePlatform())&#123;var e=window,t=this;return e.__autoTrackCallback=function(e)&#123;if(_.isFunction(t.config.autoTrack.callback))&#123;e=t.config.autoTrack.callback(e);return JSON.stringify(e)&#125;return&quot;&#123;&#125;&quot;&#125;,void this.startThinkingAnalyticsForNative()&#125;this.taJs.init()&#125;&#125;,&#123;key:&quot;track&quot;,value:function(e,t,i,n)&#123;this._isNativePlatform()?this.trackForNative(e,t,i,this.appId):this.taJs.track(e,t,i,n)&#125;&#125;,&#123;key:&quot;trackUpdate&quot;,value:function(e)&#123;this._isNativePlatform()?this.trackUpdateForNative(e,this.appId):this.taJs.trackUpdate(e)&#125;&#125;,&#123;key:&quot;trackOverwrite&quot;,value:function(e)&#123;this._isNativePlatform()?this.trackOverwriteForNative(e,this.appId):this.taJs.trackOverwrite(e)&#125;&#125;,&#123;key:&quot;trackFirstEvent&quot;,value:function(e)&#123;this._isNativePlatform()?this.trackFirstEventForNative(e,this.appId):this.taJs.trackFirstEvent(e)&#125;&#125;,&#123;key:&quot;userSet&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userSetForNative(e,this.appId):this.taJs.userSet(e,t,i)&#125;&#125;,&#123;key:&quot;userSetOnce&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userSetOnceForNative(e,this.appId):this.taJs.userSetOnce(e,t,i)&#125;&#125;,&#123;key:&quot;userUnset&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userUnsetForNative(e,this.appId):this.taJs.userUnset(e,t,i)&#125;&#125;,&#123;key:&quot;userDel&quot;,value:function(e,t)&#123;this._isNativePlatform()?this.userDelForNative(this.appId):this.taJs.userDel(e,t)&#125;&#125;,&#123;key:&quot;userAdd&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userAddForNative(e,this.appId):this.taJs.userAdd(e,t,i)&#125;&#125;,&#123;key:&quot;userAppend&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userAppendForNative(e,this.appId):this.taJs.userAppend(e,t,i)&#125;&#125;,&#123;key:&quot;userUniqAppend&quot;,value:function(e,t,i)&#123;this._isNativePlatform()?this.userUniqAppendForNative(e,this.appId):this.taJs.userUniqAppend(e,t,i)&#125;&#125;,&#123;key:&quot;flush&quot;,value:function()&#123;this._isNativePlatform()?this.flushForNative(this.appId):this.taJs.flush()&#125;&#125;,&#123;key:&quot;authorizeOpenID&quot;,value:function(e)&#123;this.identify(e)&#125;&#125;,&#123;key:&quot;identify&quot;,value:function(e)&#123;this._isNativePlatform()?this.identifyForNative(e,this.appId):this.taJs.identify(e)&#125;&#125;,&#123;key:&quot;getDistinctId&quot;,value:function()&#123;return this._isNativePlatform()?this.getDistinctIdForNative(this.appId):this.taJs.getDistinctId()&#125;&#125;,&#123;key:&quot;login&quot;,value:function(e)&#123;this._isNativePlatform()?this.loginForNative(e,this.appId):this.taJs.login(e)&#125;&#125;,&#123;key:&quot;getAccountId&quot;,value:function()&#123;return this._isNativePlatform()?this.getAccountIdForNative(this.appId):this.taJs.getAccountId()&#125;&#125;,&#123;key:&quot;logout&quot;,value:function()&#123;this._isNativePlatform()?this.logoutForNative(this.appId):this.taJs.logout()&#125;&#125;,&#123;key:&quot;setSuperProperties&quot;,value:function(e)&#123;this._isNativePlatform()?this.setSuperPropertiesForNative(e,this.appId):this.taJs.setSuperProperties(e)&#125;&#125;,&#123;key:&quot;clearSuperProperties&quot;,value:function()&#123;this._isNativePlatform()?this.clearSuperPropertiesForNative(this.appId):this.taJs.clearSuperProperties()&#125;&#125;,&#123;key:&quot;unsetSuperProperty&quot;,value:function(e)&#123;this._isNativePlatform()?this.unsetSuperPropertyForNative(e,this.appId):this.taJs.unsetSuperProperty(e)&#125;&#125;,&#123;key:&quot;getSuperProperties&quot;,value:function()&#123;return this._isNativePlatform()?this.getSuperPropertiesForNative(this.appId):this.taJs.getSuperProperties()&#125;&#125;,&#123;key:&quot;getPresetProperties&quot;,value:function()&#123;if(this._isNativePlatform())&#123;var e=this.getPresetPropertiesForNative(this.appId),t=&#123;&#125;,i=e[&quot;#os&quot;];t.os=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#screen_width&quot;];t.screenWidth=_.isUndefined(i)?0:i;i=e[&quot;#screen_height&quot;];t.screenHeight=_.isUndefined(i)?0:i;i=e[&quot;#network_type&quot;];t.networkType=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#device_model&quot;];t.deviceModel=_.isUndefined(i)?&quot;&quot;:i;i=e[&quot;#os_version&quot;];t.osVersion=_.isUndefined(i)?&quot;&quot;:i,t.deviceId=this.getDeviceId();var n=0-(new Date).getTimezoneOffset()/60;t.zoneOffset=n;e=e[&quot;#manufacturer&quot;];return t.manufacturer=_.isUndefined(e)?&quot;&quot;:e,t.toEventPresetProperties=function()&#123;return&#123;&quot;#device_model&quot;:t.deviceModel,&quot;#device_id&quot;:t.deviceId,&quot;#screen_width&quot;:t.screenWidth,&quot;#screen_height&quot;:t.screenHeight,&quot;#os&quot;:t.os,&quot;#os_version&quot;:t.osVersion,&quot;#network_type&quot;:t.networkType,&quot;#zone_offset&quot;:n,&quot;#manufacturer&quot;:t.manufacturer&#125;&#125;,t&#125;return this.taJs.getPresetProperties()&#125;&#125;,&#123;key:&quot;setDynamicSuperProperties&quot;,value:function(t)&#123;this._isNativePlatform()?&quot;function&quot;==typeof t?(this.dynamicProperties=t,window.__dynamicPropertiesForNative=function(e)&#123;console.log(&quot;__dynamicPropertiesForNative: native msg: &quot;,e);e=t(),e=_.encodeDates(e);return JSON.stringify(e)&#125;,this.setDynamicSuperPropertiesForNative(&quot;__dynamicPropertiesForNative&quot;)):logger.warn(&quot;setDynamicSuperProperties parameter must be a function type&quot;):this.taJs.setDynamicSuperProperties(t)&#125;&#125;,&#123;key:&quot;timeEvent&quot;,value:function(e,t)&#123;return this._isNativePlatform()?this.timeEventForNative(e,this.appId):this.taJs.timeEvent(e,t)&#125;&#125;,&#123;key:&quot;getDeviceId&quot;,value:function()&#123;return this._isNativePlatform()?this.getDeviceIdForNative(this.appId):this.taJs.getDeviceId()&#125;&#125;,&#123;key:&quot;enableTracking&quot;,value:function(e)&#123;this._isNativePlatform()?this.enableTrackingForNative(e,this.appId):this.taJs.enableTracking(e)&#125;&#125;,&#123;key:&quot;optOutTracking&quot;,value:function()&#123;this._isNativePlatform()?this.optOutTrackingForNative(this.appId):this.taJs.optOutTracking()&#125;&#125;,&#123;key:&quot;optOutTrackingAndDeleteUser&quot;,value:function()&#123;this._isNativePlatform()?this.optOutTrackingAndDeleteUserForNative(this.appId):this.taJs.optOutTrackingAndDeleteUser()&#125;&#125;,&#123;key:&quot;optInTracking&quot;,value:function()&#123;this._isNativePlatform()?this.optInTrackingForNative(this.appId):this.taJs.optInTracking()&#125;&#125;,&#123;key:&quot;setTrackStatus&quot;,value:function(e)&#123;this._isNativePlatform()?this.setTrackStatusForNative(e,this.appId):this.taJs.setTrackStatus(e)&#125;&#125;,&#123;key:&quot;trackForNative&quot;,value:function(e,t,i,n)&#123;i=_.isDate(i)?_.formatDate(i):&quot;&quot;;_.isUndefined(t)&amp;&amp;(t=&#123;&#125;),t=_.extend(t,this.dynamicProperties?this.dynamicProperties():&#123;&#125;),t=_.encodeDates(t),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;track&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V&quot;,e,JSON.stringify(t),i,n):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;track:properties:time:appId:&quot;,e,JSON.stringify(t),i,n)&#125;&#125;,&#123;key:&quot;trackUpdateForNative&quot;,value:function(e,t)&#123;e.properties=_.extend(_.isUndefined(e.properties)?&#123;&#125;:e.properties,this.dynamicProperties?this.dynamicProperties():&#123;&#125;),e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;trackUpdate&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;trackUpdate:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;trackFirstEventForNative&quot;,value:function(e,t)&#123;e.properties=_.extend(_.isUndefined(e.properties)?&#123;&#125;:e.properties,this.dynamicProperties?this.dynamicProperties():&#123;&#125;),e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;trackFirstEvent&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;trackFirstEvent:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;trackOverwriteForNative&quot;,value:function(e,t)&#123;e.properties=_.extend(_.isUndefined(e.properties)?&#123;&#125;:e.properties,this.dynamicProperties?this.dynamicProperties():&#123;&#125;),e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;trackOverwrite&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;trackOverwrite:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;timeEventForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;timeEvent&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;timeEvent:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;loginForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;login&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;login:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;logoutForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;logout&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;logout:&quot;,e)&#125;&#125;,&#123;key:&quot;setSuperPropertiesForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;setSuperProperties&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;setSuperProperties:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;getSuperPropertiesForNative&quot;,value:function(e)&#123;var t=&quot;&#123;&#125;&quot;;return this._isAndroid()?t=jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;getSuperProperties&quot;,&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,e):this._isIOS()&amp;&amp;(t=jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;getSuperProperties:&quot;,e)),JSON.parse(t)&#125;&#125;,&#123;key:&quot;unsetSuperPropertyForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;unsetSuperProperty&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;unsetSuperProperty:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;clearSuperPropertiesForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;clearSuperProperties&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;clearSuperProperties:&quot;,e)&#125;&#125;,&#123;key:&quot;userSetForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userSet&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userSet:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;userSetOnceForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userSetOnce&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userSetOnce:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;userAppendForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userAppend&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userAppend:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;userUniqAppendForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userUniqAppend&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userUniqAppend:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;userAddForNative&quot;,value:function(e,t)&#123;e=_.encodeDates(e),this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userAdd&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,JSON.stringify(e),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userAdd:appId:&quot;,JSON.stringify(e),t)&#125;&#125;,&#123;key:&quot;userUnsetForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userUnset&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userUnset:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;userDelForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;userDel&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;userDel:&quot;,e)&#125;&#125;,&#123;key:&quot;flushForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;flush&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;flush:&quot;,e)&#125;&#125;,&#123;key:&quot;authorizeOpenIDForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;authorizeOpenID&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;authorizeOpenID:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;identifyForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;identify&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;identify:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;initInstanceForNative&quot;,value:function(e,t,i)&#123;this._isAndroid()?(jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;setCustomerLibInfo&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,Config.LIB_NAME,Config.LIB_VERSION),_.isUndefined(t)?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;initInstanceAppId&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,i):jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;initInstanceConfig&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,JSON.stringify(t))):this._isIOS()&amp;&amp;(jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;setCustomerLibInfoWithLibName:libVersion:&quot;,Config.LIB_NAME,Config.LIB_VERSION),_.isUndefined(t)?jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;initInstance:appId:&quot;,e,i):jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;initInstance:config:&quot;,e,JSON.stringify(t)))&#125;&#125;,&#123;key:&quot;lightInstanceForNative&quot;,value:function(e,t)&#123;return this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;lightInstance&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()?jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;lightInstance:appId:&quot;,e,t):void 0&#125;&#125;,&#123;key:&quot;startThinkingAnalyticsForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;startThinkingAnalytics&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;startThinkingAnalytics:&quot;,e)&#125;&#125;,&#123;key:&quot;setDynamicSuperPropertiesForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;setDynamicSuperProperties&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;setDynamicSuperProperties:appId:&quot;,e,t)&#125;&#125;,&#123;key:&quot;getDeviceIdForNative&quot;,value:function(e)&#123;return this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;getDeviceId&quot;,&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,e):this._isIOS()?jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;getDeviceId:&quot;,e):void 0&#125;&#125;,&#123;key:&quot;getDistinctIdForNative&quot;,value:function(e)&#123;return this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;getDistinctId&quot;,&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,e):this._isIOS()?jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;getDistinctId:&quot;,e):void 0&#125;&#125;,&#123;key:&quot;getAccountIdForNative&quot;,value:function(e)&#123;return this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;getAccountId&quot;,&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,e):this._isIOS()?jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;getAccountId:&quot;,e):void 0&#125;&#125;,&#123;key:&quot;getPresetPropertiesForNative&quot;,value:function(e)&#123;var t=&quot;&#123;&#125;&quot;;return this._isAndroid()?t=jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;getPresetProperties&quot;,&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,e):this._isIOS()&amp;&amp;(t=jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;getPresetProperties:&quot;,e)),JSON.parse(t)&#125;&#125;,&#123;key:&quot;enableTrackingForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;enableTracking&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e.toString(),t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;enableTracking:appId:&quot;,e.toString(),t)&#125;&#125;,&#123;key:&quot;optOutTrackingForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;optOutTracking&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;optOutTracking:&quot;,e)&#125;&#125;,&#123;key:&quot;optOutTrackingAndDeleteUserForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;optOutTrackingAndDeleteUser&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;optOutTrackingAndDeleteUser:&quot;,e)&#125;&#125;,&#123;key:&quot;optInTrackingForNative&quot;,value:function(e)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;optInTracking&quot;,&quot;(Ljava/lang/String;)V&quot;,e):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;optInTracking:&quot;,e)&#125;&#125;,&#123;key:&quot;setTrackStatusForNative&quot;,value:function(e,t)&#123;this._isAndroid()?jsb.reflection.callStaticMethod(&quot;com/cocos/game/CocosCreatorProxyApi&quot;,&quot;setTrackStatus&quot;,&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;,e,t):this._isIOS()&amp;&amp;jsb.reflection.callStaticMethod(&quot;CocosCreatorProxyApi&quot;,&quot;setTrackStatus:appId:&quot;,e,t)&#125;&#125;]),i&#125;();window.ThinkingAnalyticsAPI=ThinkingDataAPIForNative,window.ThinkingAnalyticsAPIForJS=ThinkingDataAPI,module.exports=ThinkingDataAPIForNative;function getScript(e,i)&#123;var n=document.createElement(&quot;script&quot;);n.type=&quot;text/javascript&quot;,n.async=!0,i&amp;&amp;(n.onload=i),n.src=e,document.head.appendChild(n)&#125;function parseMessage(e)&#123;var i=e.data,n=i.indexOf(DOLLAR_PREFIX+RECEIVE_MSG_PREFIX);if(-1!==n)&#123;var t=i.slice(n+2);return getMessageParams(t)&#125;return&#123;&#125;&#125;function getMessageParams(e)&#123;var i,n=[],t=e.split(&quot;/&quot;),a=t.length;if(-1===e.indexOf(RECEIVE_MSG_PREFIX))&#123;if(a&gt;=2&amp;&amp;a%2===0)for(i=0;a&gt;i;i+=2)n[t[i]]=t.length&lt;i+1?null:decodeURIComponent(t[i+1])&#125;else&#123;var o=e.split(RECEIVE_MSG_PREFIX);void 0!==o[1]&amp;&amp;(n=JSON&amp;&amp;JSON.parse(o[1]))&#125;return n&#125;function getDapi(e)&#123;var i=parseMessage(e);if(!i||i.name===GET_DAPI_URL_MSG_NAME)&#123;var n=i.data;getScript(n,onDapiReceived)&#125;&#125;function invokeDapiListeners()&#123;for(var e in dapiEventsPool)dapiEventsPool.hasOwnProperty(e)&amp;&amp;dapi.addEventListener(e,dapiEventsPool[e])&#125;function onDapiReceived()&#123;dapi=window.dapi,window.removeEventListener(&quot;message&quot;,getDapi),invokeDapiListeners()&#125;function init()&#123;window.dapi.isDemoDapi&amp;&amp;(window.parent.postMessage(DOLLAR_PREFIX+SEND_MSG_PREFIX+JSON.stringify(&#123;state:&quot;getDapiUrl&quot;&#125;),&quot;*&quot;),window.addEventListener(&quot;message&quot;,getDapi,!1))&#125;window.isDapiPlatform = typeof dapi !== &quot;undefined&quot; || typeof window.dapi !== &quot;undefined&quot;;var DOLLAR_PREFIX=&quot;$$&quot;,RECEIVE_MSG_PREFIX=&quot;DAPI_SERVICE:&quot;,SEND_MSG_PREFIX=&quot;DAPI_AD:&quot;,GET_DAPI_URL_MSG_NAME=&quot;connection.getDapiUrl&quot;,dapiEventsPool=&#123;&#125;,dapi=window.dapi||&#123;isReady:function()&#123;return!1&#125;,addEventListener:function(e,i)&#123;dapiEventsPool[e]=i&#125;,removeEventListener:function(e)&#123;delete dapiEventsPool[e]&#125;,isDemoDapi:!0&#125;;init();&lt;/script&gt;`</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ONLOAD_SCRIPT</span> = <span class="string">`&lt;script&gt;window.addEventListener(&quot;load&quot;, function () &#123;(typeof dapi !== &quot;undefined&quot; &amp;&amp; dapi.isReady()) ? onReadyCallback() : dapi.addEventListener(&quot;ready&quot;, onReadyCallback);&#125;);function onReadyCallback() &#123;dapi.removeEventListener(&quot;ready&quot;, onReadyCallback);let isAudioEnabled = !!dapi.getAudioVolume();window.super_html_change_audio &amp;&amp; window.super_html_change_audio(isAudioEnabled);if (dapi.isViewable()) &#123;adVisibleCallback(&#123;isViewable: true&#125;);requestAnimationFrame(checkBootDapi);&#125;dapi.addEventListener(&quot;viewableChange&quot;, adVisibleCallback);dapi.addEventListener(&quot;adResized&quot;, adResizeCallback);dapi.addEventListener(&quot;audioVolumeChange&quot;, audioVolumeChangeCallback);&#125;function startGame() &#123;var screenSize = dapi.getScreenSize();cc.director &amp;&amp; cc.director.emit(&quot;play_event_game_resume&quot;);cc &amp;&amp; cc.game &amp;&amp; cc.game.resume();&#125;function pauseGame() &#123;cc.director &amp;&amp; cc.director.emit(&quot;play_event_game_pause&quot;);cc &amp;&amp; cc.game &amp;&amp; cc.game.pause();&#125;function checkBootDapi() &#123;if (typeof window.isStartBoot === &quot;undefined&quot; || window.isStartBoot === false) &#123;window.boot &amp;&amp; window.boot();window.isStartBoot = true;&#125; else &#123;return;&#125;requestAnimationFrame(checkBootDapi);&#125;function adVisibleCallback(event) &#123;console.log(&quot;isViewable &quot; + event.isViewable);if (event.isViewable) &#123;screenSize = dapi.getScreenSize();startGame();&#125; else &#123;pauseGame();&#125;&#125;function adResizeCallback(event) &#123;screenSize = event;console.log(&quot;ad was resized width &quot; + event.width + &quot; height &quot; + event.height);&#125;function userClickedDownloadButton(event) &#123;dapi.openStoreUrl();&#125;function audioVolumeChangeCallback(volume) &#123;let isAudioEnabled = !!volume;window.super_html_change_audio &amp;&amp; window.super_html_change_audio(isAudioEnabled);if (isAudioEnabled) &#123;&#125; else &#123;&#125;&#125;&lt;/script&gt;`</span></span><br></pre></td></tr></table></figure>

<h4 id="修改本地-npm环境-为-node18"><a href="#修改本地-npm环境-为-node18" class="headerlink" title="修改本地 npm环境 为 node18"></a>修改本地 npm环境 为 node18</h4><p>由于我本地为了正常出VIVO小游戏的渠道的小游戏包，所以本地使用了 node 16.20，为了正常编译广告库，需要使用node 18环境，为这里使用nvm 操作npm 版本的切换。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">YDC012deMac-mini~/Work/Tools/cocos-pnp-main-plus/packages/playable-adapter-core(:|✔) % cd /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-adapter-core</span><br><span class="line">YDC012deMac-mini~/Work/Tools/cocos-pnp-main-plus/packages/playable-adapter-core(:|✔) % pnpm build</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">playable-adapter-core@1.2.4 build /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-adapter-core</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">rollup -c</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src/index.ts → dist/playable-adapter-core.js...</span><br><span class="line">(!) Circular dependency</span><br><span class="line">src/utils/file-system/index.ts -&gt; src/utils/file-system/project.ts -&gt; src/global.ts -&gt; src/utils/file-system/resource.ts -&gt; src/utils/extends.ts -&gt; src/utils/file-system/index.ts</span><br><span class="line">created dist/playable-adapter-core.js in 2.4s</span><br><span class="line"></span><br><span class="line">src/index.ts → dist/playable-adapter-core.d.ts...</span><br><span class="line">created dist/playable-adapter-core.d.ts in 364ms</span><br><span class="line">YDC012deMac-mini~/Work/Tools/cocos-pnp-main-plus/packages/playable-adapter-core(:|✔) % cd /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter</span><br><span class="line">YDC012deMac-mini~/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter(:|✔) % pnpm build:2x</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">playable-ads-adapter@1.3.10 build:2x /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">pnpm clear &amp;&amp; pnpm build --environment BUILD_VERSION:2x</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">playable-ads-adapter@1.3.10 clear /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">rm</span> -rf dist/</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">playable-ads-adapter@1.3.10 build /Users/ydc012/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">rollup -c <span class="string">&quot;--environment&quot;</span> <span class="string">&quot;BUILD_VERSION:2x&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src/main2x.ts → dist/playable-ads-adapter...</span><br><span class="line">copied:</span><br><span class="line">  assets/package-2x.json → dist/playable-ads-adapter/package.json [R, T]</span><br><span class="line">  i18n/en.js → dist/playable-ads-adapter/i18n/en.js</span><br><span class="line">  i18n/zh.js → dist/playable-ads-adapter/i18n/zh.js</span><br><span class="line">cocos-plugin-update copy folder to global cocos plugin packages</span><br><span class="line">cocos-plugin-update copy folder success</span><br><span class="line">created dist/playable-ads-adapter in 1.7s</span><br><span class="line">YDC012deMac-mini~/Work/Tools/cocos-pnp-main-plus/packages/playable-ads-adapter(:|✔) %</span><br></pre></td></tr></table></figure>

<h3 id="把构建好的文件做成插件"><a href="#把构建好的文件做成插件" class="headerlink" title="把构建好的文件做成插件"></a>把构建好的文件做成插件</h3><p><img src="/post/f5eb8e99/image-20240923171618181.png" alt="image-20240923171618181"></p>
<p>构建完成后</p>
<p><img src="/post/f5eb8e99/image-20240923165704924.png" alt="image-20240923165704924"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>IOS设备，卡死问题（对点击和滑动无响应）</p>
<p>Critical bugs: Any iOS device. Creative stucks on USE THE JOYSTICK TO MOVE… tutorial screen, when it is launched with a delay between Initialisation and displaying the ad.</p>
<p>分析问题如下：</p>
<p><img src="/post/f5eb8e99/image-20240923172516383.png" alt="image-20240923172516383"></p>
<p>修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> width = cc.<span class="property">winSize</span>.<span class="property">width</span> === <span class="number">0</span> ? <span class="number">1080</span> : cc.<span class="property">winSize</span>.<span class="property">width</span>;</span><br><span class="line"><span class="keyword">const</span> height = cc.<span class="property">winSize</span>.<span class="property">height</span> === <span class="number">0</span> ? <span class="number">1920</span> : cc.<span class="property">winSize</span>.<span class="property">height</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">ViewSize</span> = <span class="keyword">new</span> cc.<span class="title class_">Size</span>(width, height);</span><br></pre></td></tr></table></figure>

<h4 id="其他拓展："><a href="#其他拓展：" class="headerlink" title="其他拓展："></a>其他拓展：</h4><p>写一个 模拟测试文件 用来模拟 <code>IronSource</code> 广告加载器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 添加音乐开关按钮，设置初始文本和样式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;music-toggle&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;toggleMusic()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute;top:20px;left:20px;z-index:1000;background-color:blue;color:white;padding:10px;border:none;border-radius:5px;cursor:pointer;&quot;</span>&gt;</span></span><br><span class="line">    音乐开</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 全局音乐开关逻辑</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> musicOn = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">toggleMusic</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-toggle&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (musicOn) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 停止音乐</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 这里加入你的停止音乐代码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Music OFF&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        button.<span class="property">textContent</span> = <span class="string">&quot;Music OFF&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 播放音乐</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 这里加入你的播放音乐代码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Music ON&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        button.<span class="property">textContent</span> = <span class="string">&quot;Music ON&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      musicOn = !musicOn;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">super_html_change_audio</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.super_html_change_audio(musicOn);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;https://xxxxxxx/xxxxx/playerIndex.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;GameDiv&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0&quot;</span> <span class="attr">height</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//3秒后修改尺寸</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> <span class="title class_">GameDiv</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;GameDiv&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">GameDiv</span>.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;90%&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">GameDiv</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;90%&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">3000</span>)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>其实这次广告踩坑，最大的问题是 <code>IronSource</code> 没有提供一个可以测试的环境，导致很多时候，本地测试完全没有问题，但是上传到他们的广告平台却被拒审，这样反反复复几周时间都耽搁了，但是没办法，作为开发者，只能忍气吞声的干好本职工作。</p>

  </div>
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--页脚广告-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/post/9f03c1f.html">
        <i class="iconfont icon-angle-left"></i>
        <span>Android新特性自适应图标(Adaptive Icons)</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/post/bd90a3.html">
        <span>CocosCreator2.4.13接入Jest测试</span>
        <i class="iconfont icon-angle-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/post/f5eb8e99.html" id="toc-header" class="mdui-ripple">文章目录</a>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">工具插件相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#super-html%EF%BC%88128%E5%85%83%EF%BC%89%E3%80%90%E6%94%B6%E8%B4%B9%E3%80%91"><span class="toc-number">1.1.</span> <span class="toc-text">super-html（128元）【收费】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SmartAd%E8%AF%95%E7%8E%A9%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%EF%BC%88%E6%94%AF%E6%8C%81GoogleAds%E3%80%81Facebook%E7%AD%897%E4%B8%AA%E6%B8%A0%E9%81%93%EF%BC%89%E3%80%90%E5%85%8D%E8%B4%B9%E3%80%91"><span class="toc-number">1.2.</span> <span class="toc-text">SmartAd试玩打包工具（支持GoogleAds、Facebook等7个渠道）【免费】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CreatePlayableAd%E3%80%90%E5%85%8D%E8%B4%B9%E3%80%91"><span class="toc-number">1.3.</span> <span class="toc-text">CreatePlayableAd【免费】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E7%89%B9%E8%89%B2"><span class="toc-number">1.3.1.</span> <span class="toc-text">插件特色</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playable-ads-adapter%E3%80%90%E5%85%8D%E8%B4%B9%E3%80%91"><span class="toc-number">1.4.</span> <span class="toc-text">Playable ads adapter【免费】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">插件使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="toc-number">1.4.2.</span> <span class="toc-text">下载地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">安装插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">使用插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.2.</span> <span class="toc-text">插件说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E6%B8%A0%E9%81%93"><span class="toc-number">1.5.3.</span> <span class="toc-text">支持渠道</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cocos-Creator-Build-Tool"><span class="toc-number">1.6.</span> <span class="toc-text">Cocos-Creator-Build-Tool</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%88%B6%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">其他制作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SmartAd%E8%AF%95%E7%8E%A9%E5%B9%BF%E5%91%8A%E5%88%B6%E4%BD%9C%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.1.</span> <span class="toc-text">SmartAd试玩广告制作平台</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%8E%A9%E5%A4%9A%E6%B8%A0%E9%81%93%E6%94%AF%E6%8C%81%E6%B7%BB%E5%8A%A0SDK%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.1.</span> <span class="toc-text">试玩多渠道支持添加SDK操作说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0SDK"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">添加SDK</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SDK%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">SDK调用时机</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%96%87%E7%AB%A0"><span class="toc-number">2.1.2.</span> <span class="toc-text">优化文章</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%B8%B8H5%E5%87%BA%E6%B5%B7%E5%BC%80%E5%8F%91%E8%80%85%E4%B8%AD%E5%BF%83"><span class="toc-number">2.2.</span> <span class="toc-text">微游H5出海开发者中心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SDK%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97"><span class="toc-number">2.2.1.</span> <span class="toc-text">SDK接入指南</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">使用过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%BA%90%E7%A0%81"><span class="toc-number">3.0.1.</span> <span class="toc-text">修改源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%9C%AC%E5%9C%B0-npm%E7%8E%AF%E5%A2%83-%E4%B8%BA-node18"><span class="toc-number">3.0.2.</span> <span class="toc-text">修改本地 npm环境 为 node18</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8A%E6%9E%84%E5%BB%BA%E5%A5%BD%E7%9A%84%E6%96%87%E4%BB%B6%E5%81%9A%E6%88%90%E6%8F%92%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">把构建好的文件做成插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%8B%93%E5%B1%95%EF%BC%9A"><span class="toc-number">4.0.1.</span> <span class="toc-text">其他拓展：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">思考</span></a></li></ol>
      </li>
    </ul>
  </div>



  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
        <a href="https://beian.miit.gov.cn" rel="noopener" target="_blank"></a>
      
      <span>
        &copy; 2018 - 2025 
        
          <span style="color:#d9333f" class="iconfont icon-heart"></span>
        
        asroads
      </span>
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span>Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span>Theme: <a href="https://github.com/kb1000fx/Meadow" rel="noopener" target="_blank">Meadow</a></span>
        </div>
      
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span id="busuanzi_container_site_uv" style="display: none;"> <span class="iconfont icon-user"></span>总访客量 <span id="busuanzi_value_site_uv"></span></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span id="busuanzi_container_site_pv" style="display: none;"> <span class="iconfont icon-eye"></span>总访问量 <span id="busuanzi_value_site_pv"></span></span>
        </div>
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  

    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/js/mdui.min.v1.0.0.js"></script>




<script src="/js/meadow.js"></script>

</body>
</html >